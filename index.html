<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, minimum-scale=1.0">
    <meta name="description" content="ANEKAMARKET - Platform jual beli online terpercaya untuk semua kebutuhan Anda. Dekorasi, handmade, dan souvenir berkualitas.">
    <meta name="keywords" content="jual beli online, situbondo, dekorasi, handmade, souvenir">
    <meta name="author" content="ANEKAMARKET">
    <meta property="og:title" content="ANEKAMARKET | Platform Jual Beli Online Terpercaya">
    <meta property="og:description" content="Semua Bisa Jualan & Semua Bisa Pesan - Platform lengkap untuk kebutuhan jual beli online Anda">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://s.id/anekamarket">
    <meta property="og:image" content="https://raw.githubusercontent.com/LKS-88/anekamarket/refs/heads/main/Logo-Anekamarketku.png">
    <title>ANEKAMARKET | Platform Jual Beli Online Terpercaya</title>
    
    <link rel="stylesheet" href="style.css">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="icon" href="https://raw.githubusercontent.com/LKS-88/anekamarket/refs/heads/main/Logo-Anekamarketku.png" type="image/png">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcode-generator/1.4.4/qrcode.js"></script>
    
    <style>
        .search-modal.show {
            display: flex;
        }
        .search-modal-content {
            width: 90%;
            max-width: 600px;
            background: #fff;
            border-radius: 8px;
            padding: 20px;
            position: relative;
        }
        .search-modal-input {
            width: 100%;
            padding: 12px;
            font-size: 1rem;
            border: 1px solid #ccc;
            border-radius: 5px;
            margin-bottom: 15px;
        }
        .search-results {
            max-height: 400px;
            overflow-y: auto;
        }
        .search-result-item {
            display: flex;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #eee;
            text-decoration: none;
            color: #333;
            transition: background-color 0.3s;
        }
        .search-result-item:hover {
            background-color: #f5f5f5;
        }
        .search-result-image {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 5px;
            margin-right: 15px;
        }
        .search-result-info h4 {
            margin: 0 0 5px 0;
            font-size: 1rem;
            font-weight: 600;
        }
        .search-result-info p {
            margin: 0;
            font-size: 0.85rem;
            color: #666;
        }
        .search-results-placeholder {
            text-align: center;
            color: #888;
            padding: 20px;
        }
        
        /* --- CSS Notifikasi Penawaran --- */
        .offer-notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: #ffffff;
            color: #333;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            width: 320px;
            z-index: 1001;
            transform: translateY(200%);
            opacity: 0;
            transition: transform 0.5s ease-in-out, opacity 0.5s ease-in-out;
            font-family: 'Poppins', sans-serif;
        }
        .offer-notification.show {
            transform: translateY(0);
            opacity: 1;
        }
        .offer-notification .notification-content {
            display: none;
        }
        .offer-notification .notification-content.active {
            display: block;
        }
        .offer-notification h4 {
            margin: 0 0 10px 0;
            font-weight: 600;
            font-size: 1rem;
            line-height: 1.4;
        }
        .offer-notification .notification-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        .offer-notification .notification-btn {
            flex: 1;
            padding: 8px 12px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
            transition: background-color 0.3s, color 0.3s;
        }
        .offer-notification .btn-yes {
            background-color: #007bff;
            color: white;
        }
        .offer-notification .btn-yes:hover {
            background-color: #0056b3;
        }
        .offer-notification .btn-no {
            background-color: #f1f1f1;
            color: #333;
            border: 1px solid #ddd;
        }
        .offer-notification .btn-no:hover {
            background-color: #e0e0e0;
        }
        .offer-notification .close-notification {
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 20px;
            color: #888;
            cursor: pointer;
            transition: color 0.3s;
        }
        .offer-notification .close-notification:hover {
            color: #333;
        }
        
        /* CSS untuk Tombol Kunjungi Gerai */
        .btn-visit {
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #28a745;
            color: white;
            padding: 8px 12px;
            border-radius: 5px;
            text-decoration: none;
            font-weight: 500;
            font-size: 0.85rem;
            transition: background-color 0.3s;
            flex: 1;
            text-align: center;
        }
        .btn-visit:hover {
            background-color: #218838;
        }
        .btn-visit i {
            margin-right: 8px;
        }
        .gallery-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap; /* Memastikan tombol tidak berantakan di layar kecil */
        }
        .gallery-actions .btn-detail,
        .gallery-actions .btn-order,
        .gallery-actions .btn-preorder-toggle,
        .gallery-actions .btn-visit {
            flex-grow: 1;
            min-width: 120px; /* Lebar minimum untuk setiap tombol */
        }
    </style>
</head>
<body>
    <audio id="bgMusic" loop autoplay>
        <source src="https://raw.githubusercontent.com/Musikwebsite.mp3" type="audio/mpeg">
    </audio>
    
    <div class="particles" id="particles"></div>
    
    <header id="home">
        <div class="header-overlay"></div>
        <div class="header-content">
            <div class="logo">
                <img src="https://raw.githubusercontent.com/LKS-88/anekamarket/refs/heads/main/Logo-Anekamarketku.png" alt="ANEKAMARKET Logo">
                <span>ANEKAMARKET</span>
            </div>
            <p class="tagline">Semua Bisa Jualan & Semua Bisa Pesan</p>
            
            <div class="header-search">
                <input type="text" id="headerSearchInput" placeholder="Cari produk, UMKM, kode...">
                <button id="headerSearchBtn"><i class="fas fa-search"></i></button>
            </div>
            
            <div class="header-buttons">
                <a href="#gallery" class="btn btn-primary">
                    <i class="fas fa-images"></i> Lihat Karya & Jualan Kami
                </a>
                <a href="#contact" class="btn btn-outline">
                    <i class="fas fa-envelope"></i> Hubungi Kami
                </a>
            </div>
            <a href="#services" class="scroll-down">
                <i class="fas fa-chevron-down"></i>
            </a>
        </div>
    </header>
    
    <nav id="navbar">
        <div class="nav-container">
            <a href="#" class="nav-logo">
                <img src="https://raw.githubusercontent.com/LKS-88/anekamarket/refs/heads/main/Logo-Anekamarketku.png" alt="ANEKAMARKET Logo">
                <span>ANEKAMARKET</span>
            </a>
            
            <div class="nav-search" id="navSearch">
                <input type="text" id="navSearchInput" placeholder="Cari produk atau layanan...">
                <button id="navSearchBtn"><i class="fas fa-search"></i></button>
            </div>
            
            <button class="search-toggle" id="searchToggle">
                <i class="fas fa-search"></i>
            </button>
            
            <button class="mobile-menu-toggle" id="mobileMenuToggle">
                <i class="fas fa-bars"></i>
            </button>
            
            <div class="nav-links" id="navLinks">
                <a href="#home">Beranda</a>
                <a href="#services">Layanan</a>
                <a href="#gallery">Galeri</a>
                <a href="#contact">Kontak</a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <section class="services" id="services">
            <h2 class="section-title">Layanan Kami</h2>
            <div class="services-grid">
                <div class="service-card">
                    <div class="service-icon">
                        <i class="fas fa-calendar-alt"></i>
                    </div>
                    <h3 class="service-title">Jasa Sewa</h3>
                    <p>Pilihan sewa fleksibel untuk dekorasi, peralatan, dan berbagai kebutuhan acara Anda.</p>
                </div>
                <div class="service-card">
                    <div class="service-icon">
                        <i class="fas fa-bullhorn"></i>
                    </div>
                    <h3 class="service-title">Solusi Promosi</h3>
                    <p>Material pemasaran kreatif dan strategi untuk meningkatkan visibilitas merek produk Anda.</p>
                </div>
            </div>
        </section>
        
        <section class="gallery" id="gallery">
            <h2 class="section-title">Galeri Kami</h2>
            <div class="gallery-intro">
                <p>Jelajahi koleksi karya dan layanan premium kami. Klik "Detail" untuk melihat lebih banyak gambar dan informasi.</p>
                
                <div class="product-categories">
                    <button class="product-category-btn active" data-category="all">Semua Kategori</button>
                    <button class="product-category-btn" data-category="food">Makanan & Minuman</button>
                    <button class="product-category-btn" data-category="snack">Kue & Cemilan</button>
                    <button class="product-category-btn" data-category="construction">Alat Konstruksi</button>
                    <button class="product-category-btn" data-category="office">Alat Kantor</button>
                    <button class="product-category-btn" data-category="household">Alat Rumah Tangga</button>
                    <button class="product-category-btn" data-category="software">Software Aplikasi</button>
                    <button class="product-category-btn" data-category="electronics">Elektronik</button>
                    <button class="product-category-btn" data-category="fishery">Perikanan</button>
                    <button class="product-category-btn" data-category="livestock">Peternakan</button>
                    <button class="product-category-btn" data-category="agriculture">Pertanian</button>
                </div>
                
                <div class="category-tabs">
                    <button class="category-btn active" data-type="all">Semua</button>
                    <button class="category-btn" data-type="rental">Sewa</button>
                    <button class="category-btn" data-type="promo">Promosi</button>
                </div>
            </div>
            
            <div class="gallery-grid" id="gallery-grid"></div>   
        </section>

        <section class="contact" id="contact">
            <h2 class="section-title">Hubungi Kami</h2>
            <div class="contact-container">
                <div class="contact-info">
                    <h3>Informasi Kontak</h3>
                    <div class="contact-detail">
                        <i class="fas fa-map-marker-alt contact-icon"></i>
                        <div class="contact-text">
                            <h4>Alamat</h4>
                            <p>Jl. PB Sudirman, Desa Wringin Anom<br>Kec. Panarukan, Kab. Situbondo (68351)<br>Provinsi Jawa Timur</p>
                        </div>
                    </div>
                    <div class="contact-detail">
                        <i class="fas fa-phone-alt contact-icon"></i>
                        <div class="contact-text">
                            <h4>Telepon</h4>
                            <p>+6285647709114</p>
                        </div>
                    </div>
                    <div class="contact-detail">
                        <i class="fas fa-envelope contact-icon"></i>
                        <div class="contact-text">
                            <h4>Email</h4>
                            <p>admin@anekamarket.my.id</p>
                        </div>
                    </div>
                    <div class="contact-detail">
                        <i class="fas fa-clock contact-icon"></i>
                        <div class="contact-text">
                            <h4>Jam Operasional Admin</h4>
                            <p>Senin - Jumat: 09.00 - 16.00<br>Sabtu & Minggu: 07.00 - 19.00</p>
                        </div>
                    </div>
                </div>
                <div class="contact-form">
                    <h3>Kirim Pesan</h3>
                    <div id="formStatus" class="form-status" style="display: none;"></div>
                    <form id="contactForm" action="https://formsubmit.co/admin@anekamarket.my.id" method="POST">
                        <input type="hidden" name="_captcha" value="false">
                        <input type="hidden" name="_next" value="https://yourwebsite.com/thank-you.html">
                        <input type="hidden" name="_template" value="table">
                        <div class="form-group">
                            <label for="name">Nama Anda</label>
                            <input type="text" id="name" name="name" required>
                        </div>
                        <div class="form-group">
                            <label for="email">Alamat Email</label>
                            <input type="email" id="email" name="email" required>
                        </div>
                        <div class="form-group">
                            <label for="phone">Nomor Telepon</label>
                            <input type="tel" id="phone" name="phone" required>
                        </div>
                        <div class="form-group">
                            <label for="subject">Subjek</label>
                            <select id="subject" name="subject" required>
                                <option value="" disabled selected>Pilih subjek</option>
                                <option value="general">Pertanyaan Umum</option>
                                <option value="order">Pemesanan Produk</option>
                                <option value="rental">Pertanyaan Sewa</option>
                                <option value="promo">Layanan Promosi</option>
                                <option value="other">Lainnya</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="message">Pesan</label>
                            <textarea id="message" name="message" required></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary" id="submitBtn">
                            <i class="fas fa-paper-plane"></i> Kirim Pesan
                        </button>
                    </form>
                </div>
            </div>
        </section>
    </div>
    
    <div class="contact-bar">
        <a href="https://wa.me/6285647709114" class="contact-btn whatsapp" target="_blank" aria-label="Hubungi via WhatsApp">
            <i class="fab fa-whatsapp"></i>
        </a>
        <a href="tel:+6285647709114" class="contact-btn phone" aria-label="Telepon Kami">
            <i class="fas fa-phone"></i>
        </a>
        <button class="contact-btn order" id="quick-order" aria-label="Pesan Cepat">
            <i class="fas fa-shopping-cart"></i>
        </button>
    </div>
    
    <footer>
        <div class="footer-container">
            <div class="footer-col footer-about">
                <div class="footer-logo">
                    <img src="https://raw.githubusercontent.com/LKS-88/anekamarket/refs/heads/main/Logo-Anekamarketku.png" alt="ANEKAMARKET Logo">
                    <span>ANEKAMARKET</span>
                </div>
                <p>Menyediakan pelayanan publikasi dan promosi produk UMKM, jasa sewa dan pembuatan aplikasi usaha sejak tahun 2025. Komitmen kami adalah memberikan pengalaman berbelanja online yang menyenangkan dan memuaskan.</p>
            </div>
            
            <div class="footer-col">
                <h3>Tautan Cepat</h3>
                <ul class="footer-links">
                    <li><a href="#home">Beranda</a></li>
                    <li><a href="#services">Layanan</a></li>
                    <li><a href="#gallery">Galeri</a></li>
                    <li><a href="#contact">Kontak</a></li>
                </ul>
            </div>
            
            <div class="footer-col">
                <h3>Newsletter</h3>
                <p>Berlangganan newsletter kami untuk mendapatkan update produk terbaru dan penawaran spesial.</p>
                <form class="newsletter-form">
                    <input type="email" placeholder="Alamat email Anda" required>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-envelope"></i> Berlangganan
                    </button>
                </form>
            </div>
        </div>
        
        <div class="copyright">
            &copy; 2025 ANEKAMARKET. Semua hak dilindungi. | <a href="#">Kebijakan Privasi</a> | <a href="#">Syarat & Ketentuan</a>
        </div>
    </footer>
    
    <div class="modal" id="orderModal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2>Pesan Cepat</h2>
            <form id="quickOrderForm" action="https://formsubmit.co/admin@anekamarket.my.id" method="POST">
                <input type="hidden" name="_subject" value="Pesan Cepat dari Website">
                <input type="hidden" name="_captcha" value="false">
                <div class="form-group">
                    <label for="quick-name">Nama Anda</label>
                    <input type="text" id="quick-name" name="name" required>
                </div>
                <div class="form-group">
                    <label for="quick-phone">Nomor Telepon</label>
                    <input type="tel" id="quick-phone" name="phone" required>
                </div>
                <div class="form-group">
                    <label for="quick-item">Produk yang Diminati</label>
                    <input type="text" id="quick-item" name="product" required>
                </div>
                <div class="form-group">
                    <label for="quick-message">Detail Tambahan</label>
                    <textarea id="quick-message" name="message"></textarea>
                </div>
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-paper-plane"></i> Kirim Permintaan
                </button>
            </form>
        </div>
    </div>
    
    <div class="search-modal" id="searchModal">
        <div class="search-modal-content">
            <span class="close-search-modal">&times;</span>
            <input type="text" class="search-modal-input" placeholder="Cari produk, UMKM, kode..." id="searchModalInput">
            <div class="search-results" id="searchResults">
                <p class="search-results-placeholder">Mulai ketik untuk mencari produk...</p>
            </div>
        </div>
    </div>
    
    <div class="image-modal" id="imageModal">
        <div class="image-modal-content">
            <span class="close-image-modal">&times;</span>
            <img id="zoomedImage" src="" alt="Zoomed Image">
        </div>
    </div>

    <div class="offer-notification" id="offerNotification">
        <span class="close-notification" id="closeNotification">&times;</span>
        
        <div class="notification-content active" id="notificationStep1">
            <h4>Punya bisnis atau usaha? ðŸš€ Ingin menjangkau lebih banyak pelanggan?</h4>
            <div class="notification-buttons">
                <button class="notification-btn btn-no" data-action="close">Tidak</button>
                <button class="notification-btn btn-yes" data-action="next">Iya, Tentu</button>
            </div>
        </div>
        
        <div class="notification-content" id="notificationStep2">
            <h4>Tertarik mendaftarkan usaha Anda di Anekamarket secara GRATIS dan tanpa komisi?</h4>
            <div class="notification-buttons">
                <button class="notification-btn btn-no" data-action="close">Lain Kali</button>
                <button class="notification-btn btn-yes" data-action="register">Iya, Saya Mau</button>
            </div>
        </div>
    </div>
    
    <audio id="buttonSound" src="https://raw.githubusercontent.com/LenteraKarya/Lentera-Karya/main/assets/audio/audiotombol.mp3"></audio>
    
    <script>
        // --- DATA PRODUK (DIAMBIL DARI products.js) ---
        const products = [
            {
                id: "AWF-2025-2575",
                category: "livestock",
                type: "promo",
                seller: {
                    name: "Ardiwillis Farm",
                    link: "https://www.anekamarket.my.id/ardiwillisfarm" // URL Diperbarui
                },
                badge: {
                    text: "Promosi",
                    type: "promo"
                },
                mainImage: "https://i.imgur.com/pKLE9EY.jpeg",
                title: "Paket Lengkap Ternak Ayam Ardiwilis",
                code: "AWF-2025-2575",
                price: 8000,
                originalPrice: 10000,
                discount: "10%",
                priceVariations: [
                    { name: "Ecer (per ekor)", price: 8000 },
                    { name: "10 ekor", price: 75000 },
                    { name: "100 ekor", price: 700000 }
                ],
                units: ["pcs", "kg", "biji", "ekor"],
                defaultUnit: "ekor",
                details: {
                    description: "Ardiwillis Farm menyediakan produk unggulan peternakan ayam berkualitas tinggi. Kami menyediakan telur tetas fertil dengan daya tetas tinggi, DOC (Day Old Chicken) berbagai strain unggul, ayam karkas segar, dan ayam bakar siap saji dengan bumbu khas. Semua produk dihasilkan dari peternakan yang dikelola secara profesional dengan standar kesehatan dan kebersihan tinggi. (Note: Harga tersebut bukan harga tetap, & bisa berubah)",
                    images: [
                        "https://i.imgur.com/pAygjAZ.jpeg",
                        "https://i.imgur.com/XRMPBhw.jpeg",
                        "https://i.imgur.com/K5m75Rq.jpeg",
                        "https://i.imgur.com/coJadaj.jpeg"
                    ],
                    specs: [
                        { label: "Kode Produk", value: "AWF-2025-2575" },
                        { label: "Gerai", value: "Ardiwillis Farm" },
                        { label: "Jenis", value: "Ayam Pedaging" },
                        { label: "Usia", value: "DOC (1 hari)" },
                        { label: "Strain", value: "Cobb 500" },
                        { label: "Garansi", value: "Hidup sampai diterima" },
                        { label: "Minimal Order", value: "10 ekor" },
                        { label: "Catatan", value: "Harga bisa berubah sewaktu-waktu" }
                    ]
                },
                contact: {
                    whatsapp: "6285258544543",
                    phone: "+6285258544543"
                }
            },
            {
                id: "NS-2025-3348",
                category: "food",
                type: "promo",
                seller: {
                    name: "Niki Sae",
                    link: "https://www.anekamarket.my.id/nikisae" // URL Diperbarui
                },
                badge: {
                    text: "Promo Spesial",
                    type: "promo"
                },
                mainImage: "https://i.imgur.com/y8r14Z3.jpeg",
                title: "Promo Frozen Food Homemade Niki Sae",
                code: "NS-2025-3348",
                price: 12000,
                originalPrice: 15000,
                discount: "20% OFF",
                priceVariations: [
                    { name: "Pempek", price: 12000, original: 15000 },
                    { name: "Tahu Walik", price: 11000, original: 13750 },
                    { name: "Nugget Ikan/Ayam", price: 12000, original: 15000 },
                    { name: "Dragon Stick", price: 12000, original: 15000 },
                    { name: "Otak-Otak Ikan", price: 12000, original: 15000 }
                ],
                units: ["pcs", "pack", "set", "lusin"],
                defaultUnit: "pcs",
                details: {
                    description: "<strong>PROMO SPESIAL!</strong> Niki Sae dari Dapur Yunna menghadirkan promo frozen food homemade dengan kualitas terbaik. Semua produk dibuat dengan bahan pilihan dan teknik khusus untuk menjamin cita rasa autentik. Produk kami termasuk Pempek, Tahu Walik, Otak-Otak Ikan, Nugget Ikan dan Ayam, serta Dragon Stick. Setiap produk dibuat dengan standar kebersihan tinggi dan rasa yang konsisten. Nikmati diskon spesial untuk pembelian selama periode promo!",
                    images: [
                        "https://i.imgur.com/RP8HTMb.jpeg",
                        "https://i.imgur.com/GWXfEGJ.jpeg",
                        "https://i.imgur.com/WSB6cXr.jpeg",
                        "https://i.imgur.com/ubU63gJ.jpeg" 
                    ],
                    specs: [
                        { label: "Kode Promo", value: "NS-2025-3348" },
                        { label: "Nama UMKM", value: "Niki Sae Pempek dan Tahu walik" },
                        { label: "Pemilik", value: "Yuliana Mulyaningtyas" },
                        { label: "Alamat", value: "Perum Graha Sultan Raya 1 blok G. 61, Panji" },
                        { label: "Kontak", value: "085731247566" },
                        { label: "Media Sosial", value: "Belum tersedia" },
                        { label: "Daftar Promo", value: "â€¢ Pempek <s>Rp15.000</s> <strong>Rp12.000</strong> (20% OFF)<br>â€¢ Tahu Walik <s>Rp13.750</s> <strong>Rp11.000</strong> (20% OFF)<br>â€¢ Nugget Ikan/Ayam <s>Rp15.000</s> <strong>Rp12.000</strong> (20% OFF)<br>â€¢ Dragon Stick <s>Rp15.000</s> <strong>Rp12.000</strong> (20% OFF)<br>â€¢ Otak-Otak Ikan <s>Rp15.000</s> <strong>Rp12.000</strong> (20% OFF)" },
                        { label: "Periode Promo", value: "Periode Promo sewaktu-waktu tidak berlaku" },
                        { label: "Catatan", value: "â€¢ Harga normal berlaku setelah periode promo berakhir<br>â€¢ Minimal pembelian 5 pcs per item<br>â€¢ Free ongkir untuk pembelian di atas Rp100.000 (area tertentu)" }
                    ]
                },
                contact: {
                    whatsapp: "6285731247566",
                    phone: "+6285731247566"
                }
            },
            {
                id: "PRD-2025-2688",
                category: "fishery",
                type: "promo",
                seller: {
                    name: "PRADIPA",
                    link: "https://www.anekamarket.my.id/pradipa" // URL Diperbarui
                },
                badge: {
                    text: "Promosi",
                    type: "promo"
                },
                mainImage: "https://i.imgur.com/ru1FKXW.jpeg",
                title: "Produk Hasil Laut Segar Pradipa",
                code: "PRD-2025-2688",
                price: 30000,
                originalPrice: null,
                discount: null,
                priceVariations: [
                    { name: "Ikan Bogek/Mendut", price: 35000 },
                    { name: "Ikan Mangla/Swangi", price: 30000 },
                    { name: "Ikan Sebelah/Sulfis", price: 35000 }
                ],
                units: ["kg", "ekor", "pack"],
                defaultUnit: "kg",
                details: {
                    description: "PRADIPA menghadirkan hasil laut segar langsung dari perairan Panarukan. Kami menyediakan berbagai jenis ikan berkualitas tinggi yang ditangkap dengan metode ramah lingkungan. Setiap produk kami melalui proses seleksi ketat untuk memastikan kesegaran dan kualitas terbaik untuk pelanggan. Dengan pengalaman bertahun-tahun di bidang hasil laut, kami berkomitmen memberikan produk terbaik dengan harga kompetitif.",
                    images: [
                       "https://i.imgur.com/n2AkesD.jpeg",
                        "https://i.imgur.com/tupfVCl.jpeg",
                        "https://i.imgur.com/VhfoAsv.png"
                    ],
                    specs: [
                        { label: "Kode Produk", value: "PRD-2025-2688" },
                        { label: "Gerai", value: "PRADIPA" },
                        { label: "Pemilik", value: "Fajar Nur Cholis" },
                        { label: "Alamat", value: "Tanah Anyar RT 3 RW 02 Desa Kilensari, Panarukan" },
                        { label: "Kontak", value: "082334393922 | quenie89@gmail.com" },
                        { label: "Produk Unggulan", value: "Ikan Bogek/Mendut (Rp35.000/kg), Ikan Mangla/Swangi (Rp30.000/kg), Ikan Sebelah/Sulfis (Rp35.000/kg)" },
                        { label: "Catatan", value: "Harga bisa berubah sewaktu-waktu" }
                    ]
                },
                contact: {
                    whatsapp: "6282334393922",
                    phone: "+6282334393922"
                }
            },
            {
                id: "MCU-2025-2830",
                category: "snack",
                type: "promo",
                seller: {
                    name: "Mochi UMA",
                    link: "https://www.anekamarket.my.id/mochiuma" // URL Diperbarui
                },
                badge: {
                    text: "Promo Spesial",
                    type: "promo"
                },
                mainImage: "https://i.imgur.com/TPSWsZw.jpeg",
                title: "Promo Aneka Kue Lezat Mochi Uma",
                code: "MCU-2025-2830",
                price: 10000,
                originalPrice: null,
                discount: null,
                priceVariations: [
                    { name: "Pancake Durian", price: 10000 },
                    { name: "Mochi (3pcs)", price: 10000 },
                    { name: "Cireng Ayam Suwir", price: 10000 },
                    { name: "Corndog Coklat (isi 3)", price: 10000 }
                ],
                units: ["pcs", "pack", "set", "lusin"],
                defaultUnit: "pcs",
                details: {
                    description: "<strong>PROMO SPESIAL!</strong> Mochi UMA menghadirkan paket promo aneka kue lezat dengan harga spesial. Nikmati berbagai pilihan kue premium dengan diskon menarik untuk waktu terbatas. Setiap produk dibuat dengan bahan pilihan dan teknik khusus untuk menjamin cita rasa autentik. Jangan lewatkan kesempatan ini untuk menikmati kue berkualitas dengan harga terjangkau!",
                    images: [
                        "https://i.imgur.com/dlK9kfP.jpeg",
                        "https://i.imgur.com/JsXOHCO.jpeg",
                        "https://i.imgur.com/kJDDUy4.jpeg"
                    ],
                    specs: [
                        { label: "Kode Promo", value: "MCU-2025-2830" },
                        { label: "Nama UMKM", value: "Mochi UMA" },
                        { label: "Pemilik", value: "ULink" },
                        { label: "Alamat", value: "Jl. Wijaya Kusuma Samping Bidan Ika" },
                        { label: "Kontak", value: "089679013099 | nurilaneeh@gmail.com" },
                        { label: "Media Sosial", value: "TikTok @mochi.uma3" },
                        { label: "Daftar Promo", value: "â€¢ Pancake Durian hanya Rp10.000<br>â€¢ Mochi 3pcs Rp10.000<br>â€¢ Cireng Ayam Suwir Rp10.000<br>â€¢ Corndog Coklat isi 3 Rp10.000" },
                        { label: "Periode Promo", value: "Sampai 31 Agustus 2025" },
                        { label: "Catatan", value: "Harga bisa berubah sewaktu-waktu" }
                    ]
                },
                contact: {
                    whatsapp: "6289679013099",
                    phone: "+6289679013099"
                }
            }  
        ];

        document.addEventListener('DOMContentLoaded', () => {
            // Inisialisasi jsPDF
            const { jsPDF } = window.jspdf;
            
            // --- FUNGSI BARU: GENERATE STRUK PDF ---
            async function generateAndDownloadReceipt(productData, orderDetails) {
                const doc = new jsPDF();
                const transactionId = `TRX-${productData.seller.name.replace(/\s/g, '')}-${Date.now()}`;
                const logoUrl = 'https://raw.githubusercontent.com/LKS-88/anekamarket/refs/heads/main/Logo-Anekamarketku.png';

                // Fungsi untuk memuat gambar sebagai Base64
                const toDataURL = url => fetch(url)
                    .then(response => response.blob())
                    .then(blob => new Promise((resolve, reject) => {
                        const reader = new FileReader();
                        reader.onloadend = () => resolve(reader.result);
                        reader.onerror = reject;
                        reader.readAsDataURL(blob);
                    }));

                try {
                    const logoBase64 = await toDataURL(logoUrl);
                    
                    // --- HEADER ---
                    doc.addImage(logoBase64, 'PNG', 15, 12, 25, 25);
                    doc.setFontSize(16).setFont(undefined, 'bold');
                    doc.text('MARKETPLACE', 200, 20, null, null, 'right');
                    doc.setFontSize(22).setFont(undefined, 'bold');
                    doc.text('ANEKAMARKET', 200, 30, null, null, 'right');
                    doc.setLineWidth(0.5);
                    doc.line(10, 45, 200, 45);

                    // --- DETAIL TRANSAKSI ---
                    doc.setFontSize(12).setFont(undefined, 'normal');
                    doc.text(`Gerai: ${productData.seller.name}`, 15, 60);
                    doc.text(`ID Transaksi: ${transactionId}`, 15, 67);
                    doc.text(`Tanggal: ${new Date().toLocaleDateString('id-ID', { day: '2-digit', month: 'long', year: 'numeric' })}`, 200, 60, null, null, 'right');
                    doc.setLineWidth(0.2);
                    doc.line(10, 75, 200, 75);

                    doc.setFontSize(14).setFont(undefined, 'bold');
                    doc.text(orderDetails.type, 105, 85, null, null, 'center');
                    
                    doc.setFontSize(11).setFont(undefined, 'normal');
                    doc.text(`Produk: ${productData.title}`, 15, 95);
                    doc.text(`Kode Produk: ${productData.code}`, 15, 102);
                    doc.text(`Jumlah: ${orderDetails.quantity} ${orderDetails.unit}`, 15, 109);

                    doc.setFontSize(14).setFont(undefined, 'bold');
                    doc.text(`Total Harga: ${orderDetails.totalPrice}`, 15, 120);

                    if (orderDetails.type === 'PRE-ORDER') {
                        doc.text(`Uang Muka (DP): ${orderDetails.dpAmount}`, 15, 127);
                    }
                    
                    // --- QR CODE ---
                    const qr = qrcode(0, 'L');
                    qr.addData('https://www.aplikasiusaha.com');
                    qr.make();
                    const qrImgData = qr.createDataURL(4);
                    doc.addImage(qrImgData, 'PNG', 85, 140, 40, 40);
                    doc.setFontSize(10).setFont(undefined, 'italic');
                    doc.text('Scan untuk Info Aplikasi Usaha', 105, 185, null, null, 'center');

                    // --- FOOTER ---
                    doc.setLineWidth(0.5);
                    doc.line(10, 260, 200, 260);
                    doc.setFontSize(10).setFont(undefined, 'normal');
                    doc.text('Struk ini merupakan bukti pemesanan yang sah.', 105, 268, null, null, 'center');
                    doc.text('Developed by: www.anekamarket.my.id', 105, 275, null, null, 'center');

                    // --- SIMPAN PDF ---
                    doc.save(`Struk-${orderDetails.type === 'PRE-ORDER' ? 'PreOrder' : 'Pemesanan'}-${productData.code}.pdf`);

                } catch (error) {
                    console.error("Gagal membuat PDF:", error);
                    alert("Maaf, terjadi kesalahan saat membuat struk PDF. Silakan coba lagi.");
                }
            }


            // --- RENDER PRODUCTS ---
            const galleryGrid = document.getElementById('gallery-grid');
            const body = document.body;

            function formatPrice(amount) {
                return new Intl.NumberFormat('id-ID', {
                    style: 'currency',
                    currency: 'IDR',
                    minimumFractionDigits: 0
                }).format(amount).replace(/\s?IDR/g, 'Rp ');
            }
            
            function renderProducts() {
                if (typeof products === 'undefined' || !Array.isArray(products)) {
                    if(galleryGrid) {
                        galleryGrid.innerHTML = '<p style="text-align: center; color: var(--accent);">Gagal memuat data produk.</p>';
                    }
                    console.error("Variabel 'products' tidak ditemukan.");
                    return;
                }

                if (!galleryGrid) return;
                galleryGrid.innerHTML = '';
                
                const placeholderImg = "https://via.placeholder.com/400x300.png?text=Gambar+Tidak+Tersedia";
                const placeholderThumb = "https://via.placeholder.com/100x100.png?text=Error";

                products.forEach(product => {
                    const productCard = document.createElement('div');
                    productCard.className = 'gallery-item';
                    productCard.setAttribute('data-category', product.category);
                    productCard.setAttribute('data-type', product.type);
                    productCard.setAttribute('data-id', product.id);
                    productCard.id = `product-${product.id}`;


                    const priceVariationsHTML = product.priceVariations.map((v, index) => `
                        <div class="price-variation ${index === 0 ? 'active' : ''}" data-price="${v.price}">
                            <span class="price-variation-name">${v.name}</span>
                            <span class="price-variation-value">${formatPrice(v.price)}</span>
                        </div>
                    `).join('');

                    const unitOptionsHTML = product.units.map(unit => `
                        <option value="${unit}" ${unit === product.defaultUnit ? 'selected' : ''}>${unit}</option>
                    `).join('');

                    const detailImagesHTML = product.details.images.map((img, index) => `
                        <img src="${img}" alt="Thumbnail ${index + 1}" class="thumbnail" loading="lazy" onerror="this.onerror=null;this.src='${placeholderThumb}';">
                    `).join('');

                    const detailSpecsHTML = product.details.specs.map(spec => `
                        <div class="spec-item">
                            <span class="spec-label">${spec.label}:</span>
                            <span class="spec-value">${spec.value}</span>
                        </div>
                    `).join('');
                    
                    productCard.innerHTML = `
                        <a href="${product.seller.link}" target="_blank" class="gallery-badge seller">Gerai: ${product.seller.name}</a>
                        <span class="gallery-badge ${product.badge.type}">${product.badge.text}</span>
                        <div class="gallery-image-container">
                            <img src="${product.mainImage}" alt="${product.title}" class="gallery-image" loading="lazy" onerror="this.onerror=null;this.src='${placeholderImg}';">
                        </div>
                        <div class="gallery-details">
                            <h3 class="gallery-title">${product.title}</h3>
                            <div class="gallery-meta">
                                <span class="gallery-code">Kode: ${product.code}</span>
                                <span class="gallery-seller"><i class="fas fa-store"></i> ${product.seller.name}</span>
                            </div>
                            <p class="gallery-price">
                                ${formatPrice(product.price)}
                                ${product.originalPrice ? `<span class="original-price">${formatPrice(product.originalPrice)}</span>` : ''}
                                ${product.discount ? `<span class="discount">${product.discount}</span>` : ''}
                            </p>
                            
                            <div class="price-variations">${priceVariationsHTML}</div>
                            
                            <div class="quantity-selector">
                                <span class="quantity-label">Jumlah:</span>
                                <div class="quantity-controls">
                                    <button class="quantity-btn minus">-</button>
                                    <input type="number" class="quantity-input" value="1" min="1">
                                    <button class="quantity-btn plus">+</button>
                                </div>
                                <div class="unit-selector">
                                    <select class="unit-select">${unitOptionsHTML}</select>
                                </div>
                            </div>
                            
                            <div class="total-price">
                                <span class="total-price-label">Total Harga:</span>
                                <span class="total-price-value">${formatPrice(product.priceVariations[0].price)}</span>
                            </div>
                            
                            <div class="gallery-actions">
                                <button class="btn-detail">
                                    <i class="fas fa-chevron-down"></i> Detail
                                </button>
                                <a href="${product.seller.link}" target="_blank" class="btn-visit">
                                    <i class="fas fa-store-alt"></i> Kunjungi Gerai
                                </a>
                                <button class="btn-order">
                                    <i class="fas fa-shopping-cart"></i> Pesan
                                </button>
                                <button class="btn-preorder-toggle">
                                    <i class="fas fa-calendar-check"></i> Pre-Order
                                </button>
                            </div>
                            
                            <div class="preorder-form">
                                <div class="preorder-title">
                                    <i class="fas fa-money-bill-wave"></i>
                                    <span>Form Uang Muka (DP)</span>
                                </div>
                                <input type="number" class="preorder-input" placeholder="Masukkan nominal DP (minimal 40%)">
                                <p class="preorder-note">
                                    * Untuk pre-order, harap masukkan nominal uang muka minimal 40% dari total harga. 
                                    Kami akan menghubungi Anda untuk konfirmasi lebih lanjut.
                                </p>
                                <button class="btn-preorder">
                                    <i class="fas fa-paper-plane"></i> Kirim Pre-Order
                                </button>
                            </div>
                            
                            <div class="gallery-detail-expanded">
                                <div class="gallery-carousel">
                                    <img src="${product.mainImage}" alt="${product.title}" class="gallery-main-image" loading="lazy" onerror="this.onerror=null;this.src='${placeholderImg}';">
                                    <div class="gallery-thumbnails">
                                        ${detailImagesHTML}
                                    </div>
                                </div>
                                <div class="gallery-content">
                                    <p class="gallery-description">${product.details.description}</p>
                                    <div class="gallery-specs">${detailSpecsHTML}</div>
                                </div>
                                <div class="gallery-actions-expanded">
                                    <a href="https://wa.me/${product.contact.whatsapp}?text=Halo%20${encodeURIComponent(product.seller.name)},%20saya%20tertarik%20dengan%20produk%20${encodeURIComponent(product.title)}%20(${product.code})" class="btn-whatsapp" target="_blank">
                                        <i class="fab fa-whatsapp"></i> Chat via WhatsApp
                                    </a>
                                    <a href="tel:${product.contact.phone}" class="btn-call">
                                        <i class="fas fa-phone-alt"></i> Telepon Sekarang
                                    </a>
                                </div>
                            </div>
                        </div>
                    `;
                    galleryGrid.appendChild(productCard);
                });
            }

            renderProducts();

            // --- EVENT LISTENERS (using event delegation) ---
            if (galleryGrid) {
                const updateTotalPrice = (container) => {
                    const activeVariation = container.querySelector('.price-variation.active');
                    const quantityInput = container.querySelector('.quantity-input');
                    if (activeVariation && quantityInput) {
                        const price = parseFloat(activeVariation.dataset.price);
                        const quantity = parseInt(quantityInput.value, 10) || 1;
                        const totalPrice = price * quantity;
                        const totalPriceElement = container.querySelector('.total-price-value');
                        if (totalPriceElement) {
                            totalPriceElement.textContent = formatPrice(totalPrice);
                        }
                    }
                };
                
                galleryGrid.addEventListener('click', e => {
                    const target = e.target;
                    const detailsContainer = target.closest('.gallery-details');
                    if (!detailsContainer) return;

                    // Toggle Details
                    if (target.closest('.btn-detail')) {
                        const btn = target.closest('.btn-detail');
                        const expandedContent = btn.closest('.gallery-details').querySelector('.gallery-detail-expanded');
                        expandedContent.classList.toggle('active');
                        btn.classList.toggle('active');
                        btn.innerHTML = expandedContent.classList.contains('active') 
                            ? '<i class="fas fa-chevron-up"></i> Sembunyikan Detail' 
                            : '<i class="fas fa-chevron-down"></i> Detail Produk';
                        if (expandedContent.classList.contains('active')) {
                            expandedContent.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                        }
                        playButtonSound();
                    }

                    // Change Price Variation
                    if (target.closest('.price-variation')) {
                        const variation = target.closest('.price-variation');
                        variation.parentElement.querySelectorAll('.price-variation').forEach(v => v.classList.remove('active'));
                        variation.classList.add('active');
                        updateTotalPrice(detailsContainer);
                        playButtonSound();
                    }

                    // Quantity Buttons
                    if (target.closest('.quantity-btn')) {
                        const btn = target.closest('.quantity-btn');
                        const input = btn.parentElement.querySelector('.quantity-input');
                        let value = parseInt(input.value, 10);
                        if (btn.classList.contains('plus')) value++;
                        else if (btn.classList.contains('minus') && value > 1) value--;
                        input.value = value;
                        updateTotalPrice(detailsContainer);
                        playButtonSound();
                    }

                    // Thumbnail Click
                    if (target.classList.contains('thumbnail')) {
                        const mainImage = target.closest('.gallery-carousel').querySelector('.gallery-main-image');
                        mainImage.src = target.src;
                        target.parentElement.querySelectorAll('.thumbnail').forEach(t => t.classList.remove('active'));
                        target.classList.add('active');
                        playButtonSound();
                    }

                    // Image Zoom
                    if(target.classList.contains('gallery-main-image')) {
                        const zoomedImage = document.getElementById('zoomedImage');
                        zoomedImage.src = target.src;
                        document.getElementById('imageModal').classList.add('show');
                        body.style.overflow = 'hidden';
                        playButtonSound();
                    }

                    // Toggle Pre-order Form
                    if (target.closest('.btn-preorder-toggle')) {
                        const btn = target.closest('.btn-preorder-toggle');
                        const preorderForm = detailsContainer.querySelector('.preorder-form');
                        preorderForm.classList.toggle('active');
                        btn.classList.toggle('active');
                        btn.innerHTML = preorderForm.classList.contains('active')
                            ? '<i class="fas fa-times"></i> Batal Pre-Order'
                            : '<i class="fas fa-calendar-check"></i> Pre-Order';
                        playButtonSound();
                    }
                    
                    const galleryItem = target.closest('.gallery-item');
                    if (!galleryItem) return;
                    
                    const productId = galleryItem.dataset.id;
                    const productData = products.find(p => p.id === productId);

                    // --- TOMBOL PESAN SEKARANG (dengan generate PDF) ---
                    if (target.closest('.btn-order')) {
                        const quantity = detailsContainer.querySelector('.quantity-input').value;
                        const unit = detailsContainer.querySelector('.unit-select').value;
                        const totalPrice = detailsContainer.querySelector('.total-price-value').textContent;
                        
                        const orderDetails = {
                            type: 'PEMESANAN LANGSUNG',
                            quantity: quantity,
                            unit: unit,
                            totalPrice: totalPrice,
                            dpAmount: 'N/A'
                        };

                        // Generate dan unduh struk
                        generateAndDownloadReceipt(productData, orderDetails);
                        
                        // Buka WhatsApp
                        const message = `Halo, saya ingin memesan produk:\n\n*${productData.title}* (${productData.code})\n\nJumlah: ${quantity} ${unit}\nTotal Harga: ${totalPrice}\n\nStruk pemesanan sudah saya unduh dan akan saya kirimkan. Mohon info lebih lanjut mengenai cara pembayaran dan pengiriman. Terima kasih.`;
                        window.open(`https://wa.me/${productData.contact.whatsapp}?text=${encodeURIComponent(message)}`, '_blank');
                        playButtonSound();
                    }
                    
                    // --- TOMBOL PRE-ORDER (dengan generate PDF) ---
                    if (target.closest('.btn-preorder')) {
                        const dpInput = detailsContainer.querySelector('.preorder-input');
                        const dpValue = parseFloat(dpInput.value);
                        
                        if (isNaN(dpValue) || dpValue <= 0) {
                            alert('Mohon masukkan nominal DP yang valid');
                            return;
                        }

                        const totalPriceText = detailsContainer.querySelector('.total-price-value').textContent;
                        const totalPrice = parseFloat(totalPriceText.replace(/[^0-9]/g, ''));
                        
                        if (dpValue < (totalPrice * 0.4)) {
                            alert(`Uang muka minimal 40% dari total harga (${formatPrice(totalPrice * 0.4)})`);
                            return;
                        }
                        
                        const orderDetails = {
                            type: 'PRE-ORDER',
                            quantity: detailsContainer.querySelector('.quantity-input').value,
                            unit: detailsContainer.querySelector('.unit-select').value,
                            totalPrice: totalPriceText,
                            dpAmount: formatPrice(dpValue)
                        };

                        // Generate dan unduh struk
                        generateAndDownloadReceipt(productData, orderDetails);

                        // Buka WhatsApp
                        const message = `Halo, saya ingin melakukan pre-order produk:\n\n*${productData.title}* (${productData.code})\n\nTotal Harga: ${totalPriceText}\nUang Muka: ${formatPrice(dpValue)}\n\nStruk pre-order sudah saya unduh dan akan saya kirimkan. Mohon info lebih lanjut. Terima kasih.`;
                        window.open(`https://wa.me/${productData.contact.whatsapp}?text=${encodeURIComponent(message)}`, '_blank');
                        playButtonSound();
                    }
                });
                
                galleryGrid.addEventListener('change', e => {
                    if(e.target.classList.contains('quantity-input')) {
                        if (e.target.value < 1) e.target.value = 1;
                        const detailsContainer = e.target.closest('.gallery-details');
                        if (detailsContainer) {
                            updateTotalPrice(detailsContainer);
                        }
                    }
                });
            }

            // --- PENYEMPURNAAN FITUR PENCARIAN CERDAS ---
            const searchModal = document.getElementById('searchModal');
            const searchModalInput = document.getElementById('searchModalInput');
            const searchResults = document.getElementById('searchResults');
            const headerSearchInput = document.getElementById('headerSearchInput');
            const headerSearchBtn = document.getElementById('headerSearchBtn');
            const navSearchInput = document.getElementById('navSearchInput');
            const navSearchBtn = document.getElementById('navSearchBtn');

            function openSearchModal(query = '') {
                searchModal.classList.add('show');
                body.style.overflow = 'hidden';
                searchModalInput.value = query;
                searchModalInput.focus();
                performSearch(query);
            }

            function closeSearchModal() {
                searchModal.classList.remove('show');
                body.style.overflow = '';
            }

            function performSearch(query) {
                const lowerCaseQuery = query.trim().toLowerCase();

                if (lowerCaseQuery.length < 2) {
                    searchResults.innerHTML = '<p class="search-results-placeholder">Ketik minimal 2 huruf untuk mencari...</p>';
                    return;
                }

                const results = products.filter(p => {
                    const searchableText = [
                        p.title,
                        p.seller.name,
                        p.code,
                        p.details.description.replace(/<[^>]*>?/gm, ''),
                        ...p.details.specs.map(s => `${s.label} ${s.value.replace(/<[^>]*>?/gm, '')}`)
                    ].join(' ').toLowerCase();

                    return searchableText.includes(lowerCaseQuery);
                });

                displaySearchResults(results);
            }

            function displaySearchResults(results) {
                if (results.length === 0) {
                    searchResults.innerHTML = '<p class="search-results-placeholder">Produk tidak ditemukan.</p>';
                    return;
                }

                searchResults.innerHTML = results.map(p => `
                    <a href="#product-${p.id}" class="search-result-item" data-product-id="${p.id}">
                        <img src="${p.mainImage}" alt="${p.title}" class="search-result-image" onerror="this.onerror=null;this.src='https://via.placeholder.com/60x60.png?text=Error';">
                        <div class="search-result-info">
                            <h4>${p.title}</h4>
                            <p>oleh ${p.seller.name} (Kode: ${p.code})</p>
                        </div>
                    </a>
                `).join('');
            }
            
            [headerSearchInput, navSearchInput].forEach(input => {
                input.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        openSearchModal(input.value);
                    }
                });
            });
            
            [headerSearchBtn, navSearchBtn].forEach(button => {
                button.addEventListener('click', (e) => {
                    e.preventDefault();
                    const input = button.previousElementSibling;
                    openSearchModal(input.value);
                });
            });
            
            searchModalInput.addEventListener('input', () => {
                performSearch(searchModalInput.value);
            });
            
            searchResults.addEventListener('click', (e) => {
                const link = e.target.closest('.search-result-item');
                if (link) {
                    e.preventDefault();
                    const targetId = link.getAttribute('href');
                    const targetElement = document.querySelector(targetId);
                    if (targetElement) {
                        closeSearchModal();
                        setTimeout(() => {
                           window.scrollTo({
                                top: targetElement.offsetTop - 100,
                                behavior: 'smooth'
                            });
                        }, 100); 
                    }
                }
            });

            // --- GENERAL PAGE SCRIPT ---
            const bgMusic = document.getElementById('bgMusic');
            if (bgMusic) {
                bgMusic.volume = 0.3;
                let played = false;
                const playMusic = () => {
                    if (!played) {
                        bgMusic.play().then(() => { played = true; }).catch(() => {});
                    }
                };
                playMusic();
                document.body.addEventListener('click', playMusic, { once: true });
                document.body.addEventListener('touchstart', playMusic, { once: true });
            }

            const particlesContainer = document.getElementById('particles');
            if (particlesContainer) {
                for (let i = 0; i < 40; i++) {
                    const particle = document.createElement('div');
                    particle.classList.add('particle');
                    const size = Math.random() * 6 + 2;
                    particle.style.width = `${size}px`;
                    particle.style.height = `${size}px`;
                    particle.style.left = `${Math.random() * 100}%`;
                    particle.style.animationDuration = `${Math.random() * 15 + 15}s`;
                    particle.style.animationDelay = `${Math.random() * 10}s`;
                    particlesContainer.appendChild(particle);
                }
            }
            
            const navbar = document.getElementById('navbar');
            window.addEventListener('scroll', () => {
                if (navbar) {
                    navbar.classList.toggle('scrolled', window.scrollY > 50);
                }
            });

            const mobileMenuToggle = document.getElementById('mobileMenuToggle');
            const navLinks = document.getElementById('navLinks');
            if (mobileMenuToggle && navLinks) {
                mobileMenuToggle.addEventListener('click', () => {
                    navLinks.classList.toggle('active');
                    mobileMenuToggle.innerHTML = navLinks.classList.contains('active') ? '<i class="fas fa-times"></i>' : '<i class="fas fa-bars"></i>';
                    playButtonSound();
                });
                navLinks.addEventListener('click', (e) => {
                    if (e.target.tagName === 'A') {
                        navLinks.classList.remove('active');
                        mobileMenuToggle.innerHTML = '<i class="fas fa-bars"></i>';
                    }
                });
            }

            const searchToggle = document.getElementById('searchToggle');
            const navSearch = document.getElementById('navSearch');
            if(searchToggle && navSearch) {
                searchToggle.addEventListener('click', () => {
                    navSearch.classList.toggle('active');
                    playButtonSound();
                });
            }
            
            const productCategories = document.querySelector('.product-categories');
            const categoryTabs = document.querySelector('.category-tabs');
            let activeCategory = 'all';
            let activeType = 'all';

            function applyFilters() {
                document.querySelectorAll('.gallery-item').forEach(item => {
                    const itemCategory = item.dataset.category;
                    const itemType = item.dataset.type;
                    const categoryMatch = activeCategory === 'all' || itemCategory === activeCategory;
                    const typeMatch = activeType === 'all' || itemType === activeType;
                    item.style.display = (categoryMatch && typeMatch) ? 'block' : 'none';
                });
            }

            if (productCategories) {
                productCategories.addEventListener('click', e => {
                    if (e.target.classList.contains('product-category-btn')) {
                        productCategories.querySelectorAll('.product-category-btn').forEach(btn => btn.classList.remove('active'));
                        e.target.classList.add('active');
                        activeCategory = e.target.dataset.category;
                        applyFilters();
                        playButtonSound();
                    }
                });
            }

            if (categoryTabs) {
                categoryTabs.addEventListener('click', e => {
                    if (e.target.classList.contains('category-btn')) {
                        categoryTabs.querySelectorAll('.category-btn').forEach(btn => btn.classList.remove('active'));
                        e.target.classList.add('active');
                        activeType = e.target.dataset.type;
                        applyFilters();
                        playButtonSound();
                    }
                });
            }
            
            const contactForm = document.getElementById('contactForm');
            if (contactForm) {
                contactForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    alert('Fitur ini sedang dalam pengembangan.');
                    playButtonSound();
                });
            }
            
            const orderModal = document.getElementById('orderModal');
            const quickOrderBtn = document.getElementById('quick-order');
            if (orderModal && quickOrderBtn) {
                quickOrderBtn.addEventListener('click', () => {
                    orderModal.classList.add('show');
                    body.style.overflow = 'hidden';
                    playButtonSound();
                });
            }
            
            document.querySelectorAll('.modal, .image-modal, .search-modal').forEach(modal => {
                modal.addEventListener('click', (e) => {
                    if (e.target === modal || e.target.classList.contains('close-modal') || e.target.classList.contains('close-image-modal') || e.target.classList.contains('close-search-modal')) {
                        modal.classList.remove('show');
                        body.style.overflow = '';
                    }
                });
            });

            const buttonSound = document.getElementById('buttonSound');
            function playButtonSound() {
                if(buttonSound) {
                    buttonSound.currentTime = 0;
                    buttonSound.play().catch(() => {});
                }
            }

            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function(e) {
                    if (this.getAttribute('href') !== '#' && !this.closest('.search-result-item')) { 
                        e.preventDefault();
                        const target = document.querySelector(this.getAttribute('href'));
                        if (target) {
                            window.scrollTo({
                                top: target.offsetTop - 80,
                                behavior: 'smooth'
                            });
                        }
                    }
                });
            });
            
            // --- LOGIKA NOTIFIKASI PENAWARAN ---
            const offerNotification = document.getElementById('offerNotification');
            const step1 = document.getElementById('notificationStep1');
            const step2 = document.getElementById('notificationStep2');

            const showNotification = () => {
                if (!sessionStorage.getItem('offerDismissed')) {
                    offerNotification.classList.add('show');
                }
            };
            
            const hideNotification = () => {
                offerNotification.classList.remove('show');
                sessionStorage.setItem('offerDismissed', 'true');
            };
            
            setTimeout(showNotification, 5000);

            offerNotification.addEventListener('click', (e) => {
                const target = e.target;

                if (target.id === 'closeNotification') {
                    hideNotification();
                }

                if (target.matches('.notification-btn')) {
                    const action = target.dataset.action;
                    
                    if (action === 'close') {
                        hideNotification();
                    } else if (action === 'next') {
                        step1.classList.remove('active');
                        step2.classList.add('active');
                    } else if (action === 'register') {
                        window.open('https://anekamarket.github.io/formulir/', '_blank');
                        hideNotification();
                    }
                }
            });
        });
    </script>
</body>
</html>
