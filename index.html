<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, minimum-scale=1.0">
    <meta name="description" content="ANEKAMARKET - Platform jual beli online terpercaya untuk semua kebutuhan Anda. Dekorasi, handmade, dan souvenir berkualitas.">
    <meta name="keywords" content="jual beli online, situbondo, dekorasi, handmade, souvenir">
    <meta name="author" content="ANEKAMARKET">
    <meta property="og:title" content="ANEKAMARKET | Platform Jual Beli Online Terpercaya">
    <meta property="og:description" content="Semua Bisa Jualan & Semua Bisa Pesan - Platform lengkap untuk kebutuhan jual beli online Anda">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://s.id/anekamarket">
    <meta property="og:image" content="https://raw.githubusercontent.com/LKS-88/anekamarket/refs/heads/main/Logo-Anekamarketku.png">
    <title>ANEKAMARKET | Platform Jual Beli Online Terpercaya</title>
    
    <link rel="stylesheet" href="style.css">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="icon" href="https://raw.githubusercontent.com/LKS-88/anekamarket/refs/heads/main/Logo-Anekamarketku.png" type="image/png">
</head>
<body>
    <audio id="bgMusic" loop autoplay>
        <source src="https://raw.githubusercontent.com/Musikwebsite.mp3" type="audio/mpeg">
    </audio>
    
    <div class="particles" id="particles"></div>
    
    <header id="home">
        <div class="header-overlay"></div>
        <div class="header-content">
            <div class="logo">
                <img src="https://raw.githubusercontent.com/LKS-88/anekamarket/refs/heads/main/Logo-Anekamarketku.png" alt="ANEKAMARKET Logo">
                <span>ANEKAMARKET</span>
            </div>
            <p class="tagline">Semua Bisa Jualan & Semua Bisa Pesan</p>
            
            <div class="header-search">
                <input type="text" id="headerSearchInput" placeholder="Cari produk atau layanan...">
                <button id="headerSearchBtn"><i class="fas fa-search"></i></button>
            </div>
            
            <div class="header-buttons">
                <a href="#gallery" class="btn btn-primary">
                    <i class="fas fa-images"></i> Lihat Karya & Jualan Kami
                </a>
                <a href="#contact" class="btn btn-outline">
                    <i class="fas fa-envelope"></i> Hubungi Kami
                </a>
            </div>
            <a href="#services" class="scroll-down">
                <i class="fas fa-chevron-down"></i>
            </a>
        </div>
    </header>
    
    <nav id="navbar">
        <div class="nav-container">
            <a href="#" class="nav-logo">
                <img src="https://raw.githubusercontent.com/LKS-88/anekamarket/refs/heads/main/Logo-Anekamarketku.png" alt="ANEKAMARKET Logo">
                <span>ANEKAMARKET</span>
            </a>
            
            <div class="nav-search" id="navSearch">
                <input type="text" placeholder="Cari produk atau layanan...">
                <button><i class="fas fa-search"></i></button>
            </div>
            
            <button class="search-toggle" id="searchToggle">
                <i class="fas fa-search"></i>
            </button>
            
            <button class="mobile-menu-toggle" id="mobileMenuToggle">
                <i class="fas fa-bars"></i>
            </button>
            
            <div class="nav-links" id="navLinks">
                <a href="#home">Beranda</a>
                <a href="#services">Layanan</a>
                <a href="#gallery">Galeri</a>
                <a href="#contact">Kontak</a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <section class="services" id="services">
            <h2 class="section-title">Layanan Kami</h2>
            <div class="services-grid">
                <div class="service-card">
                    <div class="service-icon">
                        <i class="fas fa-calendar-alt"></i>
                    </div>
                    <h3 class="service-title">Jasa Sewa</h3>
                    <p>Pilihan sewa fleksibel untuk dekorasi, peralatan, dan berbagai kebutuhan acara Anda.</p>
                </div>
                <div class="service-card">
                    <div class="service-icon">
                        <i class="fas fa-bullhorn"></i>
                    </div>
                    <h3 class="service-title">Solusi Promosi</h3>
                    <p>Material pemasaran kreatif dan strategi untuk meningkatkan visibilitas merek produk Anda.</p>
                </div>
            </div>
        </section>
        
        <section class="gallery" id="gallery">
            <h2 class="section-title">Galeri Kami</h2>
            <div class="gallery-intro">
                <p>Jelajahi koleksi karya dan layanan premium kami. Klik "Detail" untuk melihat lebih banyak gambar dan informasi.</p>
                
                <div class="product-categories">
                    <button class="product-category-btn active" data-category="all">Semua Kategori</button>
                    <button class="product-category-btn" data-category="food">Makanan & Minuman</button>
                    <button class="product-category-btn" data-category="snack">Kue & Cemilan</button>
                    <button class="product-category-btn" data-category="construction">Alat Konstruksi</button>
                    <button class="product-category-btn" data-category="office">Alat Kantor</button>
                    <button class="product-category-btn" data-category="household">Alat Rumah Tangga</button>
                    <button class="product-category-btn" data-category="software">Software Aplikasi</button>
                    <button class="product-category-btn" data-category="electronics">Elektronik</button>
                    <button class="product-category-btn" data-category="fishery">Perikanan</button>
                    <button class="product-category-btn" data-category="livestock">Peternakan</button>
                    <button class="product-category-btn" data-category="agriculture">Pertanian</button>
                </div>
                
                <div class="category-tabs">
                    <button class="category-btn active" data-type="all">Semua</button>
                    <button class="category-btn" data-type="rental">Sewa</button>
                    <button class="category-btn" data-type="promo">Promosi</button>
                </div>
            </div>
            
            <div class="gallery-grid" id="gallery-grid"></div>   
        </section>

        <section class="contact" id="contact">
            <h2 class="section-title">Hubungi Kami</h2>
            <div class="contact-container">
                <div class="contact-info">
                    <h3>Informasi Kontak</h3>
                    <div class="contact-detail">
                        <i class="fas fa-map-marker-alt contact-icon"></i>
                        <div class="contact-text">
                            <h4>Alamat</h4>
                            <p>Jl. PB Sudirman, Desa Wringin Anom<br>Kec. Panarukan, Kab. Situbondo (68351)<br>Provinsi Jawa Timur</p>
                        </div>
                    </div>
                    <div class="contact-detail">
                        <i class="fas fa-phone-alt contact-icon"></i>
                        <div class="contact-text">
                            <h4>Telepon</h4>
                            <p>+6285647709114</p>
                        </div>
                    </div>
                    <div class="contact-detail">
                        <i class="fas fa-envelope contact-icon"></i>
                        <div class="contact-text">
                            <h4>Email</h4>
                            <p>admin@anekamarket.my.id</p>
                        </div>
                    </div>
                    <div class="contact-detail">
                        <i class="fas fa-clock contact-icon"></i>
                        <div class="contact-text">
                            <h4>Jam Operasional Admin</h4>
                            <p>Senin - Jumat: 09.00 - 16.00<br>Sabtu & Minggu: 07.00 - 19.00</p>
                        </div>
                    </div>
                </div>
                <div class="contact-form">
                    <h3>Kirim Pesan</h3>
                    <div id="formStatus" class="form-status" style="display: none;"></div>
                    <form id="contactForm" action="https://formsubmit.co/admin@anekamarket.my.id" method="POST">
                        <input type="hidden" name="_captcha" value="false">
                        <input type="hidden" name="_next" value="https://yourwebsite.com/thank-you.html">
                        <input type="hidden" name="_template" value="table">
                        <div class="form-group">
                            <label for="name">Nama Anda</label>
                            <input type="text" id="name" name="name" required>
                        </div>
                        <div class="form-group">
                            <label for="email">Alamat Email</label>
                            <input type="email" id="email" name="email" required>
                        </div>
                        <div class="form-group">
                            <label for="phone">Nomor Telepon</label>
                            <input type="tel" id="phone" name="phone" required>
                        </div>
                        <div class="form-group">
                            <label for="subject">Subjek</label>
                            <select id="subject" name="subject" required>
                                <option value="" disabled selected>Pilih subjek</option>
                                <option value="general">Pertanyaan Umum</option>
                                <option value="order">Pemesanan Produk</option>
                                <option value="rental">Pertanyaan Sewa</option>
                                <option value="promo">Layanan Promosi</option>
                                <option value="other">Lainnya</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="message">Pesan</label>
                            <textarea id="message" name="message" required></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary" id="submitBtn">
                            <i class="fas fa-paper-plane"></i> Kirim Pesan
                        </button>
                    </form>
                </div>
            </div>
        </section>
    </div>
    
    <div class="contact-bar">
        <a href="https://wa.me/6285647709114" class="contact-btn whatsapp" target="_blank" aria-label="Hubungi via WhatsApp">
            <i class="fab fa-whatsapp"></i>
        </a>
        <a href="tel:+6285647709114" class="contact-btn phone" aria-label="Telepon Kami">
            <i class="fas fa-phone"></i>
        </a>
        <button class="contact-btn order" id="quick-order" aria-label="Pesan Cepat">
            <i class="fas fa-shopping-cart"></i>
        </button>
    </div>
    
    <footer>
        <div class="footer-container">
            <div class="footer-col footer-about">
                <div class="footer-logo">
                    <img src="https://raw.githubusercontent.com/LKS-88/anekamarket/refs/heads/main/Logo-Anekamarketku.png" alt="ANEKAMARKET Logo">
                    <span>ANEKAMARKET</span>
                </div>
                <p>Menyediakan produk kerajinan tangan berkualitas tinggi, jasa sewa, dan solusi promosi sejak tahun 2025. Komitmen kami adalah memberikan pengalaman berbelanja online yang menyenangkan dan memuaskan.</p>
            </div>
            
            <div class="footer-col">
                <h3>Tautan Cepat</h3>
                <ul class="footer-links">
                    <li><a href="#home">Beranda</a></li>
                    <li><a href="#services">Layanan</a></li>
                    <li><a href="#gallery">Galeri</a></li>
                    <li><a href="#contact">Kontak</a></li>
                </ul>
            </div>
            
            <div class="footer-col">
                <h3>Newsletter</h3>
                <p>Berlangganan newsletter kami untuk mendapatkan update produk terbaru dan penawaran spesial.</p>
                <form class="newsletter-form">
                    <input type="email" placeholder="Alamat email Anda" required>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-envelope"></i> Berlangganan
                    </button>
                </form>
            </div>
        </div>
        
        <div class="copyright">
            &copy; 2025 ANEKAMARKET. Semua hak dilindungi. | <a href="#">Kebijakan Privasi</a> | <a href="#">Syarat & Ketentuan</a>
        </div>
    </footer>
    
    <div class="modal" id="orderModal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2>Pesan Cepat</h2>
            <form id="quickOrderForm" action="https://formsubmit.co/admin@anekamarket.my.id" method="POST">
                <input type="hidden" name="_subject" value="Pesan Cepat dari Website">
                <input type="hidden" name="_captcha" value="false">
                <div class="form-group">
                    <label for="quick-name">Nama Anda</label>
                    <input type="text" id="quick-name" name="name" required>
                </div>
                <div class="form-group">
                    <label for="quick-phone">Nomor Telepon</label>
                    <input type="tel" id="quick-phone" name="phone" required>
                </div>
                <div class="form-group">
                    <label for="quick-item">Produk yang Diminati</label>
                    <input type="text" id="quick-item" name="product" required>
                </div>
                <div class="form-group">
                    <label for="quick-message">Detail Tambahan</label>
                    <textarea id="quick-message" name="message"></textarea>
                </div>
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-paper-plane"></i> Kirim Permintaan
                </button>
            </form>
        </div>
    </div>
    
    <div class="search-modal" id="searchModal">
        <div class="search-modal-content">
            <span class="close-search-modal">&times;</span>
            <input type="text" class="search-modal-input" placeholder="Cari produk atau layanan..." id="searchModalInput">
            <div class="search-results" id="searchResults">
                </div>
        </div>
    </div>
    
    <div class="image-modal" id="imageModal">
        <div class="image-modal-content">
            <span class="close-image-modal">&times;</span>
            <img id="zoomedImage" src="" alt="Zoomed Image">
        </div>
    </div>
    
    <audio id="buttonSound" src="https://raw.githubusercontent.com/LenteraKarya/Lentera-Karya/main/assets/audio/audiotombol.mp3"></audio>
    
    <script src="products.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- RENDER PRODUCTS ---
            const galleryGrid = document.getElementById('gallery-grid');
            const body = document.body;

            function formatPrice(amount) {
                return new Intl.NumberFormat('id-ID', {
                    style: 'currency',
                    currency: 'IDR',
                    minimumFractionDigits: 0
                }).format(amount).replace(/\s?IDR/g, 'Rp ');
            }
            
            function renderProducts() {
                if (typeof products === 'undefined' || !Array.isArray(products)) {
                    if(galleryGrid) {
                        galleryGrid.innerHTML = '<p style="text-align: center; color: var(--accent);">Gagal memuat data produk. Pastikan file products.js terhubung.</p>';
                    }
                    console.error("Variabel 'products' tidak ditemukan. Pastikan file products.js dimuat dengan benar sebelum script.js.");
                    return;
                }

                if (!galleryGrid) return;
                galleryGrid.innerHTML = '';
                
                // Variabel untuk placeholder jika gambar error
                const placeholderImg = "https://via.placeholder.com/400x300.png?text=Gambar+Tidak+Tersedia";
                const placeholderThumb = "https://via.placeholder.com/100x100.png?text=Error";

                products.forEach(product => {
                    const productCard = document.createElement('div');
                    productCard.className = 'gallery-item';
                    productCard.setAttribute('data-category', product.category);
                    productCard.setAttribute('data-type', product.type);
                    productCard.setAttribute('data-id', product.id);

                    const priceVariationsHTML = product.priceVariations.map((v, index) => `
                        <div class="price-variation ${index === 0 ? 'active' : ''}" data-price="${v.price}">
                            <span class="price-variation-name">${v.name}</span>
                            <span class="price-variation-value">${formatPrice(v.price)}</span>
                        </div>
                    `).join('');

                    const unitOptionsHTML = product.units.map(unit => `
                        <option value="${unit}" ${unit === product.defaultUnit ? 'selected' : ''}>${unit}</option>
                    `).join('');

                    // PERBAIKAN: Menambahkan onerror untuk menangani gambar yang rusak
                    const detailImagesHTML = product.details.images.map((img, index) => `
                        <img src="${img}" alt="Thumbnail ${index + 1}" class="thumbnail" loading="lazy" onerror="this.onerror=null;this.src='${placeholderThumb}';">
                    `).join('');

                    const detailSpecsHTML = product.details.specs.map(spec => `
                        <div class="spec-item">
                            <span class="spec-label">${spec.label}:</span>
                            <span class="spec-value">${spec.value}</span>
                        </div>
                    `).join('');
                    
                    // PERBAIKAN: Menghapus kelas 'lazy' dari tag <img> dan menambahkan 'onerror'
                    productCard.innerHTML = `
                        <a href="${product.seller.link}" target="_blank" class="gallery-badge seller">Gerai: ${product.seller.name}</a>
                        <span class="gallery-badge ${product.badge.type}">${product.badge.text}</span>
                        <div class="gallery-image-container">
                            <img src="${product.mainImage}" alt="${product.title}" class="gallery-image" loading="lazy" onerror="this.onerror=null;this.src='${placeholderImg}';">
                        </div>
                        <div class="gallery-details">
                            <h3 class="gallery-title">${product.title}</h3>
                            <div class="gallery-meta">
                                <span class="gallery-code">Kode: ${product.code}</span>
                                <span class="gallery-seller"><i class="fas fa-store"></i> ${product.seller.name}</span>
                            </div>
                            <p class="gallery-price">
                                ${formatPrice(product.price)}
                                ${product.originalPrice ? `<span class="original-price">${formatPrice(product.originalPrice)}</span>` : ''}
                                ${product.discount ? `<span class="discount">${product.discount}</span>` : ''}
                            </p>
                            
                            <div class="price-variations">${priceVariationsHTML}</div>
                            
                            <div class="quantity-selector">
                                <span class="quantity-label">Jumlah:</span>
                                <div class="quantity-controls">
                                    <button class="quantity-btn minus">-</button>
                                    <input type="number" class="quantity-input" value="1" min="1">
                                    <button class="quantity-btn plus">+</button>
                                </div>
                                <div class="unit-selector">
                                    <select class="unit-select">${unitOptionsHTML}</select>
                                </div>
                            </div>
                            
                            <div class="total-price">
                                <span class="total-price-label">Total Harga:</span>
                                <span class="total-price-value">${formatPrice(product.priceVariations[0].price)}</span>
                            </div>
                            
                            <div class="gallery-actions">
                                <button class="btn-detail">
                                    <i class="fas fa-chevron-down"></i> Detail Produk
                                </button>
                                <button class="btn-order">
                                    <i class="fas fa-shopping-cart"></i> Pesan Sekarang
                                </button>
                                <button class="btn-preorder-toggle">
                                    <i class="fas fa-calendar-check"></i> Pre-Order
                                </button>
                            </div>
                            
                            <div class="preorder-form">
                                <div class="preorder-title">
                                    <i class="fas fa-money-bill-wave"></i>
                                    <span>Form Uang Muka (DP)</span>
                                </div>
                                <input type="number" class="preorder-input" placeholder="Masukkan nominal DP (minimal 40%)">
                                <p class="preorder-note">
                                    * Untuk pre-order, harap masukkan nominal uang muka minimal 40% dari total harga. 
                                    Kami akan menghubungi Anda untuk konfirmasi lebih lanjut.
                                </p>
                                <button class="btn-preorder">
                                    <i class="fas fa-paper-plane"></i> Kirim Pre-Order
                                </button>
                            </div>
                            
                            <div class="gallery-detail-expanded">
                                <div class="gallery-carousel">
                                    <img src="${product.mainImage}" alt="${product.title}" class="gallery-main-image" loading="lazy" onerror="this.onerror=null;this.src='${placeholderImg}';">
                                    <div class="gallery-thumbnails">
                                        ${detailImagesHTML}
                                    </div>
                                </div>
                                <div class="gallery-content">
                                    <p class="gallery-description">${product.details.description}</p>
                                    <div class="gallery-specs">${detailSpecsHTML}</div>
                                </div>
                                <div class="gallery-actions-expanded">
                                    <a href="https://wa.me/${product.contact.whatsapp}?text=Halo%20${encodeURIComponent(product.seller.name)},%20saya%20tertarik%20dengan%20produk%20${encodeURIComponent(product.title)}%20(${product.code})" class="btn-whatsapp" target="_blank">
                                        <i class="fab fa-whatsapp"></i> Chat via WhatsApp
                                    </a>
                                    <a href="tel:${product.contact.phone}" class="btn-call">
                                        <i class="fas fa-phone-alt"></i> Telepon Sekarang
                                    </a>
                                </div>
                            </div>
                        </div>
                    `;
                    galleryGrid.appendChild(productCard);
                });
            }

            renderProducts();

            // --- EVENT LISTENERS (using event delegation) ---
            if (galleryGrid) {
                // PENYEMPURNAAN: Fungsi update total harga dipindahkan keluar agar tidak dibuat ulang terus-menerus
                const updateTotalPrice = (container) => {
                    const activeVariation = container.querySelector('.price-variation.active');
                    const quantityInput = container.querySelector('.quantity-input');
                    if (activeVariation && quantityInput) {
                        const price = parseFloat(activeVariation.dataset.price);
                        const quantity = parseInt(quantityInput.value, 10) || 1;
                        const totalPrice = price * quantity;
                        const totalPriceElement = container.querySelector('.total-price-value');
                        if (totalPriceElement) {
                            totalPriceElement.textContent = formatPrice(totalPrice);
                        }
                    }
                };
                
                galleryGrid.addEventListener('click', e => {
                    const target = e.target;
                    const detailsContainer = target.closest('.gallery-details');
                    if (!detailsContainer) return;

                    // Toggle Details
                    if (target.closest('.btn-detail')) {
                        const btn = target.closest('.btn-detail');
                        const expandedContent = btn.closest('.gallery-details').querySelector('.gallery-detail-expanded');
                        expandedContent.classList.toggle('active');
                        btn.classList.toggle('active');
                        btn.innerHTML = expandedContent.classList.contains('active') 
                            ? '<i class="fas fa-chevron-up"></i> Sembunyikan Detail' 
                            : '<i class="fas fa-chevron-down"></i> Detail Produk';
                        if (expandedContent.classList.contains('active')) {
                            expandedContent.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                        }
                        playButtonSound();
                    }

                    // Change Price Variation
                    if (target.closest('.price-variation')) {
                        const variation = target.closest('.price-variation');
                        variation.parentElement.querySelectorAll('.price-variation').forEach(v => v.classList.remove('active'));
                        variation.classList.add('active');
                        updateTotalPrice(detailsContainer);
                        playButtonSound();
                    }

                    // Quantity Buttons
                    if (target.closest('.quantity-btn')) {
                        const btn = target.closest('.quantity-btn');
                        const input = btn.parentElement.querySelector('.quantity-input');
                        let value = parseInt(input.value, 10);
                        if (btn.classList.contains('plus')) value++;
                        else if (btn.classList.contains('minus') && value > 1) value--;
                        input.value = value;
                        updateTotalPrice(detailsContainer);
                        playButtonSound();
                    }

                    // Thumbnail Click
                    if (target.classList.contains('thumbnail')) {
                        const mainImage = target.closest('.gallery-carousel').querySelector('.gallery-main-image');
                        mainImage.src = target.src;
                        target.parentElement.querySelectorAll('.thumbnail').forEach(t => t.classList.remove('active'));
                        target.classList.add('active');
                        playButtonSound();
                    }

                    // Image Zoom
                    if(target.classList.contains('gallery-main-image')) {
                        const zoomedImage = document.getElementById('zoomedImage');
                        zoomedImage.src = target.src;
                        document.getElementById('imageModal').classList.add('show');
                        body.style.overflow = 'hidden';
                        playButtonSound();
                    }

                    // Toggle Pre-order Form
                    if (target.closest('.btn-preorder-toggle')) {
                        const btn = target.closest('.btn-preorder-toggle');
                        const preorderForm = detailsContainer.querySelector('.preorder-form');
                        preorderForm.classList.toggle('active');
                        btn.classList.toggle('active');
                        btn.innerHTML = preorderForm.classList.contains('active')
                            ? '<i class="fas fa-times"></i> Batal Pre-Order'
                            : '<i class="fas fa-calendar-check"></i> Pre-Order';
                        playButtonSound();
                    }
                    
                    const galleryItem = target.closest('.gallery-item');
                    if (!galleryItem) return;
                    
                    const productId = galleryItem.dataset.id;
                    const productData = products.find(p => p.id === productId);

                    if (target.closest('.btn-order')) {
                        const quantity = detailsContainer.querySelector('.quantity-input').value;
                        const unit = detailsContainer.querySelector('.unit-select').value;
                        const totalPrice = detailsContainer.querySelector('.total-price-value').textContent;
                        
                        const message = `Halo, saya ingin memesan produk:\n\n*${productData.title}* (${productData.code})\n\nJumlah: ${quantity} ${unit}\nTotal Harga: ${totalPrice}\n\nMohon info lebih lanjut mengenai cara pembayaran dan pengiriman. Terima kasih.`;
                        window.open(`https://wa.me/${productData.contact.whatsapp}?text=${encodeURIComponent(message)}`, '_blank');
                        playButtonSound();
                    }
                    
                    if (target.closest('.btn-preorder')) {
                        const dpInput = detailsContainer.querySelector('.preorder-input');
                        const dpValue = parseFloat(dpInput.value);
                        
                        if (isNaN(dpValue) || dpValue <= 0) {
                            alert('Mohon masukkan nominal DP yang valid');
                            return;
                        }

                        const totalPriceText = detailsContainer.querySelector('.total-price-value').textContent;
                        const totalPrice = parseFloat(totalPriceText.replace(/[^0-9]/g, ''));
                        
                        if (dpValue < (totalPrice * 0.4)) {
                            alert(`Uang muka minimal 40% dari total harga (${formatPrice(totalPrice * 0.4)})`);
                            return;
                        }

                        const message = `Halo, saya ingin melakukan pre-order produk:\n\n*${productData.title}* (${productData.code})\n\nTotal Harga: ${totalPriceText}\nUang Muka: ${formatPrice(dpValue)}\n\nMohon info lebih lanjut. Terima kasih.`;
                        window.open(`https://wa.me/${productData.contact.whatsapp}?text=${encodeURIComponent(message)}`, '_blank');
                        playButtonSound();
                    }
                });
                
                // PENYEMPURNAAN: Menggunakan fungsi 'updateTotalPrice' yang sudah ada
                galleryGrid.addEventListener('change', e => {
                    if(e.target.classList.contains('quantity-input')) {
                        if (e.target.value < 1) e.target.value = 1;
                        const detailsContainer = e.target.closest('.gallery-details');
                        if (detailsContainer) {
                            updateTotalPrice(detailsContainer);
                        }
                    }
                });
            }


            // --- GENERAL PAGE SCRIPT ---
            const bgMusic = document.getElementById('bgMusic');
            if (bgMusic) {
                bgMusic.volume = 0.3;
                let played = false;
                const playMusic = () => {
                    if (!played) {
                        bgMusic.play().then(() => { played = true; }).catch(() => {});
                    }
                };
                playMusic();
                document.body.addEventListener('click', playMusic, { once: true });
                document.body.addEventListener('touchstart', playMusic, { once: true });
            }

            const particlesContainer = document.getElementById('particles');
            if (particlesContainer) {
                for (let i = 0; i < 40; i++) {
                    const particle = document.createElement('div');
                    particle.classList.add('particle');
                    const size = Math.random() * 6 + 2;
                    particle.style.width = `${size}px`;
                    particle.style.height = `${size}px`;
                    particle.style.left = `${Math.random() * 100}%`;
                    particle.style.animationDuration = `${Math.random() * 15 + 15}s`;
                    particle.style.animationDelay = `${Math.random() * 10}s`;
                    particlesContainer.appendChild(particle);
                }
            }
            
            const navbar = document.getElementById('navbar');
            window.addEventListener('scroll', () => {
                if (navbar) {
                    navbar.classList.toggle('scrolled', window.scrollY > 50);
                }
            });

            const mobileMenuToggle = document.getElementById('mobileMenuToggle');
            const navLinks = document.getElementById('navLinks');
            if (mobileMenuToggle && navLinks) {
                mobileMenuToggle.addEventListener('click', () => {
                    navLinks.classList.toggle('active');
                    mobileMenuToggle.innerHTML = navLinks.classList.contains('active') ? '<i class="fas fa-times"></i>' : '<i class="fas fa-bars"></i>';
                    playButtonSound();
                });
                navLinks.addEventListener('click', (e) => {
                    if (e.target.tagName === 'A') {
                        navLinks.classList.remove('active');
                        mobileMenuToggle.innerHTML = '<i class="fas fa-bars"></i>';
                    }
                });
            }

            const searchToggle = document.getElementById('searchToggle');
            const navSearch = document.getElementById('navSearch');
            if(searchToggle && navSearch) {
                searchToggle.addEventListener('click', () => {
                    navSearch.classList.toggle('active');
                    playButtonSound();
                });
            }
            
            const productCategories = document.querySelector('.product-categories');
            const categoryTabs = document.querySelector('.category-tabs');
            let activeCategory = 'all';
            let activeType = 'all';

            function applyFilters() {
                document.querySelectorAll('.gallery-item').forEach(item => {
                    const itemCategory = item.dataset.category;
                    const itemType = item.dataset.type;
                    const categoryMatch = activeCategory === 'all' || itemCategory === activeCategory;
                    const typeMatch = activeType === 'all' || itemType === activeType;
                    item.style.display = (categoryMatch && typeMatch) ? 'block' : 'none';
                });
            }

            if (productCategories) {
                productCategories.addEventListener('click', e => {
                    if (e.target.classList.contains('product-category-btn')) {
                        productCategories.querySelectorAll('.product-category-btn').forEach(btn => btn.classList.remove('active'));
                        e.target.classList.add('active');
                        activeCategory = e.target.dataset.category;
                        applyFilters();
                        playButtonSound();
                    }
                });
            }

            if (categoryTabs) {
                categoryTabs.addEventListener('click', e => {
                    if (e.target.classList.contains('category-btn')) {
                        categoryTabs.querySelectorAll('.category-btn').forEach(btn => btn.classList.remove('active'));
                        e.target.classList.add('active');
                        activeType = e.target.dataset.type;
                        applyFilters();
                        playButtonSound();
                    }
                });
            }
            
            const contactForm = document.getElementById('contactForm');
            if (contactForm) {
                contactForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    alert('Fitur ini sedang dalam pengembangan.');
                    playButtonSound();
                });
            }
            
            const orderModal = document.getElementById('orderModal');
            const quickOrderBtn = document.getElementById('quick-order');
            if (orderModal && quickOrderBtn) {
                quickOrderBtn.addEventListener('click', () => {
                    orderModal.classList.add('show');
                    body.style.overflow = 'hidden';
                    playButtonSound();
                });
            }
            
            document.querySelectorAll('.modal, .image-modal, .search-modal').forEach(modal => {
                modal.addEventListener('click', (e) => {
                    if (e.target === modal || e.target.classList.contains('close-modal') || e.target.classList.contains('close-image-modal') || e.target.classList.contains('close-search-modal')) {
                        modal.classList.remove('show');
                        body.style.overflow = '';
                    }
                });
            });

            const buttonSound = document.getElementById('buttonSound');
            function playButtonSound() {
                if(buttonSound) {
                    buttonSound.currentTime = 0;
                    buttonSound.play().catch(() => {});
                }
            }

            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function(e) {
                    if (this.getAttribute('href') !== '#') {
                        e.preventDefault();
                        const target = document.querySelector(this.getAttribute('href'));
                        if (target) {
                            window.scrollTo({
                                top: target.offsetTop - 80,
                                behavior: 'smooth'
                            });
                        }
                    }
                });
            });
        });
    </script>
</body>
</html>
