<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF--8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, minimum-scale=1.0">

    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta http-equiv="refresh" content="1200">
    
    <title>ANEKAMARKET | Platform Jual Beli UMKM, Jasa & Sewa Lokal Indonesia</title>
    <meta name="description" content="ANEKAMARKET adalah platform jual beli online untuk menemukan produk UMKM, jasa, dan sewa terbaik di seluruh Indonesia. Dukung usaha lokal mulai dari makanan, kerajinan, pertanian, hingga solusi digital.">
    <meta name="keywords" content="UMKM Indonesia, jual beli online, aneka market, produk lokal, pasar online, makanan, jasa, sewa, promosi, Situbondo, Jawa Timur, hasil tani, perikanan, aplikasi usaha, frozen food, jasa tukang, platform UMKM">
    <meta name="author" content="ANEKAMARKET">
    <link rel="canonical" href="https://anekamarket.my.id">

    <meta property="og:title" content="ANEKAMARKET | Platform Jual Beli UMKM, Jasa & Sewa Lokal Indonesia">
    <meta property="og:description" content="Temukan dan dukung ribuan produk UMKM, jasa, dan sewa dari seluruh Indonesia. Semua bisa jualan, semua bisa pesan. Majukan usaha lokal bersama ANEKAMARKET!">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://anekamarket.my.id">
    <meta property="og:image" content="https://raw.githubusercontent.com/LKS-88/anekamarket/refs/heads/main/Logo-Anekamarketku.png">
    <meta property="og:site_name" content="ANEKAMARKET">

    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Organization",
      "name": "ANEKAMARKET",
      "url": "https://anekamarket.my.id",
      "logo": "https://raw.githubusercontent.com/LKS-88/anekamarket/refs/heads/main/Logo-Anekamarketku.png",
      "contactPoint": {
        "@type": "ContactPoint",
        "telephone": "+6285647709114",
        "contactType": "Customer Service",
        "areaServed": "ID",
        "availableLanguage": "Indonesian"
      },
      "address": {
        "@type": "PostalAddress",
        "streetAddress": "Jl. PB Sudirman, Desa Wringin Anom",
        "addressLocality": "Panarukan",
        "addressRegion": "Jawa Timur",
        "postalCode": "68351",
        "addressCountry": "ID"
      },
      "sameAs": [
        "https://wa.me/6285647709114"
      ]
    }
    </script>
    
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebSite",
      "url": "https://anekamarket.my.id",
      "name": "ANEKAMARKET",
      "potentialAction": {
        "@type": "SearchAction",
        "target": {
          "@type": "EntryPoint",
          "urlTemplate": "https://anekamarket.my.id#?q={search_term_string}"
        },
        "query-input": "required name=search_term_string"
      }
    }
    </script>

    <script id="product-schema" type="application/ld+json"></script>
    
    <link rel="stylesheet" href="style.css">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="icon" href="https://raw.githubusercontent.com/LKS-88/anekamarket/refs/heads/main/Logo-Anekamarketku.png" type="image/png">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcode-generator/1.4.4/qrcode.js"></script>
    
    <style>
        /* CSS yang sudah ada tetap dipertahankan */
        /* --- [PERBAIKAN & PENYEMPURNAAN] DESAIN GALERI PRODUK --- */
        .gallery-grid {
            display: grid;
            /* [REVISI] Menggunakan grid untuk layout 2 kolom di layar besar */
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px; /* Memberi jarak antar item */
        }
        
        .gallery-item {
            /* Gaya item tetap sama, tidak perlu diubah */
        }
        
        .gallery-detail-expanded {
            display: none; 
            flex-direction: column;
            gap: 15px;
            animation: fadeIn 0.5s ease-in-out;
            overflow: hidden;
            min-height: 0;
        }
        
        /* [REVISI] Margin hanya diterapkan saat detail aktif untuk mencegah pergeseran layout */
        .gallery-detail-expanded.active {
            display: flex;
            margin-top: 15px; 
        }

        .search-modal.show { display: flex; }
        
        /* --- [PERBAIKAN & PENYEMPURNAAN] DESAIN PENCARIAN CERDAS --- */
        .search-modal-content { 
            width: 95%; 
            max-width: 700px; 
            background: #fefefe; 
            border-radius: 12px; 
            padding: 0; 
            position: relative; 
            display: flex;
            flex-direction: column;
            max-height: 90vh;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            animation: slideDown 0.4s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .search-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 25px;
            border-bottom: 1px solid #e9ecef;
            background-color: #f8f9fa;
            border-top-left-radius: 12px;
            border-top-right-radius: 12px;
        }
        .search-modal-header h2 {
            margin: 0;
            font-size: 1.3rem;
            color: #343a40;
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
        }
        .search-modal-body {
            padding: 20px 25px;
            overflow-y: auto;
            flex-grow: 1;
        }
        .search-modal-input { 
            width: 100%; 
            padding: 14px 20px; 
            font-size: 1.1rem; 
            border: 2px solid #ced4da; 
            border-radius: 8px; 
            margin-bottom: 20px; 
            transition: border-color 0.3s, box-shadow 0.3s;
            color: #212529; /* [FIX] Warna font diperbaiki agar tidak samar */
        }
        .search-modal-input::placeholder {
            color: #888; /* [FIX] Warna placeholder juga diatur */
        }
        .search-modal-input:focus {
            border-color: #007bff;
            box-shadow: 0 0 0 4px rgba(0, 123, 255, 0.2);
            outline: none;
        }
        .search-results { max-height: 400px; overflow-y: auto; margin-top: 10px; }
        .search-result-item { display: flex; align-items: center; padding: 12px; border-bottom: 1px solid #eee; text-decoration: none; color: #333; transition: background-color 0.3s; border-radius: 8px; }
        .search-result-item:hover { background-color: #f1f1f1; }
        .search-result-image { width: 60px; height: 60px; object-fit: cover; border-radius: 8px; margin-right: 15px; border: 1px solid #eee; }
        .search-result-info h4 { margin: 0 0 5px 0; font-size: 1rem; font-weight: 600; }
        .search-result-info p { margin: 0; font-size: 0.85rem; color: #666; }
        .search-results-placeholder { text-align: center; color: #888; padding: 25px; font-size: 1rem; }
        
        /* [IMPROVEMENT] Desain filter checklist */
        .search-filters {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-bottom: 15px;
        }
        .search-filters label {
            display: inline-flex; /* Menggunakan inline-flex untuk alignment ikon */
            align-items: center;
            gap: 8px; /* Jarak antara ikon dan teks */
            font-size: 0.9rem;
            background-color: #e9ecef;
            padding: 8px 16px;
            border-radius: 50px;
            cursor: pointer;
            transition: background-color 0.3s, color 0.3s, box-shadow 0.3s;
            user-select: none;
            color: #495057;
            border: 1px solid #dee2e6;
        }
        .search-filters label:hover {
            background-color: #d1dce5;
        }
        .search-filters input[type="checkbox"] {
            display: none; /* Checkbox asli disembunyikan */
        }
        .search-filters input[type="checkbox"]:checked + label {
            background-color: #007bff;
            color: white;
            border-color: #0056b3;
            box-shadow: 0 2px 8px rgba(0, 123, 255, 0.3);
        }
        
        .search-modal-footer {
            padding: 15px 25px;
            border-top: 1px solid #e9ecef;
            text-align: right;
            background-color: #f8f9fa;
            border-bottom-left-radius: 12px;
            border-bottom-right-radius: 12px;
        }
        .btn-close-modal {
            padding: 10px 20px;
            background-color: #6c757d;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
            transition: background-color 0.3s;
        }
        .btn-close-modal:hover {
            background-color: #5a6268;
        }
        
        .close-search-modal {
            font-size: 2rem;
            color: #6c757d;
            font-weight: 300;
            cursor: pointer;
            transition: color 0.3s, transform 0.3s;
            line-height: 1;
        }
        .close-search-modal:hover {
            color: #343a40;
            transform: rotate(90deg);
        }
        
        /* --- [PENYEMPURNAAN TOTAL] DESAIN NOTIFIKASI BISNIS --- */
        .offer-notification {
            position: fixed;
            bottom: 20px; /* [REVISI] Posisi disesuaikan agar lebih harmonis */
            right: 20px;
            background: linear-gradient(135deg, #ffffff 0%, #f7f9fc 100%);
            color: #333;
            padding: 25px;
            border-radius: 12px;
            border: 1px solid #eef2f7;
            box-shadow: 0 10px 40px rgba(0, 50, 100, 0.15), 0 2px 10px rgba(0, 0, 0, 0.05);
            width: 350px;
            max-width: 90vw;
            z-index: 1001;
            transform: translateX(calc(100% + 30px)); /* Animasi dari samping */
            opacity: 0;
            transition: transform 0.6s cubic-bezier(0.25, 1, 0.5, 1), opacity 0.6s ease;
            font-family: 'Poppins', sans-serif;
            overflow: hidden;
        }
        .offer-notification::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, #007bff, #28a745);
        }
        .offer-notification.show {
            transform: translateX(0);
            opacity: 1;
        }
        .offer-notification .notification-content {
            display: none;
        }
        .offer-notification .notification-content.active {
            display: block;
            animation: fadeInContent 0.5s ease-in-out forwards;
        }
        @keyframes fadeInContent {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .offer-notification h4 {
            margin: 0 0 15px 0;
            font-weight: 600;
            font-size: 1.1rem;
            line-height: 1.5;
            color: #2c3e50;
            display: flex;
            align-items: center;
        }
        .offer-notification h4 .fas {
            color: #007bff;
            margin-right: 10px;
            font-size: 1.2rem;
        }
        .offer-notification .notification-buttons {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }
        .offer-notification .notification-btn {
            flex: 1;
            padding: 10px 15px;
            border: 1px solid transparent;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            text-align: center;
        }
        .offer-notification .btn-yes {
            background-color: #007bff;
            color: white;
            border-color: #007bff;
            box-shadow: 0 4px 10px rgba(0, 123, 255, 0.2);
        }
        .offer-notification .btn-yes:hover {
            background-color: #0056b3;
            border-color: #0056b3;
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0, 123, 255, 0.3);
        }
        .offer-notification .btn-no {
            background-color: transparent;
            color: #6c757d;
            border-color: #ced4da;
        }
        .offer-notification .btn-no:hover {
            background-color: #f8f9fa;
            color: #343a40;
            border-color: #b8c2cc;
        }
        .offer-notification .close-notification {
            position: absolute;
            top: 12px;
            right: 15px;
            font-size: 24px;
            color: #adb5bd;
            cursor: pointer;
            transition: color 0.3s, transform 0.3s ease;
            line-height: 1;
        }
        .offer-notification .close-notification:hover {
            color: #343a40;
            transform: rotate(90deg);
        }
        
        /* --- [REVISI TOTAL & PERBAIKAN] LOGIKA TOMBOL DAN DESKRIPSI --- */
        .gallery-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: auto;      /* Mendorong tombol ke bagian bawah container flex */
            padding-top: 15px;     /* Memberi jarak dari konten di atasnya */
            flex-shrink: 0;        /* Mencegah tombol menyusut */
        }

        /* [REVISI] Selector diperbarui untuk semua tombol di dalam .gallery-actions */
        .gallery-actions .btn-detail, 
        .gallery-actions .btn-order, 
        .gallery-actions .btn-preorder-toggle, 
        .gallery-actions .btn-visit, 
        .gallery-actions .btn-toggle-prices,
        .gallery-actions .btn-whatsapp,
        .gallery-actions .btn-call {
            flex-grow: 1;
            min-width: 120px; /* Lebar minimum untuk tombol */
            text-decoration: none; /* Menghapus garis bawah dari link */
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px; /* Jarak antara ikon dan teks */
            font-size: 0.85rem;
            padding: 10px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        /* [BARU] Styling untuk tombol WhatsApp dan Telepon yang dipindahkan */
        .gallery-actions .btn-whatsapp {
            background-color: #25D366;
            color: white;
        }
        .gallery-actions .btn-whatsapp:hover {
            background-color: #128C7E;
            transform: translateY(-2px);
        }
        .gallery-actions .btn-call {
            background-color: #4285F4; /* Warna biru yang berbeda */
            color: white;
        }
        .gallery-actions .btn-call:hover {
            background-color: #3367D6;
            transform: translateY(-2px);
        }

        /* --- [REVISI TOTAL] SLIDER GAMBAR OTOMATIS --- */
        .gallery-image-container {
            position: relative;
            width: 100%;
            padding-top: 100%; /* Membuat container rasio 1:1 */
            overflow: hidden;
            background-color: #f0f0f0;
            border-top-left-radius: 12px;
            border-top-right-radius: 12px;
        }

        .gallery-slider-image {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            opacity: 0;
            transition: opacity 0.8s ease-in-out;
            cursor: zoom-in; /* Menunjukkan gambar bisa di-klik */
        }

        .gallery-slider-image.active {
            opacity: 1;
        }

        .slider-dots {
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 8px;
            z-index: 5;
        }

        .slider-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.6);
            border: 1px solid rgba(0, 0, 0, 0.2);
            transition: background-color 0.3s ease;
        }

        .slider-dot.active {
            background-color: #ffffff;
        }


        /* --- [PERBAIKAN & PENYEMPURNAAN] DESAIN TOMBOL CEK HARGA --- */
        .btn-toggle-prices {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.8rem;
            border-radius: 8px;
            background-color: var(--warning);
            color: var(--text);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            border: none;
            text-align: center;
            font-size: 0.9rem;
        }
        .btn-toggle-prices:hover {
            background-color: #e0a800;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 193, 7, 0.3);
        }
        .btn-toggle-prices.active {
            background-color: #dc3545;
            color: white;
        }
        .btn-toggle-prices.active:hover {
            background-color: #c82333;
        }

        /* --- [PERBAIKAN TOTAL] CSS UNTUK PEMBELIAN MULTI-ITEM --- */
        /* --- [FITUR BARU] Container untuk bagian harga yang bisa disembunyikan --- */
        .price-section-collapsible {
            display: none; /* Disembunyikan secara default */
            margin-top: 15px;
            animation: fadeIn 0.5s ease-in-out;
        }
        .price-section-collapsible.show {
            display: block; /* Ditampilkan saat class 'show' ditambahkan */
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }

        .price-variations-container {
            border: 1px solid #eee;
            border-radius: 8px;
            overflow: hidden;
        }
        .price-variation-item {
            display: grid;
            grid-template-columns: 1fr auto auto;
            align-items: center;
            padding: 12px;
            border-bottom: 1px solid #eee;
            gap: 10px;
        }
        .price-variation-item:last-child {
            border-bottom: none;
        }
        .price-variation-info {
            display: flex;
            flex-direction: column;
        }
        .price-variation-name {
            font-weight: 600;
            color: #333;
        }
        .price-variation-value {
            font-size: 0.9rem;
            color: #007bff;
        }

        .quantity-controls {
            display: flex;
            align-items: center;
        }
        .quantity-btn {
            background-color: #007bff;
            color: white;
            border: none;
            width: 28px;
            height: 28px;
            font-size: 1.2rem;
            line-height: 28px;
            font-weight: bold;
            cursor: pointer;
            border-radius: 50%;
            transition: background-color 0.2s, transform 0.1s;
        }
        .quantity-btn:hover { background-color: #0056b3; }
        .quantity-btn:active { transform: scale(0.95); }
        .quantity-input {
            width: 45px;
            text-align: center;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin: 0 5px;
            height: 28px;
            font-size: 1rem;
            font-weight: 500;
            -moz-appearance: textfield;
        }
        .quantity-input::-webkit-outer-spin-button,
        .quantity-input::-webkit-inner-spin-button {
            -webkit-appearance: none; margin: 0;
        }
        .unit-select {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #fff;
            font-family: 'Poppins', sans-serif;
            width: 100%;
            margin-top: 10px;
        }

        .total-price {
            margin-top: 15px;
            padding: 12px;
            background: linear-gradient(135deg, #e0f7fa, #b2ebf2);
            border-radius: 8px;
            text-align: center;
            border: 1px solid #4dd0e1;
        }
        .total-price-label {
            display: block;
            font-size: 0.9rem;
            color: #00796b;
            font-weight: 500;
        }
        .total-price-value {
            font-size: 1.6rem;
            font-weight: 700;
            color: #004d40;
        }
        
        /* --- [PERBAIKAN FINAL] MENCEGAH TOMBOL TERTINDIH OLEH DETAIL PRODUK --- */
        .gallery-details {
            display: flex;
            flex-direction: column;
            flex-grow: 1;
            padding: 20px;
        }
        
        .gallery-detail-expanded .gallery-content {
            overflow-y: auto;
            padding-right: 10px;
        }
        
        .gallery-description {
            word-wrap: break-word;
            white-space: pre-wrap;
        }
        
        /* --- [REVISI & PERBAIKAN] LOGIKA SEMBUNYI/TAMPILKAN TOMBOL OTOMATIS --- */
        .contact-bar {
            position: fixed;
            right: 20px;
            bottom: 20px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            transition: transform 0.4s ease-in-out;
        }
        .contact-bar.fab-hidden {
            transform: translateX(calc(100% + 20px));
        }

        /* --- [PERBAIKAN & PENYEMPURNAAN] UKURAN TOMBOL MELAYANG (FAB) --- */
        .payment-fab {
            width: 56px;
            height: 56px;
            font-size: 22px;
            transition: background-color 0.3s, transform 0.4s ease-in-out;
        }
        
        .contact-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 56px;
            height: 56px;
            margin-bottom: 12px;
            border-radius: 50%;
            color: white;
            font-size: 22px;
            text-decoration: none;
            box-shadow: 0 4px 12px rgba(0,0,0,0.25);
            border: none;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.3s;
        }
        .contact-bar .contact-btn:last-child {
            margin-bottom: 0;
        }
        .contact-btn:hover {
            transform: scale(1.1);
        }
        
        .contact-btn.whatsapp { background-color: #25D366; }
        .contact-btn.whatsapp:hover { background-color: #128C7E; }
        .contact-btn.phone { background-color: #007bff; }
        .contact-btn.phone:hover { background-color: #0056b3; }
        .contact-btn.order { background-color: #f57c00; }
        .contact-btn.order:hover { background-color: #e67e22; }
        .contact-btn.maps { background-color: #4285F4; }
        .contact-btn.maps:hover { background-color: #3367D6; }
        .contact-btn.generator { background-color: #28a745; }
        .contact-btn.generator:hover { background-color: #218838; }

        .payment-fab {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background-color: #007bff;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.25);
            z-index: 1000;
            text-decoration: none;
        }
        .payment-fab:hover {
            background-color: #0056b3;
            transform: scale(1.1);
        }
        .payment-fab.fab-hidden { 
            transform: translateX(-calc(100% + 20px));
        }
        .payment-fab::before {
            content: '';
            position: absolute;
            z-index: -1;
            left: 50%;
            top: 50%;
            transform: translateX(-50%) translateY(-50%);
            display: block;
            width: 100%;
            height: 100%;
            background-color: #007bff;
            border-radius: 50%;
            animation: pulse-animation 2.5s infinite;
        }
        @keyframes pulse-animation {
            0% {
                transform: translateX(-50%) translateY(-50%) scale(0.9);
                opacity: 0.7;
            }
            100% {
                transform: translateX(-50%) translateY(-50%) scale(2.5);
                opacity: 0;
            }
        }
        
        /* --- [FITUR BARU & PENYEMPURNAAN TAMPILAN] FORM GENERATOR --- */
        .generator-modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0; top: 0;
            width: 100%; height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.7);
            align-items: center;
            justify-content: center;
        }
        .generator-modal.show { display: flex; }
        .generator-modal-content {
            background-color: #f8f9fa;
            margin: 20px;
            padding: 0;
            border: none;
            width: 95%;
            max-width: 900px;
            border-radius: 12px;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .generator-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 25px;
            background: linear-gradient(135deg, #007bff, #0056b3);
            color: white;
            border-top-left-radius: 12px;
            border-top-right-radius: 12px;
        }
        .generator-modal-header h2 {
            margin: 0;
            font-size: 1.5rem;
            font-family: 'Playfair Display', serif;
        }
        .close-generator-modal {
            color: white;
            font-size: 32px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s;
            line-height: 1;
        }
        .close-generator-modal:hover { transform: rotate(90deg); }
        
        .generator-modal-body {
            padding: 25px;
            overflow-y: auto;
            background-color: #f8f9fa;
        }
        .generator-section {
            background-color: #ffffff;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 25px;
            border: 1px solid #dee2e6;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .generator-section h3 {
            color: #0056b3;
            margin-top: 0;
            margin-bottom: 20px;
            font-size: 1.2rem;
            border-left: 4px solid #007bff;
            padding-left: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        #productGeneratorForm { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        #productGeneratorForm .form-group { display: flex; flex-direction: column; }
        #productGeneratorForm .full-width { grid-column: 1 / -1; }
        #productGeneratorForm label { margin-bottom: 8px; font-weight: 600; color: #495057; font-size: 0.9rem; }
        #productGeneratorForm input, #productGeneratorForm select, #productGeneratorForm textarea {
            padding: 12px; font-size: 1rem; border: 1px solid #ced4da; border-radius: 5px; font-family: 'Poppins', sans-serif;
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        #productGeneratorForm input:focus, #productGeneratorForm select:focus, #productGeneratorForm textarea:focus {
            border-color: #007bff;
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.25);
            outline: none;
        }
        #productGeneratorForm textarea { resize: vertical; min-height: 120px; }
        .dynamic-list-item { display: flex; gap: 10px; margin-bottom: 10px; align-items: center; }
        .dynamic-list-item input { flex: 1; }
        .btn-remove-item { background-color: #e74c3c; color: white; border: none; width: 42px; height: 42px; border-radius: 5px; cursor: pointer; font-size: 1rem; transition: background-color 0.2s; }
        .btn-remove-item:hover { background-color: #c0392b; }
        .btn-add-item { background-color: #007bff; color: white; border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer; margin-top: 10px; transition: background-color 0.2s; font-weight: 500;}
        .btn-add-item:hover { background-color: #0056b3; }
        .btn-add-item i { margin-right: 5px; }

        .description-toolbar {
            margin-bottom: 8px;
            background-color: #e9ecef;
            padding: 5px;
            border-radius: 5px;
            display: flex;
            gap: 5px;
        }
        .toolbar-btn {
            background-color: #fff;
            border: 1px solid #ced4da;
            padding: 5px 10px;
            cursor: pointer;
            border-radius: 3px;
            font-family: sans-serif;
            font-size: 0.9rem;
            transition: background-color 0.2s;
        }
        .toolbar-btn:hover { background-color: #f1f1f1; }
        
        #generatorOutputContainer { margin-top: 25px; border-top: 2px solid #eee; padding-top: 20px; display: none; }
        .output-controls { display: flex; align-items: center; justify-content: space-between; margin-bottom: 15px; }
        .output-controls h3 { margin: 0; }
        .output-actions button { background: none; border: 1px solid #ccc; border-radius: 5px; padding: 8px 12px; cursor: pointer; margin-left: 10px; transition: background-color 0.2s; }
        .output-actions button:hover { background-color: #f0f0f0; }
        .output-actions button i { margin-right: 5px; }
        #generatedScriptWrapper { display: none; }
        #generatedScriptWrapper.visible { display: block; }
        #generatedScriptOutput {
            background-color: #2d2d2d; color: #f8f8f2; padding: 20px; border-radius: 8px;
            white-space: pre; overflow-x: auto; max-height: 400px; font-family: 'Fira Code', 'Courier New', monospace;
        }
        
        #generatorPreviewContainer {
             margin-top: 25px; border-top: 2px solid #eee; padding-top: 20px; display: none;
             background-color: #f9f9f9; padding: 20px; border-radius: 8px;
        }
        #generatorPreviewContainer h3 {
            margin-top: 0;
            color: #28a745;
        }
        #previewTarget .gallery-item {
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            transform: scale(1);
            transition: none;
            margin: 0 auto;
            max-width: 400px;
        }
        #previewTarget .gallery-item:hover {
            transform: none;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }

        .gallery-badge.service {
            background-color: #8e44ad;
            color: white;
        }
        
        .btn-visit { 
            background-color: #28a745; 
            color: white; 
            text-decoration: none; 
            font-weight: 500; 
            transition: background-color 0.3s; 
        }
        .btn-visit:hover { background-color: #218838; }

        .btn-location {
            background-color: #ff3333;
            color: white;
            border-color: #ff3333;
            transition: background-color 0.3s, border-color 0.3s;
        }
        .btn-location:hover {
            background-color: #e60000;
            border-color: #e60000;
        }
        .btn-location-disabled {
            background-color: #ff3333;
            color: white;
            cursor: not-allowed;
            border: none;
        }
        .btn-location-disabled:hover {
             background-color: #e60000;
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.6);
            align-items: center;
            justify-content: center;
        }
        .modal.show {
            display: flex;
        }
        .modal-content {
            background-color: #fefefe;
            margin: auto;
            padding: 25px 30px;
            border: 1px solid #888;
            width: 90%;
            max-width: 500px;
            border-radius: 10px;
            position: relative;
            animation: fadeInModal 0.4s ease-out;
            max-height: 90vh;
            overflow-y: auto;
        }
        @keyframes fadeInModal {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }
        .close-modal {
            color: #aaa;
            position: absolute;
            top: 10px;
            right: 20px;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        .close-modal:hover,
        .close-modal:focus {
            color: black;
            text-decoration: none;
        }
        #orderModal .form-group { margin-bottom: 15px; }
        #orderModal label { display: block; margin-bottom: 5px; font-weight: 500; }
        #orderModal input[type="text"], #orderModal input[type="tel"], #orderModal textarea {
            width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box;
        }
        
        .download-links {
            list-style: none;
            padding: 0;
            margin-top: 20px;
        }
        .download-links li {
            margin-bottom: 15px;
        }
        .download-links a {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            background-color: #f0f8ff;
            border: 1px solid #cce5ff;
            border-radius: 8px;
            text-decoration: none;
            color: #004085;
            transition: background-color 0.3s, transform 0.3s;
        }
        .download-links a:hover {
            background-color: #cce5ff;
            transform: translateY(-2px);
        }
        .download-links a i {
            font-size: 2rem;
            margin-right: 15px;
            width: 30px;
            text-align: center;
        }
         .download-links a .fab.fa-android { color: #3DDC84; }
         .download-links a .fab.fa-apple { color: #A2AAAD; }
        .download-links a span {
            font-weight: 600;
            flex-grow: 1;
        }
        .download-links a small {
            font-size: 0.8rem;
            color: #555;
        }
        .download-links li.coming-soon a {
            background-color: #f8f9fa;
            border-color: #dee2e6;
            color: #6c757d;
            cursor: not-allowed;
        }
         .download-links li.coming-soon a:hover {
             background-color: #e9ecef;
             transform: none;
         }

        .tagline {
            color: #FFFFFF;
            font-weight: 600;
            text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.8);
        }
        .tagline::before, .tagline::after {
            content: none !important;
            display: none !important;
        }

        @media (max-width: 768px) {
            #productGeneratorForm { grid-template-columns: 1fr; }
            .search-modal-header h2 { font-size: 1.1rem; }
            .search-modal-input { padding: 12px 15px; font-size: 1rem; }
            /* Memastikan grid kembali ke 1 kolom di layar kecil */
            .gallery-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <audio id="notificationSound" src="https://voca.ro/1c6gE71yCAsl" preload="auto"></audio>
    
    <audio id="bgMusic" loop autoplay>
        <source src="https://cdn.pixabay.com/audio/2022/08/04/audio_2dde6b7573.mp3" type="audio/mpeg">
    </audio>
    
    <div class="particles" id="particles"></div>
    
    <header id="home">
        <div class="header-overlay"></div>
        <div class="header-content">
            <div class="logo">
                <img src="https://raw.githubusercontent.com/LKS-88/anekamarket/refs/heads/main/Logo-Anekamarketku.png" alt="ANEKAMARKET Logo">
                <span>ANEKAMARKET</span>
            </div>
            <h1 class="tagline">Semua Bisa Jualan & Semua Bisa Pesan</h1>
            
            <div class="header-search">
                <input type="text" id="headerSearchInput" placeholder="Cari produk, UMKM, kode...">
                <button id="headerSearchBtn"><i class="fas fa-search"></i></button>
            </div>
            
            <div class="header-buttons">
                <a href="#gallery" class="btn btn-primary">
                    <i class="fas fa-images"></i> Lihat Karya & Jualan Kami
                </a>
                <a href="#" class="btn btn-primary" id="downloadAppBtn">
                    <i class="fas fa-download"></i> Download Aplikasi
                </a>
                <a href="https://www.aplikasiusaha.com" class="btn btn-outline" target="_blank">
                    <i class="fas fa-rocket"></i> Order Aplikasi
                </a>
                <a href="#contact" class="btn btn-outline">
                    <i class="fas fa-envelope"></i> Hubungi Kami
                </a>
            </div>
            <a href="#gallery" class="scroll-down">
                <i class="fas fa-chevron-down"></i>
            </a>
        </div>
    </header>
    
    <nav id="navbar">
        <div class="nav-container">
            <a href="#" class="nav-logo">
                <img src="https://raw.githubusercontent.com/LKS-88/anekamarket/refs/heads/main/Logo-Anekamarketku.png" alt="ANEKAMARKET Logo">
                <span>ANEKAMARKET</span>
            </a>
            
            <div class="nav-search" id="navSearch">
                <input type="text" id="navSearchInput" placeholder="Cari produk atau layanan...">
                <button id="navSearchBtn"><i class="fas fa-search"></i></button>
            </div>
            
            <button class="search-toggle" id="searchToggle">
                <i class="fas fa-search"></i>
            </button>
            
            <button class="mobile-menu-toggle" id="mobileMenuToggle">
                <i class="fas fa-bars"></i>
            </button>
            
            <div class="nav-links" id="navLinks">
                <a href="#home">Beranda</a>
                <a href="#gallery">Galeri</a>
                <a href="#contact">Kontak</a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        
        <section class="gallery" id="gallery">
            <h2 class="section-title">Galeri Kami</h2>
            <div class="gallery-intro">
                <p>Jelajahi koleksi karya dan layanan premium kami. Klik "Detail" untuk melihat lebih banyak gambar dan informasi.</p>
                
                <div class="product-categories">
                    <button class="product-category-btn active" data-category="all">Semua Kategori</button>
                    <button class="product-category-btn" data-category="food">Makanan & Minuman</button>
                    <button class="product-category-btn" data-category="snack">Kue & Cemilan</button>
                    <button class="product-category-btn" data-category="construction">Alat Konstruksi</button>
                    <button class="product-category-btn" data-category="office">Alat Kantor</button>
                    <button class="product-category-btn" data-category="household">Alat Rumah Tangga</button>
                    <button class="product-category-btn" data-category="software">Software Aplikasi</button>
                    <button class="product-category-btn" data-category="electronics">Elektronik</button>
                    <button class="product-category-btn" data-category="fishery">Perikanan</button>
                    <button class="product-category-btn" data-category="livestock">Peternakan</button>
                    <button class="product-category-btn" data-category="agriculture">Pertanian</button>
                </div>
                
                <div class="category-tabs">
                    <button class="category-btn active" data-type="all">Semua</button>
                    <button class="category-btn" data-type="rental">Sewa</button>
                    <button class="category-btn" data-type="promo">Promosi</button>
                    <button class="category-btn" data-type="jasa">Jasa</button>
                </div>
            </div>
            
            <div class="gallery-grid" id="gallery-grid"></div>   
        </section>

        <section class="contact" id="contact">
            <h2 class="section-title">Hubungi Kami</h2>
            <div class="contact-container">
                <div class="contact-info">
                    <h3>Informasi Kontak</h3>
                    <div class="contact-detail">
                        <i class="fas fa-map-marker-alt contact-icon"></i>
                        <div class="contact-text">
                            <h4>Alamat</h4>
                            <p>Jl. PB Sudirman, Desa Wringin Anom<br>Kec. Panarukan, Kab. Situbondo (68351)<br>Provinsi Jawa Timur</p>
                        </div>
                    </div>
                    <div class="contact-detail">
                        <i class="fas fa-phone-alt contact-icon"></i>
                        <div class="contact-text">
                            <h4>Telepon</h4>
                            <p>+6285647709114</p>
                        </div>
                    </div>
                    <div class="contact-detail">
                        <i class="fas fa-envelope contact-icon"></i>
                        <div class="contact-text">
                            <h4>Email</h4>
                            <p>admin@anekamarket.my.id</p>
                        </div>
                    </div>
                    <div class="contact-detail">
                        <i class="fas fa-clock contact-icon"></i>
                        <div class="contact-text">
                            <h4>Jam Operasional Admin</h4>
                            <p>Senin - Jumat: 09.00 - 16.00<br>Sabtu & Minggu: 07.00 - 19.00</p>
                        </div>
                    </div>
                </div>
                <div class="contact-form">
                    <h3>Kirim Pesan</h3>
                    <div id="formStatus" class="form-status" style="display: none;"></div>
                    <form id="contactForm" action="https://formsubmit.co/admin@anekamarket.my.id" method="POST">
                        <input type="hidden" name="_captcha" value="false">
                        <input type="hidden" name="_next" value="https://anekamarket.my.id/thank-you.html">
                        <input type="hidden" name="_template" value="table">
                        <div class="form-group">
                            <label for="name">Nama Anda</label>
                            <input type="text" id="name" name="name" required>
                        </div>
                        <div class="form-group">
                            <label for="email">Alamat Email</label>
                            <input type="email" id="email" name="email" required>
                        </div>
                        <div class="form-group">
                            <label for="phone">Nomor Telepon</label>
                            <input type="tel" id="phone" name="phone" required>
                        </div>
                        <div class="form-group">
                            <label for="subject">Subjek</label>
                            <select id="subject" name="subject" required>
                                <option value="" disabled selected>Pilih subjek</option>
                                <option value="general">Pertanyaan Umum</option>
                                <option value="order">Pemesanan Produk</option>
                                <option value="rental">Pertanyaan Sewa</option>
                                <option value="promo">Layanan Promosi</option>
                                <option value="other">Lainnya</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="message">Pesan</label>
                            <textarea id="message" name="message" required></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary" id="submitBtn">
                            <i class="fas fa-paper-plane"></i> Kirim Pesan
                        </button>
                    </form>
                </div>
            </div>
        </section>
    </div>
    
    <div class="contact-bar autohide-fab">
        <a href="https://wa.me/6285647709114" class="contact-btn whatsapp" target="_blank" aria-label="Hubungi via WhatsApp">
            <i class="fab fa-whatsapp"></i>
        </a>
        <a href="tel:+6285647709114" class="contact-btn phone" aria-label="Telepon Kami">
            <i class="fas fa-phone"></i>
        </a>
        <button class="contact-btn order" id="quick-order" aria-label="Pesan Cepat">
            <i class="fas fa-shopping-cart"></i>
        </button>
        <a href="https://www.anekamarket.my.id/googlemap.html" class="contact-btn maps" target="_blank" aria-label="Lihat Peta Lokasi">
            <i class="fas fa-map-marked-alt"></i>
        </a>
        <button class="contact-btn generator" id="openGeneratorBtn" aria-label="Buka Generator Produk">
            <i class="fas fa-cogs"></i> 
        </button>
    </div>

    <a href="https://www.anekamarket.my.id/aplikasipembayaran" class="payment-fab autohide-fab" target="_blank" aria-label="Aplikasi Pembayaran Kasir">
        <i class="fas fa-cash-register"></i>
    </a>
    
    <footer>
        <div class="footer-container">
            <div class="footer-col footer-about">
                <div class="footer-logo">
                    <img src="https://raw.githubusercontent.com/LKS-88/anekamarket/refs/heads/main/Logo-Anekamarketku.png" alt="ANEKAMARKET Logo">
                    <span>ANEKAMARKET</span>
                </div>
                <p>Menyediakan pelayanan publikasi dan promosi produk UMKM, jasa sewa dan pembuatan aplikasi usaha sejak tahun 2025. Komitmen kami adalah memberikan pengalaman berbelanja online yang menyenangkan dan memuaskan.</p>
            </div>
            
            <div class="footer-col">
                <h3>Tautan Cepat</h3>
                <ul class="footer-links">
                    <li><a href="#home">Beranda</a></li>
                    <li><a href="#gallery">Galeri</a></li>
                    <li><a href="#contact">Kontak</a></li>
                </ul>
            </div>
            
            <div class="footer-col">
                <h3>Newsletter</h3>
                <p>Berlangganan newsletter kami untuk mendapatkan update produk terbaru dan penawaran spesial.</p>
                <form class="newsletter-form">
                    <input type="email" placeholder="Alamat email Anda" required>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-envelope"></i> Berlangganan
                    </button>
                </form>
            </div>
        </div>
        
        <div class="copyright">
            © 2025 ANEKAMARKET. Semua hak dilindungi. | <a href="kebijakan-privasi.html">Kebijakan Privasi</a> | <a href="syarat-dan-ketentuan.html">Syarat & Ketentuan</a>
        </div>
    </footer>
    
    <div class="modal" id="orderModal">
        <div class="modal-content">
            <span class="close-modal">×</span>
            <h2>Pesan Cepat</h2>
            <form id="quickOrderForm" action="https://formsubmit.co/admin@anekamarket.my.id" method="POST">
                <input type="hidden" name="_subject" value="Pesan Cepat dari Website">
                <input type="hidden" name="_captcha" value="false">
                <div class="form-group">
                    <label for="quick-name">Nama Anda</label>
                    <input type="text" id="quick-name" name="name" required>
                </div>
                <div class="form-group">
                    <label for="quick-phone">Nomor Telepon</label>
                    <input type="tel" id="quick-phone" name="phone" required>
                </div>
                <div class="form-group">
                    <label for="quick-item">Produk yang Diminati</label>
                    <input type="text" id="quick-item" name="product" required>
                </div>
                <div class="form-group">
                    <label for="quick-message">Detail Tambahan</label>
                    <textarea id="quick-message" name="message"></textarea>
                </div>
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-paper-plane"></i> Kirim Permintaan
                </button>
            </form>
        </div>
    </div>

    <div class="modal" id="downloadModal">
        <div class="modal-content">
            <span class="close-modal">×</span>
            <h2>Download Aplikasi ANEKAMARKET</h2>
            <ul class="download-links">
                <li>
                    <a href="https://www.4shared.com/mobile/mAUL3Dg4ge/APLIKASI_ANEKAMARKET.html" target="_blank" rel="noopener noreferrer">
                        <i class="fab fa-android"></i>
                        <span>Download untuk Android</span>
                        <small>(via 4Shared)</small>
                    </a>
                </li>
            </ul>
        </div>
    </div>
    
    <div class="search-modal" id="searchModal">
        <div class="search-modal-content">
            <div class="search-modal-header">
                <h2><i class="fas fa-search"></i> Pencarian Cerdas</h2>
                <span class="close-search-modal" title="Tutup">×</span>
            </div>
            <div class="search-modal-body">
                <input type="text" class="search-modal-input" placeholder="Cari produk, UMKM, kode..." id="searchModalInput">
                
                <div class="search-filters" id="searchFilters">
                    <input type="checkbox" name="search-filter" value="discount" id="filter-discount">
                    <label for="filter-discount"><i class="fas fa-percent"></i> Potongan Harga</label>
                    
                    <input type="checkbox" name="search-filter" value="bonus" id="filter-bonus">
                    <label for="filter-bonus"><i class="fas fa-gift"></i> Bonus/Gratis</label>
                    
                    <input type="checkbox" name="search-filter" value="negotiable" id="filter-negotiable">
                    <label for="filter-negotiable"><i class="fas fa-handshake"></i> Perkiraan Harga/Nego</label>
                    
                    <input type="checkbox" name="search-filter" value="sort-cheap" id="filter-sort-cheap">
                    <label for="filter-sort-cheap"><i class="fas fa-sort-amount-down"></i> Urutkan Termurah</label>
                </div>
                
                <div class="search-results" id="searchResults">
                    <p class="search-results-placeholder">Mulai ketik atau pilih filter untuk mencari produk...</p>
                </div>
            </div>
            <div class="search-modal-footer">
                <button class="btn-close-modal">Tutup</button>
            </div>
        </div>
    </div>
    
    <div class="image-modal" id="imageModal">
        <div class="image-modal-content">
            <span class="close-image-modal">×</span>
            <img id="zoomedImage" src="" alt="Zoomed Image">
        </div>
    </div>

    <div class="offer-notification" id="offerNotification">
        <span class="close-notification" id="closeNotification">×</span>
        
        <div class="notification-content active" id="notificationStep1">
            <h4><i class="fas fa-rocket"></i> Punya bisnis atau usaha? Ingin menjangkau lebih banyak pelanggan?</h4>
            <div class="notification-buttons">
                <button class="notification-btn btn-no" data-action="close">Tidak</button>
                <button class="notification-btn btn-yes" data-action="next">Iya, Tentu</button>
            </div>
        </div>
        
        <div class="notification-content" id="notificationStep2">
            <h4><i class="fas fa-handshake"></i> Tertarik mendaftarkan usaha Anda di Anekamarket secara GRATIS dan tanpa komisi?</h4>
            <div class="notification-buttons">
                <button class="notification-btn btn-no" data-action="close">Lain Kali</button>
                <button class="notification-btn btn-yes" data-action="register">Iya, Saya Mau</button>
            </div>
        </div>
    </div>

    <div class="generator-modal" id="generatorModal">
        <div class="generator-modal-content">
            <div class="generator-modal-header">
                <h2><i class="fas fa-magic"></i> Product Data Generator</h2>
                <span class="close-generator-modal" id="closeGeneratorModal">×</span>
            </div>
            <div class="generator-modal-body">
                <div class="generator-section">
                    <h3><i class="fas fa-paste"></i> Impor & Edit Data</h3>
                    <div class="form-group full-width">
                        <label for="gen-importer">Tempel (paste) script produk di sini untuk mengedit:</label>
                        <textarea id="gen-importer" rows="4" placeholder='Contoh: { "id": "ACA-2025-8899", ... } atau [ { "id": "ACA-2025-8899", ... } ]' style="font-family: monospace; font-size: 0.9rem;"></textarea>
                        <button type="button" id="importScriptBtn" class="btn-add-item" style="margin-top: 10px;"><i class="fas fa-upload"></i> Muat Data ke Form</button>
                    </div>
                </div>

                <form id="productGeneratorForm">
                    <div class="generator-section full-width">
                        <h3><i class="fas fa-info-circle"></i> Informasi Dasar</h3>
                        <div id="basicInfoGrid">
                            <div class="form-group">
                                <label for="gen-id">ID Unik</label>
                                <input type="text" id="gen-id" placeholder="e.g., ACA-2025-8899" required>
                            </div>
                            <div class="form-group">
                                <label for="gen-code">Kode Produk</label>
                                <input type="text" id="gen-code" placeholder="e.g., ACA-2025-8899" required>
                            </div>
                            <div class="form-group">
                                <label for="gen-title">Judul Produk</label>
                                <input type="text" id="gen-title" placeholder="e.g., Paket Lengkap Ternak Ayam" required>
                            </div>
                            <div class="form-group">
                                <label for="gen-category">Kategori</label>
                                <select id="gen-category">
                                    <option value="food">Makanan & Minuman</option>
                                    <option value="snack">Kue & Cemilan</option>
                                    <option value="construction">Alat Konstruksi</option>
                                    <option value="office">Alat Kantor</option>
                                    <option value="household">Alat Rumah Tangga</option>
                                    <option value="software">Software Aplikasi</option>
                                    <option value="electronics">Elektronik</option>
                                    <option value="fishery">Perikanan</option>
                                    <option value="livestock">Peternakan</option>
                                    <option value="agriculture">Pertanian</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="gen-type">Tipe Tampilan</label>
                                <select id="gen-type">
                                    <option value="all">Semua</option>
                                    <option value="rental">Sewa</option>
                                    <option value="promo">Promosi</option>
                                    <option value="jasa">Jasa</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="gen-mainImage">URL Gambar Utama</label>
                                <input type="url" id="gen-mainImage" placeholder="https://i.imgur.com/..." required>
                            </div>
                        </div>
                    </div>
                    
                    <div class="generator-section full-width">
                        <h3><i class="fas fa-tag"></i> Info Harga & Badge</h3>
                         <div id="priceInfoGrid">
                            <div class="form-group">
                                <label for="gen-price">Harga Awal (Angka)</label>
                                <input type="number" id="gen-price" placeholder="e.g., 8000" required>
                            </div>
                            <div class="form-group">
                                <label for="gen-originalPrice">Harga Asli (Opsional)</label>
                                <input type="number" id="gen-originalPrice" placeholder="e.g., 10000">
                            </div>
                            <div class="form-group">
                                <label for="gen-discount">Teks Diskon (Opsional)</label>
                                <input type="text" id="gen-discount" placeholder="e.g., 10% OFF">
                            </div>
                            <div class="form-group">
                                <label for="gen-badge-text">Teks Badge</label>
                                <input type="text" id="gen-badge-text" placeholder="e.g., Promosi" required>
                            </div>
                            <div class="form-group">
                                <label for="gen-badge-type">Tipe Badge</label>
                                <select id="gen-badge-type">
                                    <option value="promo">Promo</option>
                                    <option value="rental">Rental</option>
                                    <option value="new">Baru</option>
                                     <option value="service">Jasa</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="generator-section full-width">
                        <h3><i class="fas fa-store"></i> Info Penjual & Kontak</h3>
                        <div id="sellerInfoGrid">
                             <div class="form-group">
                                <label for="gen-seller-name">Nama Gerai/Penjual</label>
                                <input type="text" id="gen-seller-name" placeholder="e.g., Chacha Farm" required>
                            </div>
                            <div class="form-group">
                                <label for="gen-seller-link">Link Halaman Gerai</label>
                                <input type="url" id="gen-seller-link" placeholder="https://www.anekamarket.my.id/..." required>
                            </div>
                            <div class="form-group">
                                <label for="gen-seller-location">Link Lokasi Google Maps (Opsional)</label>
                                <input type="url" id="gen-seller-location" placeholder="https://maps.app.goo.gl/...">
                            </div>
                            <div class="form-group">
                                <label for="gen-contact-whatsapp">Nomor WhatsApp</label>
                                <input type="tel" id="gen-contact-whatsapp" placeholder="e.g., 6281234567890" required>
                            </div>
                            <div class="form-group">
                                <label for="gen-contact-phone">Nomor Telepon</label>
                                <input type="tel" id="gen-contact-phone" placeholder="e.g., +6281234567890" required>
                            </div>
                        </div>
                    </div>
                    
                    <div class="generator-section full-width">
                        <h3><i class="fas fa-money-bill-wave"></i> Variasi Harga</h3>
                        <div id="priceVariationsContainer"></div>
                        <button type="button" class="btn-add-item" id="addPriceVariationBtn"><i class="fas fa-plus"></i> Tambah Variasi</button>
                    </div>

                    <div class="generator-section full-width">
                        <h3><i class="fas fa-balance-scale"></i> Satuan Produk (Units)</h3>
                        <div id="unitsInfoGrid">
                            <div class="form-group">
                                <label for="gen-units">Daftar Satuan (pisahkan dengan koma)</label>
                                <input type="text" id="gen-units" placeholder="e.g., pcs, kg, biji, ekor" required>
                            </div>
                            <div class="form-group">
                                <label for="gen-defaultUnit">Satuan Default</label>
                                <input type="text" id="gen-defaultUnit" placeholder="e.g., ekor" required>
                            </div>
                        </div>
                    </div>

                    <div class="generator-section full-width">
                        <h3><i class="fas fa-align-left"></i> Detail Produk</h3>
                        <div class="form-group full-width">
                            <label for="gen-description">Deskripsi</label>
                            <div class="description-toolbar">
                                <button type="button" class="toolbar-btn" data-tag="b"><b>Bold</b></button>
                                <button type="button" class="toolbar-btn" data-tag="strong"><strong>Strong</strong></button>
                                <button type="button" class="toolbar-btn" data-tag="i"><i>Italic</i></button>
                                <button type="button" class="toolbar-btn" data-tag="br">Line Break</button>
                            </div>
                            <textarea id="gen-description" placeholder="Deskripsi lengkap produk..." required></textarea>
                        </div>
                        <div class="form-group full-width" style="margin-top:15px;">
                            <label for="gen-images">URL Gambar Tambahan (pisahkan dengan koma)</label>
                            <textarea id="gen-images" placeholder="https://..., https://..."></textarea>
                        </div>
                    </div>

                    <div class="generator-section full-width">
                        <h3><i class="fas fa-list-ul"></i> Spesifikasi</h3>
                        <div id="specsContainer"></div>
                        <button type="button" class="btn-add-item" id="addSpecBtn"><i class="fas fa-plus"></i> Tambah Spesifikasi</button>
                    </div>
                    
                    <div class="full-width" style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 20px;">
                        <button type="button" id="previewProductBtn" class="btn btn-primary" style="background-color: #28a745; border-color: #218838; font-size: 1.1rem; padding: 15px;">
                            <i class="fas fa-eye"></i> Preview Tampilan
                        </button>
                         <button type="submit" class="btn btn-primary" style="font-size: 1.1rem; padding: 15px;">
                            <i class="fas fa-cogs"></i> Generate Script
                        </button>
                    </div>
                </form>

                <div id="generatorOutputContainer">
                    <div class="output-controls">
                        <h3><i class="fas fa-code"></i> Hasil Script</h3>
                        <div class="output-actions">
                            <button id="toggleScriptVisibilityBtn" title="Lihat/Sembunyikan Script">
                                <i class="fas fa-eye-slash"></i>
                            </button>
                            <button id="copyScriptBtn" title="Salin ke Clipboard">
                                <i class="fas fa-copy"></i> Salin
                            </button>
                            <button id="downloadScriptBtn" title="Unduh sebagai file .js">
                                <i class="fas fa-download"></i> Unduh
                            </button>
                        </div>
                    </div>
                    <div id="generatedScriptWrapper">
                        <pre><code id="generatedScriptOutput"></code></pre>
                    </div>
                </div>
                
                <div id="generatorPreviewContainer">
                    <h3><i class="fas fa-desktop"></i> Pratinjau Hasil</h3>
                    <div id="previewTarget"></div>
                </div>
            </div>
        </div>
    </div>
    
    <audio id="buttonSound" src="https://voca.ro/1BjrRUnRSEqJ"></audio>
    
    <script>
        // --- [PERUBAHAN] DATA PRODUK KINI DALAM FORMAT JSON YANG VALID ---
        const products = [
        {"id":"AWF-2025-2575","category":"livestock","type":"promo","seller":{"name":"Ardiwillis Farm","link":"https://www.anekamarket.my.id/ardiwillisfarm","locationLink":null},"badge":{"text":"Promosi","type":"promo"},"mainImage":"https://i.imgur.com/pKLE9EY.jpeg","title":"Paket Lengkap Ternak Ayam Ardiwilis","code":"AWF-2025-2575","price":8000,"originalPrice":10000,"discount":"10%","priceVariations":[{"name":"Ecer (per ekor)","price":8000},{"name":"10 ekor","price":75000},{"name":"100 ekor","price":700000}],"units":["pcs","kg","biji","ekor"],"defaultUnit":"ekor","details":{"description":"<br>Ardiwillis Farm menyediakan produk unggulan peternakan ayam berkualitas tinggi. Kami menyediakan telur tetas fertil dengan daya tetas tinggi, DOC (Day Old Chicken) berbagai strain unggul, ayam karkas segar, dan ayam bakar siap saji dengan bumbu khas. Semua produk dihasilkan dari peternakan yang dikelola secara profesional dengan standar kesehatan dan kebersihan tinggi. (Note: Harga tersebut bukan harga tetap, & bisa berubah)","images":["https://i.imgur.com/pAygjAZ.jpeg","https://i.imgur.com/XRMPBhw.jpeg","https://i.imgur.com/K5m75Rq.jpeg","https://i.imgur.com/coJadaj.jpeg"],"specs":[{"label":"Kode Produk","value":"AWF-2025-2575"},{"label":"Gerai","value":"Ardiwillis Farm"},{"label":"Jenis","value":"Ayam Pedaging"},{"label":"Usia","value":"DOC (1 hari)"},{"label":"Strain","value":"Cobb 500"},{"label":"Garansi","value":"Hidup sampai diterima"},{"label":"Minimal Order","value":"10 ekor"},{"label":"Catatan","value":"Harga bisa berubah sewaktu-waktu"}]},"contact":{"whatsapp":"6285258544543","phone":"+6285258544543"}},
        {"id":"NS-2025-3348","category":"food","type":"promo","seller":{"name":"nikisae","link":"https://www.anekamarket.my.id/nikisae","locationLink":null},"badge":{"text":"Promo Spesial","type":"promo"},"mainImage":"https://i.imgur.com/y8r14Z3.jpeg","title":"Promo Frozen Food Homemade nikisae Sae","code":"NS-2025-3348","price":12000,"originalPrice":15000,"discount":"20% OFF","priceVariations":[{"name":"Pempek","price":12000},{"name":"Tahu Walik","price":11000},{"name":"Nugget Ikan/Ayam","price":12000},{"name":"Dragon Stick","price":12000},{"name":"Otak-Otak Ikan","price":12000}],"units":["pcs","pack","set","lusin"],"defaultUnit":"pcs","details":{"description":"<br><strong>PROMO SPESIAL!</strong> nikisae Sae dari Dapur Yunna menghadirkan promo frozen food homemade dengan kualitas terbaik. Semua produk dibuat dengan bahan pilihan dan teknik khusus untuk menjamin cita rasa autentik. Produk kami termasuk Pempek, Tahu Walik, Otak-Otak Ikan, Nugget Ikan dan Ayam, serta Dragon Stick. Setiap produk dibuat dengan standar kebersihan tinggi dan rasa yang konsisten. Nikmati diskon spesial untuk pembelian selama periode promo! Bonus gratis ongkir untuk pembelian di atas Rp100.000.","images":["https://i.imgur.com/RP8HTMb.jpeg","https://i.imgur.com/GWXfEGJ.jpeg","https://i.imgur.com/WSB6cXr.jpeg","https://i.imgur.com/ubU63gJ.jpeg"],"specs":[{"label":"Kode Promo","value":"NS-2025-3348"},{"label":"Nama UMKM","value":"nikisae Sae Pempek dan Tahu walik"},{"label":"Pemilik","value":"Yuliana Mulyaningtyas"},{"label":"Alamat","value":"Perum Graha Sultan Raya 1 blok G. 61, Panji"},{"label":"Kontak","value":"085731247566"},{"label":"Media Sosial","value":"Belum tersedia"},{"label":"Daftar Promo","value":"• Pempek <s>Rp15.000</s> <strong>Rp12.000</strong> (20% OFF)<br>• Tahu Walik <s>Rp13.750</s> <strong>Rp11.000</strong> (20% OFF)<br>• Nugget Ikan/Ayam <s>Rp15.000</s> <strong>Rp12.000</strong> (20% OFF)<br>• Dragon Stick <s>Rp15.000</s> <strong>Rp12.000</strong> (20% OFF)<br>• Otak-Otak Ikan <s>Rp15.000</s> <strong>Rp12.000</strong> (20% OFF)"},{"label":"Periode Promo","value":"Periode Promo sewaktu-waktu tidak berlaku"},{"label":"Catatan","value":"• Harga normal berlaku setelah periode promo berakhir<br>• Minimal pembelian 5 pcs per item<br>• Free ongkir untuk pembelian di atas Rp100.000 (area tertentu)"}]},"contact":{"whatsapp":"6285731247566","phone":"+6285731247566"}},
        {"id":"PRD-2025-2688","category":"fishery","type":"promo","seller":{"name":"PRADIPA","link":"https://www.anekamarket.my.id/pradipa","locationLink":null},"badge":{"text":"Promosi","type":"promo"},"mainImage":"https://i.imgur.com/ru1FKXW.jpeg","title":"Produk Hasil Laut Segar Pradipa","code":"PRD-2025-2688","price":30000,"originalPrice":null,"discount":null,"priceVariations":[{"name":"Ikan Bogek/Mendut","price":35000},{"name":"Ikan Mangla/Swangi","price":30000},{"name":"Ikan Sebelah/Sulfis","price":35000}],"units":["kg","ekor","pack"],"defaultUnit":"kg","details":{"description":"<br><b>PRADIPA</b> menghadirkan hasil laut segar langsung dari perairan Panarukan. Kami menyediakan berbagai jenis ikan berkualitas tinggi yang ditangkap dengan metode ramah lingkungan. Setiap produk kami melalui proses seleksi ketat untuk memastikan kesegaran dan kualitas terbaik untuk pelanggan. Dengan pengalaman bertahun-tahun di bidang hasil laut, kami berkomitmen memberikan produk terbaik dengan harga kompetitif.","images":["https://i.imgur.com/n2AkesD.jpeg","https://i.imgur.com/tupfVCl.jpeg","https://i.imgur.com/VhfoAsv.png"],"specs":[{"label":"Kode Produk","value":"PRD-2025-2688"},{"label":"Gerai","value":"PRADIPA"},{"label":"Pemilik","value":"Fajar Nur Cholis"},{"label":"Alamat","value":"Tanah Anyar RT 3 RW 02 Desa Kilensari, Panarukan"},{"label":"Kontak","value":"082334393922 | quenie89@gmail.com"},{"label":"Produk Unggulan","value":"Ikan Bogek/Mendut (Rp35.000/kg), Ikan Mangla/Swangi (Rp30.000/kg), Ikan Sebelah/Sulfis (Rp35.000/kg)"},{"label":"Catatan","value":"Harga bisa berubah sewaktu-waktu"}]},"contact":{"whatsapp":"6282334393922","phone":"+6282334393922"}},
        {"id":"MCU-2025-2830","category":"snack","type":"promo","seller":{"name":"Mochi UMA","link":"https://www.anekamarket.my.id/mochiuma","locationLink":null},"badge":{"text":"Promo Spesial","type":"promo"},"mainImage":"https://i.imgur.com/TPSWsZw.jpeg","title":"Promo Aneka Kue Lezat Mochi Uma","code":"MCU-2025-2830","price":10000,"originalPrice":null,"discount":null,"priceVariations":[{"name":"Pancake Durian","price":10000},{"name":"Mochi (3pcs)","price":10000},{"name":"Cireng Ayam Suwir","price":10000},{"name":"Corndog Coklat (isi 3)","price":10000}],"units":["pcs","pack","set","lusin"],"defaultUnit":"pcs","details":{"description":"<br><strong>PROMO SPESIAL!</strong> Mochi UMA menghadirkan paket promo aneka kue lezat dengan harga spesial. Nikmati berbagai pilihan kue premium dengan diskon menarik untuk waktu terbatas. Setiap produk dibuat dengan bahan pilihan dan teknik khusus untuk menjamin cita rasa autentik. Jangan lewatkan kesempatan ini untuk menikmati kue berkualitas dengan harga terjangkau!","images":["https://i.imgur.com/dlK9kfP.jpeg","https://i.imgur.com/JsXOHCO.jpeg","https://i.imgur.com/kJDDUy4.jpeg"],"specs":[{"label":"Kode Promo","value":"MCU-2025-2830"},{"label":"Nama UMKM","value":"Mochi UMA"},{"label":"Pemilik","value":"ULink"},{"label":"Alamat","value":"Jl. Wijaya Kusuma Samping Bidan Ika"},{"label":"Kontak","value":"089679013099 | nurilaneeh@gmail.com"},{"label":"Media Sosial","value":"TikTok @mochi.uma3"},{"label":"Daftar Promo","value":"• Pancake Durian hanya Rp10.000<br>• Mochi 3pcs Rp10.000<br>• Cireng Ayam Suwir Rp10.000<br>• Corndog Coklat isi 3 Rp10.000"},{"label":"Periode Promo","value":"Periode dapat berubah sewaktu-waktu"},{"label":"Catatan","value":"Harga bisa berubah sewaktu-waktu"}]},"contact":{"whatsapp":"6289679013099","phone":"+6289679013099"}},
        {"id":"UDJ-2025-3038","category":"agriculture","type":"all","seller":{"name":"UD Jaya Makmur","link":"https://anekamarket.my.id/jayamakmur","locationLink":"https://maps.app.goo.gl/F7ohGgB5j4C42f5k9"},"badge":{"text":"Grosir","type":"rental"},"mainImage":"https://i.imgur.com/fjnwYfW.jpeg","title":"Garam Krosok Geo Membran Premium","code":"UDJ-2025-3038","price":2500,"originalPrice":null,"discount":null,"priceVariations":[{"name":"Per Kilo","price":2500},{"name":"3.5 Ton (Minimal Order)","price":8750000}],"units":["kg","ton"],"defaultUnit":"kg","details":{"description":"<br><strong>UD Jaya Makmur</strong> menghadirkan garam krosok geo membran premium berkualitas tinggi dari Panarukan. Garam kami diproduksi dengan metode geo membran yang menghasilkan garam dengan kadar NaCl tinggi (minimal 95%) dan rendah pengotor. Kami menyediakan garam dengan kualitas konsumsi dan industri, dikemas secara higienis dan siap dikirim ke seluruh Indonesia. Minimal pembelian 3.500 kg dengan layanan pengantaran langsung ke lokasi Anda. Garam kami cocok untuk berbagai kebutuhan mulai dari industri, rumah tangga, hingga pengolahan makanan. ","images":["https://i.imgur.com/WFbAET3.jpeg","https://i.imgur.com/EwIAvxE.jpeg","https://i.imgur.com/5w9ueN7.jpeg"],"specs":[{"label":"Kode Produk","value":"UDJ-2025-3038"},{"label":"Nama UMKM","value":"UD Jaya Makmur"},{"label":"Pemilik","value":"Zaini"},{"label":"Alamat","value":"Kp. Sabrang RT 001 RW 001 Desa Wringin Anom, Panarukan"},{"label":"Kontak","value":"087816295963 | jayamakmurpanarukan@gmail.com"},{"label":"Jenis Produk","value":"Garam Krosok Geo Membran"},{"label":"Harga","value":"Rp 2.500/kg (minimal 3.500 kg)"},{"label":"Pengiriman","value":"Gratis ongkir untuk area tertentu (minimal 3.5 ton)"},{"label":"Catatan","value":"Harga bisa berubah sewaktu-waktu"}]},"contact":{"whatsapp":"6287816295963","phone":"+6287816295963"}},
        {"id":"BNJ-2025-3184","category":"food","type":"all","seller":{"name":"Bu Nju","link":"https://anekamarket.my.id/bunju","locationLink":null},"badge":{"text":"Produk Lokal","type":"promo"},"mainImage":"https://i.imgur.com/Ra4CZgd.jpeg","title":"Ikan Kering & Terasi Puger Premium","code":"BNJ-2025-3184","price":4000,"originalPrice":null,"discount":null,"priceVariations":[{"name":"Terasi Puger 1kg","price":80000},{"name":"Terasi Puger 1ons","price":8000},{"name":"Terasi Puger ½ons","price":4000},{"name":"Ikan Kering (berbumbu)","price":75000},{"name":"Ikan Kering (polos)","price":65000}],"units":["pcs","kg","ons","pack"],"defaultUnit":"pcs","details":{"description":"<br><strong>Bu Nju</strong> menghadirkan produk ikan kering dan terasi Puger berkualitas premium dari Panarukan. Terasi kami diproduksi secara tradisional dengan kualitas terbaik, memiliki aroma khas dan rasa gurih autentik. Ikan kering kami diproses secara higienis dengan dua varian: siap goreng (sudah berbumbu) dan polos (tanpa bumbu). Semua produk dibuat dengan bahan pilihan dan pengolahan yang menjaga cita rasa asli. Cocok untuk berbagai masakan rumahan hingga usaha kuliner.","images":["https://i.imgur.com/CV57qDP.jpeg","https://i.imgur.com/ImPrZJw.jpeg","https://i.imgur.com/eFnhNYu.jpeg"],"specs":[{"label":"Kode Produk","value":"BNJ-2025-3184"},{"label":"Nama UMKM","value":"Bu Nju"},{"label":"Pemilik","value":"Riqi"},{"label":"Alamat","value":"Karangsari, Desa Kilensari, Kecamatan Panarukan"},{"label":"Kontak","value":"082327600708 | vaiper.blood22@gmail.com"},{"label":"Daftar Harga","value":"• Terasi Puger 1kg: Rp80.000<br>• Terasi Puger 1ons: Rp8.000<br>• Terasi Puger ½ons: Rp4.000<br>• Ikan kering berbumbu: Rp70.000/kg<br>• Ikan kering polos: Rp60.000/kg"},{"label":"Media Sosial","value":"TikTok @seesaretadek"},{"label":"Catatan","value":"Harga bisa berubah sewaktu-waktu"}]},"contact":{"whatsapp":"6282327600708","phone":"+6282327600708"}},
        {"id":"LDW-2025-8001","category":"software","type":"promo","seller":{"name":"Lentera Karya Situbondo","link":"https://www.anekamarket.my.id/lenterakaryasitubondo","locationLink":null},"badge":{"text":"Super Deal","type":"promo"},"mainImage":"https://i.imgur.com/VumvfHv.png","title":"Paket Lengkap Aplikasi Web HTML","code":"LDW-2025-8001","price":599000,"originalPrice":899000,"discount":"33% OFF","priceVariations":[{"name":"Paket Komplit (7 Aplikasi)","price":599000},{"name":"Aplikasi Kasir Web","price":350000},{"name":"Sistem Pembukuan Web","price":400000}],"units":["paket","lisensi","unit"],"defaultUnit":"paket","details":{"description":"<br><strong>SOLUSI APLIKASI WEB TERBAIK UNTUK BISNIS ANDA!</strong> Paket lengkap aplikasi web HTML kami dirancang khusus untuk bekerja sempurna di semua perangkat tanpa perlu instalasi. Cukup buka browser dan aplikasi siap digunakan! Setiap aplikasi memiliki anturarmuka modern yang responsif, beradaptasi otomatis dengan layar desktop, tablet, maupun smartphone. Sistem kami mencakup fitur-fitur canggih seperti penyimpanan data di perangkat pengguna, backup/restore, laporan transaksi, dan cetak struk - semuanya dalam platform web yang ringan dan cepat.","images":["https://i.imgur.com/GjByUuX.png","https://i.imgur.com/rsR7RhC.png","https://i.imgur.com/gg5AGFc.png","https://i.imgur.com/VumvfHv.png"],"specs":[{"label":"Kode Produk","value":"LDW-2025-8001"},{"label":"Developer","value":"Lentera Karya Situbondo"},{"label":"Daftar Aplikasi","value":"• Aplikasi Kasir Web - Sistem kasir lengkap dengan cetak struk<br>• Sistem Pembukuan Web - Pencatatan keuangan profesional<br>• Aplikasi Absensi Web - Manajemen kehadiran karyawan<br>• Sistem Manajemen Restoran - Pesanan, meja, dan kitchen display<br>• Website Profesional Instan - Website bisnis siap pakai<br>• Aplikasi Tiket/Karcis - Sistem tiket elektronik<br>• Sistem Penginapan Web - Manajemen kamar dan tamu"},{"label":"Fitur Unggulan","value":"• Akses dari perangkat apapun dengan browser modern<br>• Tampilan responsif otomatis menyesuaikan layar<br>• Tanpa perlu instalasi - langsung buka file<br>• Penyimpanan data aman di perangkat pengguna<br>• Backup & restore data dengan satu klik<br>• Laporan keuangan lengkap dengan grafik<br>• Multi-user support dengan level akses berbeda<br>• Offline capable (PWA) - bisa digunakan tanpa internet"},{"label":"Kompatibilitas","value":"• Browser: Chrome, Firefox, Edge, Safari versi terbaru<br>• Sistem Operasi: Windows 10/11, macOS, Linux, Android, iOS<br>• Perangkat: Desktop, Laptop, Tablet, Smartphone<br>• Resolusi: Mendukung dari 320px hingga 4K"},{"label":"Cara Penggunaan","value":"1. Terima file HTML via email setelah pembelian<br>2. Buka file di browser favorit Anda (Chrome direkomendasikan)<br>3. Aplikasi siap digunakan segera!<br>4. Simpan sebagai PWA (Add to Home Screen) untuk pengalaman seperti aplikasi native<br>5. Untuk backup, cukup simpan file data yang dihasilkan aplikasi"}]},"contact":{"whatsapp":"6285647709114","phone":"+6285647709114"}}, 
        {"id":"LDW-2025-8002","category":"software","type":"promo","seller":{"name":"Lentera Karya Situbondo","link":"https://www.anekamarket.my.id/lenterakaryasitubondo","locationLink":null},"badge":{"text":"Baru!","type":"new"},"mainImage":"https://i.imgur.com/i7PAJfs.png","title":"Aplikasi Kasir Web HTML","code":"LDW-2025-8002","price":350000,"originalPrice":450000,"discount":"22% OFF","priceVariations":[{"name":"Lisensi Tunggal","price":350000}],"units":["lisensi","pcs","unit"],"defaultUnit":"lisensi","details":{"description":"<br><strong>APLIKASI KASIR MODERN TANPA INSTALASI!</strong> Aplikasi Kasir Web HTML dari Lentera Karya Situbondo adalah solusi sempurna untuk bisnis retail, toko, atau usaha kecil. Cukup buka file HTML di browser dan aplikasi siap digunakan! Dirancang khusus untuk bekerja optimal di semua perangkat - dari desktop PC hingga smartphone. Fitur termasuk manajemen produk, transaksi cepat, cetak struk, laporan penjualan, dan penyimpanan data langsung di perangkat Anda. Tidak perlu server mahal atau koneksi internet terus-menerus! Ada bonus voucher diskon 15% juga.","images":["https://i.imgur.com/9IuPANW.png","https://i.imgur.com/PY8ge6k.png","https://i.imgur.com/2Yr4njs.png","https://i.imgur.com/i7PAJfs.png"],"specs":[{"label":"Kode Produk","value":"LDW-2025-8002"},{"label":"Developer","value":"Lentera Karya Situbondo"},{"label":"Fitur Inti","value":"• Input transaksi cepat dengan anturarmuka modern<br>• Manajemen produk & kategori<br>• Pencarian produk instan dengan autocomplete<br>• Cetak struk pdf dengan header custom<br>• Laporan harian/mingguan/bulanan dengan grafik<br>• Backup & restore data dengan enkripsi<br>• Manajemen diskon dan promo produk<br>• Hitung kembalian & Stok otomatis berkurang saat transaksi"},{"label":"Keunggulan","value":"• Buka langsung di browser tanpa proses instalasi<br>• Tampilan responsif semua device (desktop, tablet, HP)<br>• Bisa digunakan offline setelah pertama kali dibuka<br>• Penyimpanan data aman di perangkat pengguna<br>• Tidak perlu server/hosting yang mahal<br>• Ringan dan cepat bahkan di spesifikasi rendah<br>• Update mudah dengan mengganti file HTML<br>• Tidak ada biaya bulanan/tahunan"},{"label":"Cara Implementasi","value":"1. Dapatkan file HTML aplikasi setelah pembelian<br>2. Buka file di browser favorit (Chrome direkomendasikan)<br>3. Mulai gunakan aplikasi kasir langsung<br>4. (Opsional) Simpan sebagai PWA untuk pengalaman seperti app native<br>5. Data otomatis tersimpan aman di perangkat<br>6. Backup rutin dengan menyimpan file data yang dihasilkan"},{"label":"Bonus Pembelian","value":"• Panduan penggunaan video step-by-step<br>• Template struk profesional yang bisa dicustom<br>• File contoh database produk siap pakai<br>• Support via WhatsApp  gratis<br>• Voucher diskon 15% untuk pembelian produk lain"}]},"contact":{"whatsapp":"6285647709114","phone":"+6285647709114"}},
        {"id":"WPU-2025-0610","category":"food","type":"promo","seller":{"name":"Warung Pak Untung","link":"https://anekamarket.my.id/pakuntung","locationLink":"https://maps.app.goo.gl/6xMBrsLe2WmuKRWX9"},"badge":{"text":"Diskon Spesial","type":"promo"},"mainImage":"https://i.imgur.com/1Mvj3cv.jpeg","title":"Menu Bakaran Spesial Warung Pak Untung","code":"WPU-2025-0610","price":30000,"originalPrice":50000,"discount":"40% OFF","priceVariations":[{"name":"Paket Hemat Komplit","price":30000},{"name":"Ikan Super (1 org) - 2 ons","price":25000},{"name":"Ikan Super (1 org) - 3 ons","price":30000},{"name":"Ikan Super (1 org) - 4 ons","price":35000},{"name":"Ikan Super (1 org) - 5 ons","price":45000},{"name":"Ikan Super (1 org) - 6 ons","price":55000},{"name":"Ikan Super (1 org) - 7 ons","price":60000},{"name":"Ikan Super (1 org) - 8 ons","price":70000},{"name":"Ikan Super (1 org) - 9 ons","price":80000},{"name":"Ikan Super (1 org) - 1 kg","price":90000},{"name":"Ikan Super (2 org) - 2 ons","price":30000},{"name":"Ikan Super (2 org) - 3 ons","price":40000},{"name":"Ikan Super (2 org) - 4 ons","price":50000},{"name":"Ikan Super (2 org) - 5 ons","price":60000},{"name":"Ikan Super (2 org) - 6 ons","price":65000},{"name":"Ikan Super (2 org) - 7 ons","price":75000},{"name":"Ikan Super (2 org) - 8 ons","price":85000},{"name":"Ikan Super (2 org) - 9 ons","price":95000},{"name":"Ikan Super (2 org) - 1 kg","price":100000}],"units":["porsi","kg","ons","ekor"],"defaultUnit":"porsi","details":{"description":"<br><strong>Diskon Spesial: Nikmati Sensasi Kuliner Laut Bakar di Warung Pak Untung!</strong><br>Cari tempat makan yang bikin penasaran? Mampir ke <strong>Warung Pak Untung</strong>! Terletak strategis di dekat destinasi Wisata Kampung Kerapu, kami menyajikan hidangan laut bakar segar dengan bumbu rahasia yang meresap sempurna hingga ke dalam daging.<br><br>🔥 <strong>PROMO SPESIAL!</strong> Jangan lewatkan paket komplit kami yang super hemat! Cukup dengan <strong>Rp 30.000</strong> saja dari harga normal Rp 50.000, Anda sudah bisa menikmati hidangan lezat yang bikin ketahihan.<br><br>Ingin yang lebih spesial? Pilih sendiri <strong>ikan super segar</strong> kami dengan berbagai ukuran sesuai selera Anda, cocok untuk dinikmati sendiri atau beramai-ramai. Setiap hidangan disajikan dengan sambal khas Pak Untung yang pedasnya nendang dan segar, dijamin akan menyempurnakan setiap suapan Anda.","images":["https://i.imgur.com/54G3vZ8.jpeg","https://i.imgur.com/jSYOe6m.jpeg","https://i.imgur.com/YqGxIMK.jpeg","https://i.imgur.com/2tbgQnd.jpeg","https://i.imgur.com/aSEVqAp.jpeg","https://i.imgur.com/v1kqfUt.jpeg","https://i.imgur.com/8XfYID8.jpeg","https://i.imgur.com/QjUO7gc.jpeg","https://i.imgur.com/NgAvdi7.jpeg","https://i.imgur.com/MOahwIU.jpeg","https://i.imgur.com/vTbwJGv.jpeg"],"specs":[{"label":"Kode Promo","value":"WPU-2025-0610"},{"label":"Nama Gerai","value":"Warung Pak Untung"},{"label":"Pemilik","value":"Mas Eko"},{"label":"Alamat","value":"Jalan Raya Gundil, sebelah barat Wisata Kampung Kerapu (selatan jalan)"},{"label":"Kontak","value":"083826231962"},{"label":"Menu Promo","value":"• Paket Hemat Komplit <s>Rp50.000</s> <strong>Rp30.000</strong> (Diskon 40%)"},{"label":"Lauk Tambahan","value":"• Ikan Super (1 Orang) mulai dari Rp25.000<br>• Ikan Super (2 Orang) mulai dari Rp30.000"},{"label":"Catatan","value":"Harga dapat berubah sewaktu-waktu tanpa pemberitahuan."}]},"contact":{"whatsapp":"6283826231962","phone":"+6283826231962"}},
        {"id":"AJN-2025-JASA","category":"construction","type":"jasa","seller":{"name":"Abang Joni","link":"https://anekamarket.my.id/abangjoni","locationLink":null},"badge":{"text":"Jasa Profesional","type":"service"},"mainImage":"https://i.imgur.com/8SQGdWj.jpeg","title":"Jasa Tukang Profesional Berpengalaman","code":"AJN-2025-JASA","price":0,"originalPrice":null,"discount":"Nego","priceVariations":[],"units":["proyek","harian","borongan"],"defaultUnit":"proyek","details":{"description":"<br><strong>Butuh tukang handal dan berpengalaman untuk proyek bangunan Anda? Abang Joni solusinya!</strong><br><br>Dengan pengalaman sejak tahun 2000, Abang Joni telah terbukti profesional dalam mengerjakan berbagai proyek, mulai dari rumah minimalis, perumahan, kost-kostan, hingga perkantoran. Dikenal dengan karakter yang humoris dan sosial tinggi, Abang Joni tidak hanya memberikan hasil kerja yang rapi dan berkualitas, tetapi juga suasana kerja yang menyenangkan.<br><br>Siap bekerja dengan sistem harian, mingguan, bulanan, maupun borongan sesuai kebutuhan Anda. Hubungi langsung untuk konsultasi gratis dan dapatkan penawaran terbaik untuk proyek impian Anda! Harga bisa nego.","images":["https://i.imgur.com/gVuL79s.jpeg","https://i.imgur.com/lrAPJFa.jpeg","https://i.imgur.com/hIl9fQz.jpeg","https://i.imgur.com/RcQWBKO.jpeg"],"specs":[{"label":"Kode Jasa","value":"AJN-2025-JASA"},{"label":"Nama Tukang","value":"Abang Joni"},{"label":"Pengalaman","value":"Sejak tahun 2000"},{"label":"Portofolio","value":"Rumah minimalis, kolam, gudang, perumahan, kost, perkantoran"},{"label":"Jabatan Proyek","value":"Pernah menjadi Mandor, Kepala Proyek, Kepala Tukang"},{"label":"Sistem Kerja","value":"Harian, Mingguan, Bulanan, Borongan"},{"label":"Karakter","value":"Humoris, Sosial Tinggi, Profesional"},{"label":"Area Layanan","value":"Situbondo & sekitarnya (Nego)"},{"label":"Catatan","value":"Hubungi langsung untuk diskusi harga dan jadwal."}]},"contact":{"whatsapp":"6285257633212","phone":"+6285257633212"}},
        {"id":"RIC-2025-0810","category":"snack","type":"promo","seller":{"name":"Regginang Situbondo Ibu Ican","link":"https://anekamarket.my.id/rengginang-situbondo-ibu-ican","locationLink":null},"badge":{"text":"Harga Hemat","type":"promo"},"mainImage":"https://i.imgur.com/H3Lc1Qt.jpeg","title":"RENGGINANG ANEKA RASA","code":"RIC-2025-0810","price":18000,"originalPrice":20000,"discount":"10%","priceVariations":[{"name":"Renggginang Rasa Terasi","price":8000},{"name":"Renggginang Rasa Bawang","price":8000},{"name":"Renggginang Rasa Udang","price":8000},{"name":"Renggginang Rasa Cumi","price":8000},{"name":"Renggginang Rasa Mix","price":19000}],"units":["pack 450gram"],"defaultUnit":"pack","details":{"description":"<br><b>Rengginang Gurih Renyah</b> – <strong>Cita Rasa Tradisional yang Tak Pernah Lekang oleh Waktu</strong>\n\nNikmati kelezatan rengginang khas Nusantara yang dibuat dari beras ketan pilihan, diproses secara higienis, dan digoreng hingga renyah sempurna. \n\nCocok sebagai camilan keluarga, teman minum teh, atau oleh-oleh khas yang menggugah selera. Tersedia dalam berbagai varian rasa: Terasi,bawang,Udang dan Cumi pasti ketagihan!","images":["https://i.imgur.com/mtQc5pc.jpeg","https://i.imgur.com/EuC9Np2.jpeg","https://i.imgur.com/yGCEh0n.jpeg","https://i.imgur.com/ACGxe8H.jpeg"],"specs":[]},"contact":{"whatsapp":"6282338341476","phone":"+6282338341476"}}
        ];
                                                                              
        document.addEventListener('DOMContentLoaded', () => {
            const { jsPDF } = window.jspdf;

            // --- [SEO ENHANCEMENT] Fungsi untuk menginjeksi Schema.org Produk secara dinamis ---
            function injectProductSchema(products) {
                const productSchemaElement = document.getElementById('product-schema');
                if (!productSchemaElement) return;

                const productSchemas = products.map(product => {
                    // Membersihkan tag HTML dari deskripsi untuk schema
                    const cleanDescription = (product.details?.description || '').replace(/<[^>]+>/g, ' ').replace(/\s\s+/g, ' ').trim();
                    
                    const schema = {
                        "@context": "https://schema.org/",
                        "@type": "Product",
                        "name": product.title,
                        "image": product.mainImage,
                        "description": cleanDescription,
                        "sku": product.id,
                        "mpn": product.code,
                        "brand": {
                            "@type": "Brand",
                            "name": product.seller?.name || "ANEKAMARKET"
                        }
                    };

                    // Menambahkan informasi harga jika tersedia
                    if (product.price > 0) {
                        schema.offers = {
                            "@type": "Offer",
                            "url": `https://anekamarket.my.id/#product-${product.id}`,
                            "priceCurrency": "IDR",
                            "price": product.price,
                            "priceValidUntil": new Date(new Date().setFullYear(new Date().getFullYear() + 1)).toISOString().split('T')[0], // Berlaku 1 tahun
                            "availability": "https://schema.org/InStock"
                        };
                    } else {
                         schema.offers = {
                            "@type": "Offer",
                            "url": `https://anekamarket.my.id/#product-${product.id}`,
                            "priceCurrency": "IDR",
                            "price": "0",
                            "availability": "https://schema.org/Inquire" // Gunakan 'Inquire' jika harga 0 atau Nego
                        };
                    }

                    return schema;
                });

                // Menambahkan skema ke dalam tag script
                productSchemaElement.textContent = JSON.stringify(productSchemas, null, 2);
            }
            // Panggil fungsi untuk menginjeksi skema saat halaman dimuat
            injectProductSchema(products);
            
            function formatPrice(amount) {
                if (typeof amount !== 'number' || isNaN(amount)) {
                    amount = 0;
                }
                return new Intl.NumberFormat('id-ID', {
                    style: 'currency',
                    currency: 'IDR',
                    minimumFractionDigits: 0
                }).format(amount);
            }

            async function colorizeQrCode(qrDataUrl, newColor = {r: 0, g: 123, b: 255}) {
                return new Promise((resolve, reject) => {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d', { willReadFrequently: true });
                    const img = new Image();
                    img.onload = () => {
                        canvas.width = img.width;
                        canvas.height = img.height;
                        ctx.drawImage(img, 0, 0);
                        try {
                            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                            const data = imageData.data;
                            for (let i = 0; i < data.length; i += 4) {
                                if (data[i] < 50 && data[i+1] < 50 && data[i+2] < 50 && data[i+3] > 200) {
                                    data[i] = newColor.r; data[i+1] = newColor.g; data[i+2] = newColor.b;
                                }
                            }
                            ctx.putImageData(imageData, 0, 0);
                            resolve(canvas.toDataURL());
                        } catch (error) { resolve(qrDataUrl); }
                    };
                    img.onerror = (err) => { reject(err); };
                    img.crossOrigin = "anonymous";
                    img.src = qrDataUrl;
                });
            }
            
            // --- [PERBAIKAN & PENYEMPURNAAN] Fungsi Generate PDF Cerdas ---
            async function generateAndDownloadReceipt(productData, orderDetails) {
                const doc = new jsPDF();
                const transactionId = `TRX-${productData.code}-${Date.now()}`;
                const logoUrl = 'https://raw.githubusercontent.com/LKS-88/anekamarket/refs/heads/main/Logo-Anekamarketku.png';
                
                const toDataURL = url => fetch(url)
                    .then(response => response.blob())
                    .then(blob => new Promise((resolve, reject) => {
                        const reader = new FileReader();
                        reader.onloadend = () => resolve(reader.result);
                        reader.onerror = reject;
                        reader.readAsDataURL(blob);
                }));

                try {
                    const logoBase64 = await toDataURL(logoUrl);
                    
                    const pageW = doc.internal.pageSize.getWidth();
                    const margin = 15;
                    let y = 0;

                    const brandColor = '#007bff'; const darkColor = '#212529';
                    const lightColor = '#f8f9fa'; const grayColor = '#6c757d';
                    const borderColor = '#dee2e6';

                    // --- Header ---
                    doc.setFillColor(brandColor);
                    doc.rect(0, 0, pageW, 40, 'F');
                    doc.addImage(logoBase64, 'PNG', margin, 7.5, 25, 25);
                    doc.setFontSize(22).setFont(undefined, 'bold');
                    doc.setTextColor('#FFFFFF');
                    doc.text('ANEKAMARKET', pageW - margin, 18, { align: 'right' });
                    doc.setFontSize(9).setFont(undefined, 'normal');
                    doc.text('Jl. PB Sudirman, Wringin Anom, Situbondo', pageW - margin, 24, { align: 'right' });
                    doc.text('admin@anekamarket.my.id', pageW - margin, 29, { align: 'right' });

                    y = 55;
                    
                    // --- [REVISI] Judul Dokumen Dinamis Sesuai Tipe Order ---
                    doc.setFontSize(24).setFont(undefined, 'bold').setTextColor(darkColor);
                    const docTitle = orderDetails.type === 'PRE-ORDER' ? 'BUKTI PRE-ORDER' : 'NOTA PEMESANAN';
                    doc.text(docTitle, pageW / 2, y, { align: 'center' });

                    y += 15;
                    
                    // --- [PERBAIKAN] Perbaikan Layout Informasi Transaksi agar tidak tumpang tindih ---
                    doc.setFontSize(10).setTextColor(grayColor);
                    doc.text('DITERBITKAN UNTUK:', margin, y);
                    doc.text('DETAIL TRANSAKSI:', pageW / 2, y); // Posisi label kolom kanan
                    doc.setDrawColor(borderColor);
                    doc.line(margin, y + 2, pageW - margin, y + 2);
                    y += 8;
                    
                    doc.setFontSize(11).setFont(undefined, 'bold').setTextColor(darkColor);
                    doc.text('Pelanggan Anekamarket', margin, y);
                    
                    const infoLabels = ['ID Transaksi:', 'Tanggal:', 'Gerai Penjual:'];
                    const infoValues = [
                        transactionId,
                        new Date().toLocaleDateString('id-ID', { day: '2-digit', month: 'long', year: 'numeric' }),
                        productData.seller?.name || 'N/A'
                    ];

                    let transactionDetailsY = y;
                    doc.setFontSize(10).setFont(undefined, 'normal');
                    for (let i = 0; i < infoLabels.length; i++) {
                        doc.setTextColor(grayColor);
                        doc.text(infoLabels[i], pageW / 2, transactionDetailsY); // Label dimulai dari tengah
                        doc.setTextColor(darkColor);
                        doc.text(infoValues[i], pageW - margin, transactionDetailsY, { align: 'right' }); // Value rata kanan
                        transactionDetailsY += 7; // Spasi antar baris
                    }

                    y = transactionDetailsY + 10; // Posisi Y selanjutnya setelah detail transaksi

                    // --- Tabel Detail Item ---
                    const tableHeaderY = y;
                    doc.setFillColor(darkColor);
                    doc.roundedRect(margin, tableHeaderY, pageW - (margin * 2), 10, 2, 2, 'F');
                    doc.setFontSize(10).setFont(undefined, 'bold').setTextColor('#FFFFFF');
                    doc.text('Deskripsi Produk', margin + 3, tableHeaderY + 7);
                    doc.text('Harga Satuan', pageW - margin - 60, tableHeaderY + 7, { align: 'right' });
                    doc.text('Jumlah', pageW - margin - 35, tableHeaderY + 7, { align: 'right' });
                    doc.text('Subtotal', pageW - margin - 3, tableHeaderY + 7, { align: 'right' });
                    
                    y += 10;
                    doc.setFont(undefined, 'normal').setTextColor(darkColor).setDrawColor(borderColor);
                    
                    orderDetails.items.forEach((item, index) => {
                        const itemY = y;
                        if(index % 2 !== 0){ doc.setFillColor(lightColor); doc.rect(margin, itemY, pageW - (margin*2), 10, 'F'); }
                        
                        const itemDescription = doc.splitTextToSize(`${item.name} (${productData.code})`, 80);
                        doc.text(itemDescription, margin + 3, itemY + 7);
                        doc.text(formatPrice(item.unitPrice), pageW - margin - 60, itemY + 7, { align: 'right' });
                        doc.text(`${item.quantity} ${orderDetails.unit}`, pageW - margin - 35, itemY + 7, { align: 'right' });
                        doc.text(formatPrice(item.subtotal), pageW - margin - 3, itemY + 7, { align: 'right' });
                        y += 10;
                    });
                    
                    doc.line(margin, y, pageW - margin, y);
                    y += 5;

                    // --- Kalkulasi Total ---
                    const totalBoxW = 80;
                    const totalBoxX = pageW - margin - totalBoxW;
                    
                    doc.setFontSize(10).setTextColor(grayColor);
                    doc.text('Total Belanja:', totalBoxX, y + 5, { align: 'right' });
                    doc.setTextColor(darkColor);
                    doc.text(formatPrice(orderDetails.grandTotal), pageW - margin, y + 5, { align: 'right' });

                    if (orderDetails.type === 'PRE-ORDER') {
                        y += 6;
                        doc.setTextColor(grayColor);
                        doc.text('Uang Muka (DP):', totalBoxX, y + 5, { align: 'right' });
                        doc.setTextColor(darkColor);
                        doc.text(orderDetails.dpAmount, pageW - margin, y + 5, { align: 'right' });
                        y += 6;
                        const sisa = orderDetails.grandTotal - parseFloat(orderDetails.dpAmount.replace(/[^0-9]/g, ''));
                        doc.setTextColor(grayColor);
                        doc.text('Sisa Pembayaran:', totalBoxX, y + 5, { align: 'right' });
                        doc.setTextColor(darkColor);
                        doc.text(formatPrice(sisa), pageW - margin, y + 5, { align: 'right' });
                    }

                    y += 8;
                    doc.setLineWidth(0.5).setDrawColor(darkColor);
                    doc.line(totalBoxX - 5, y, pageW - margin, y);
                    
                    y += 2;
                    doc.setFillColor(lightColor);
                    doc.roundedRect(totalBoxX - 5, y, totalBoxW + 5, 12, 2, 2, 'F');
                    doc.setFontSize(12).setFont(undefined, 'bold');
                    
                    const finalAmount = orderDetails.type === 'PRE-ORDER' ? orderDetails.dpAmount : formatPrice(orderDetails.grandTotal);
                    const finalLabel = orderDetails.type === 'PRE-ORDER' ? 'TOTAL DP:' : 'TOTAL BAYAR:';
                    doc.text(finalLabel, totalBoxX, y + 8, { align: 'right' });
                    doc.setTextColor(brandColor);
                    doc.text(finalAmount, pageW - margin, y + 8, { align: 'right' });

                    // --- [REVISI] Footer & Disclaimer Sesuai Permintaan ---
                    y = doc.internal.pageSize.getHeight() - 40;
                    doc.setDrawColor(borderColor);
                    doc.line(margin, y, pageW - margin, y);
                    y += 8;
                    
                    doc.setFontSize(8).setFont(undefined, 'italic').setTextColor(grayColor);
                    const noteText = doc.splitTextToSize('Struk ini merupakan bukti pemesanan yang sah dan dibuat secara otomatis oleh sistem. Harap simpan struk ini untuk proses konfirmasi pembayaran dengan penjual. Ini BUKAN struk/nota pembelian final yang wajib diterbitkan oleh gerai.', pageW - margin * 2 - 30);
                    doc.text(noteText, margin, y);
                    
                    const qr = qrcode(0, 'M');
                    qr.addData('https://s.id/anekamarket');
                    qr.make();
                    const blackQrCodeImage = qr.createDataURL(4);
                    const blueQrCodeImage = await colorizeQrCode(blackQrCodeImage, {r: 0, g: 123, b: 255});
                    doc.addImage(blueQrCodeImage, 'PNG', pageW - margin - 22, y, 22, 22);

                    y = doc.internal.pageSize.getHeight() - 10;
                    doc.setFontSize(8).setFont(undefined, 'normal').setTextColor(grayColor);
                    const footerText = `© ${new Date().getFullYear()} ANEKAMARKET | Developed by www.anekamarket.my.id`;
                    doc.text(footerText, pageW / 2, y, { align: 'center' });

                    // --- [IMPLEMENTASI] Unduh otomatis dengan nama file dinamis ---
                    const safeSellerName = (productData.seller.name || 'Gerai').replace(/[^a-z0-9]/gi, '_');
                    doc.save(`Struk-${safeSellerName}-${transactionId}.pdf`);

                } catch (error) { 
                    console.error("PDF Generation Error:", error);
                    alert("Maaf, terjadi kesalahan saat membuat struk PDF. Silakan coba lagi."); 
                }
            }

            function createProductCardHTML(product) {
                 const hasPriceVariations = product.priceVariations && product.priceVariations.length > 0;
                 
                 const priceVariationsHTML = hasPriceVariations 
                    ? product.priceVariations.map(v => `
                        <div class="price-variation-item" data-price="${v.price || 0}" data-name="${v.name || ''}">
                            <div class="price-variation-info">
                                <span class="price-variation-name">${v.name || ''}</span>
                                <span class="price-variation-value">${formatPrice(v.price)}</span>
                            </div>
                            <div class="quantity-controls">
                                <button class="quantity-btn minus" aria-label="Kurangi jumlah">-</button>
                                <input type="number" class="quantity-input" value="0" min="0" aria-label="Jumlah item">
                                <button class="quantity-btn plus" aria-label="Tambah jumlah">+</button>
                            </div>
                        </div>`).join('')
                    : '';
                
                const units = product.units || [product.defaultUnit || 'pcs'];
                const unitOptionsHTML = units.map(unit => `<option value="${unit}" ${unit === product.defaultUnit ? 'selected' : ''}>${unit}</option>`).join('');
                
                const detailSpecsHTML = (product.details?.specs || []).map(spec => `<div class="spec-item"><span class="spec-label">${spec.label || ''}:</span><span class="spec-value">${spec.value || ''}</span></div>`).join('');
                
                const locationButtonHTML = product.seller?.locationLink
                    ? `<a href="${product.seller.locationLink}" target="_blank" class="btn-visit btn-location"><i class="fas fa-map-marker-alt"></i> Lokasi</a>`
                    : `<button class="btn-visit btn-location-disabled" onclick="alert('Belum Menetapkan Lokasi')"><i class="fas fa-map-marker-alt"></i> Lokasi</button>`;

                const whatsappButtonHTML = `<a href="https://wa.me/${product.contact?.whatsapp || ''}?text=Halo%20${encodeURIComponent(product.seller?.name || '')},%20saya%20tertarik%20dengan%20produk%20${encodeURIComponent(product.title || '')}%20(${product.code || ''})" class="btn-whatsapp" target="_blank"><i class="fab fa-whatsapp"></i> Chat</a>`;
                const phoneButtonHTML = `<a href="tel:${product.contact?.phone || ''}" class="btn-call"><i class="fas fa-phone-alt"></i> Telepon</a>`;

                const allImages = [product.mainImage, ...(product.details?.images || [])].filter(Boolean);
                const imagesHTML = allImages.map((img, index) =>
                    `<img src="${img}" alt="${product.title} - Gambar ${index + 1}" class="gallery-slider-image ${index === 0 ? 'active' : ''}" loading="lazy">`
                ).join('');
                const dotsHTML = allImages.length > 1 ? `<div class="slider-dots">${allImages.map((_, index) => `<span class="slider-dot ${index === 0 ? 'active' : ''}" data-index="${index}"></span>`).join('')}</div>` : '';
                
                return `
                    <div class="gallery-item" data-category="${product.category || 'all'}" data-type="${product.type || 'all'}" data-id="${product.id}" id="product-${product.id}">
                        <a href="${product.seller?.link || '#'}" target="_blank" class="gallery-badge seller">Gerai: ${product.seller?.name || 'N/A'}</a>
                        <span class="gallery-badge ${product.badge?.type || 'promo'}">${product.badge?.text || 'Promo'}</span>
                        
                        <div class="gallery-image-container" data-product-id="${product.id}">
                            ${imagesHTML}
                            ${dotsHTML}
                        </div>

                        <div class="gallery-details">
                            <h3 class="gallery-title">${product.title || 'Judul Produk'}</h3>
                            <div class="gallery-meta"><span class="gallery-code">Kode: ${product.code || 'N/A'}</span><span class="gallery-seller"><i class="fas fa-store"></i> ${product.seller?.name || 'N/A'}</span></div>
                            <p class="gallery-price">
                                ${product.price > 0 ? `Mulai dari ${formatPrice(product.price)}` : 'Hubungi untuk harga'}
                                ${product.originalPrice ? `<span class="original-price">${formatPrice(product.originalPrice)}</span>` : ''}
                                ${product.discount ? `<span class="discount">${product.discount}</span>` : ''}
                            </p>
                            
                            <div class="price-section-collapsible">
                                <div class="price-variations-container">${priceVariationsHTML}</div>
                                <select class="unit-select">${unitOptionsHTML}</select>
                                <div class="total-price">
                                    <span class="total-price-label">Total Harga:</span>
                                    <span class="total-price-value">${formatPrice(0)}</span>
                                </div>
                                <div class="gallery-actions" style="margin-top: 15px;">
                                     <button class="btn-order"><i class="fas fa-shopping-cart"></i> Pesan</button>
                                     <button class="btn-preorder-toggle"><i class="fas fa-calendar-check"></i> Pre-Order</button>
                                </div>
                                <div class="preorder-form">
                                    <div class="preorder-title"><i class="fas fa-money-bill-wave"></i><span>Form Uang Muka (DP)</span></div>
                                    <input type="number" class="preorder-input" placeholder="Masukkan nominal DP (minimal 40%)">
                                    <p class="preorder-note">* Untuk pre-order, harap masukkan nominal uang muka minimal 40% dari total harga. Kami akan menghubungi Anda untuk konfirmasi lebih lanjut.</p>
                                    <button class="btn-preorder"><i class="fas fa-paper-plane"></i> Kirim Pre-Order</button>
                                </div>
                            </div>

                            <div class="gallery-detail-expanded">
                                <div class="gallery-content">
                                    <p class="gallery-description">${product.details?.description || ''}</p>
                                    <div class="gallery-specs">${detailSpecsHTML}</div>
                                </div>
                            </div>
                            
                            <div class="gallery-actions">
                                ${whatsappButtonHTML}
                                ${phoneButtonHTML}
                                <a href="${product.seller?.link || '#'}" target="_blank" class="btn-visit"><i class="fas fa-store-alt"></i> Kunjungi Gerai</a>
                                ${locationButtonHTML}
                                ${hasPriceVariations ? '<button class="btn-toggle-prices"><i class="fas fa-tags"></i> Cek Harga</button>' : ''}
                                <button class="btn-detail"><i class="fas fa-chevron-down"></i> Detail</button>
                            </div>
                        </div>
                    </div>`;
            }

            const galleryGrid = document.getElementById('gallery-grid');
            const body = document.body;

            function renderProducts(productsData) {
                if (!galleryGrid) return;
                galleryGrid.innerHTML = productsData.map(product => createProductCardHTML(product)).join('');
            }
            renderProducts(products); 

             function initializeProductSliders() {
                const containers = document.querySelectorAll('.gallery-image-container');
                containers.forEach(container => {
                    const images = container.querySelectorAll('.gallery-slider-image');
                    const dots = container.querySelectorAll('.slider-dot');
                    let currentIndex = 0;
                    let slideInterval;

                    if (images.length <= 1) return;

                    const showSlide = (index) => {
                        images.forEach((img, i) => img.classList.toggle('active', i === index));
                        dots.forEach((dot, i) => dot.classList.toggle('active', i === index));
                    };

                    const nextSlide = () => {
                        currentIndex = (currentIndex + 1) % images.length;
                        showSlide(currentIndex);
                    };

                    const startSlider = () => {
                        stopSlider();
                        slideInterval = setInterval(nextSlide, 3000);
                    };

                    const stopSlider = () => {
                        clearInterval(slideInterval);
                    };
                    
                    images.forEach(img => {
                        img.addEventListener('click', () => {
                            document.getElementById('zoomedImage').src = img.src;
                            document.getElementById('imageModal').classList.add('show');
                            body.style.overflow = 'hidden';
                            playButtonSound();
                        });
                    });

                    container.addEventListener('mouseenter', stopSlider);
                    container.addEventListener('mouseleave', startSlider);

                    startSlider();
                });
            }
            initializeProductSliders();

            function initCardEventListeners(container) {
                 const updateGrandTotal = (productCard) => {
                    let grandTotal = 0;
                    const variationItems = productCard.querySelectorAll('.price-variation-item');
                    variationItems.forEach(item => {
                        const price = parseFloat(item.dataset.price) || 0;
                        const quantityInput = item.querySelector('.quantity-input');
                        const quantity = parseInt(quantityInput.value, 10) || 0;
                        grandTotal += price * quantity;
                    });
                    const totalPriceElement = productCard.querySelector('.total-price-value');
                    if (totalPriceElement) {
                        totalPriceElement.textContent = formatPrice(grandTotal);
                    }
                };

                container.addEventListener('click', async e => {
                    const target = e.target;
                    const productCard = target.closest('.gallery-item');
                    if (!productCard) return;

                    if (target.closest('.btn-toggle-prices')) {
                        playButtonSound();
                        const btn = target.closest('.btn-toggle-prices');
                        const priceSection = productCard.querySelector('.price-section-collapsible');
                        priceSection.classList.toggle('show');
                        btn.classList.toggle('active');
                        btn.innerHTML = priceSection.classList.contains('show') 
                            ? '<i class="fas fa-eye-slash"></i> Sembunyikan Harga' 
                            : '<i class="fas fa-tags"></i> Cek Harga';
                    }

                    if (target.closest('.btn-detail')) {
                        playButtonSound();
                        const btn = target.closest('.btn-detail');
                        const currentCard = target.closest('.gallery-item');
                        const expandedContent = currentCard.querySelector('.gallery-detail-expanded');
                        const isAlreadyActive = expandedContent.classList.contains('active');

                        document.querySelectorAll('.gallery-detail-expanded.active').forEach(activePanel => {
                            if (activePanel !== expandedContent) {
                                activePanel.classList.remove('active');
                                const parentCard = activePanel.closest('.gallery-item');
                                if (parentCard) {
                                    const detailButton = parentCard.querySelector('.btn-detail');
                                    detailButton.classList.remove('active');
                                    detailButton.innerHTML = '<i class="fas fa-chevron-down"></i> Detail';
                                }
                            }
                        });

                        expandedContent.classList.toggle('active');
                        btn.classList.toggle('active');
                        btn.innerHTML = expandedContent.classList.contains('active') 
                            ? '<i class="fas fa-chevron-up"></i> Sembunyikan' 
                            : '<i class="fas fa-chevron-down"></i> Detail';
                    }

                    if (target.classList.contains('quantity-btn')) {
                        playButtonSound();
                        const btn = target;
                        const input = btn.parentElement.querySelector('.quantity-input');
                        let value = parseInt(input.value, 10) || 0;
                        if (btn.classList.contains('plus')) value++;
                        else if (btn.classList.contains('minus') && value > 0) value--;
                        input.value = value;
                        updateGrandTotal(productCard);
                    }
                    
                    if (target.closest('.btn-preorder-toggle')) {
                        playButtonSound();
                        const btn = target.closest('.btn-preorder-toggle');
                        const preorderForm = productCard.querySelector('.preorder-form');
                        preorderForm.classList.toggle('active');
                        btn.classList.toggle('active');
                        btn.innerHTML = preorderForm.classList.contains('active') 
                            ? '<i class="fas fa-times"></i> Batal Pre-Order' 
                            : '<i class="fas fa-calendar-check"></i> Pre-Order';
                    }
                    
                    const productId = productCard.dataset.id;
                    const productData = products.find(p => p.id === productId);
                    if (!productData) return;

                    const gatherOrderDetails = (type = 'PEMESANAN LANGSUNG') => {
                        const items = []; let grandTotal = 0;
                        const unitSelect = productCard.querySelector('.unit-select');
                        const unit = unitSelect ? unitSelect.value : (productData.defaultUnit || 'pcs');
                        const variationItems = productCard.querySelectorAll('.price-variation-item');
                        variationItems.forEach(item => {
                            const quantity = parseInt(item.querySelector('.quantity-input').value, 10) || 0;
                            if (quantity > 0) {
                                const name = item.dataset.name;
                                const unitPrice = parseFloat(item.dataset.price);
                                const subtotal = unitPrice * quantity;
                                items.push({ name, quantity, unitPrice, subtotal });
                                grandTotal += subtotal;
                            }
                        });
                        if (items.length === 0) { alert('Anda belum memilih item atau jumlah produk.'); return null; }
                        let dpAmount = 'N/A';
                        if (type === 'PRE-ORDER') { 
                            const dpInput = productCard.querySelector('.preorder-input'); 
                            const dpValue = parseFloat(dpInput.value); 
                            if (isNaN(dpValue) || dpValue <= 0) { alert('Mohon masukkan nominal DP yang valid'); return null; } 
                            if (dpValue < (grandTotal * 0.4)) { alert(`Uang muka minimal 40% dari total harga (${formatPrice(grandTotal * 0.4)})`); return null; } 
                            dpAmount = formatPrice(dpValue); 
                        }
                        return { type, items, grandTotal, unit, dpAmount };
                    };
                    
                    const generateWhatsAppMessage = (product, details) => {
                        let itemsText = details.items.map(item => `   - ${item.name} (x${item.quantity})`).join('\n');
                        let totalText = `Total Harga: *${formatPrice(details.grandTotal)}*`;
                        if(details.type === 'PRE-ORDER') totalText += `\nUang Muka: *${details.dpAmount}*`;
                        const orderType = details.type === 'PRE-ORDER' ? 'PRE-ORDER' : 'PEMESANAN';
                        return `Halo, saya ingin melakukan *${orderType}* untuk produk dari *${product.seller?.name || 'N/A'}*:\n\n*${product.title}*\n${itemsText}\n\nSatuan: ${details.unit}\n${totalText}\n\nBukti pemesanan sudah saya unduh. Mohon info lebih lanjut untuk proses selanjutnya. Terima kasih.`;
                    }
                    
                    // [PENYEMPURNAAN SESUAI PERMINTAAN] Alur proses order cerdas: 
                    // 1. Unduh Struk/Nota PDF secara otomatis.
                    // 2. Langsung arahkan ke aplikasi WhatsApp pengguna dengan pesan yang sudah diisi.
                    // Metode `https://wa.me/...` adalah cara standar dan paling ramah pengguna untuk membuka obrolan WhatsApp secara langsung, 
                    // ini BUKAN API yang rumit dan berfungsi di semua perangkat (ponsel & desktop).
                    const processOrder = async (type) => {
                        const orderDetails = gatherOrderDetails(type);
                        if (orderDetails) {
                            const confirmationMessage = type === 'PRE-ORDER'
                                ? `Anda akan melakukan Pre-Order dengan total ${formatPrice(orderDetails.grandTotal)} dan DP ${orderDetails.dpAmount}.\n\nSistem akan mengunduh bukti pre-order secara otomatis, lalu mengarahkan Anda ke WhatsApp penjual.\n\nLanjutkan?`
                                : `Anda akan memesan dengan total ${formatPrice(orderDetails.grandTotal)}.\n\nSistem akan mengunduh nota pemesanan secara otomatis, lalu mengarahkan Anda ke WhatsApp penjual.\n\nLanjutkan?`;

                            if (confirm(confirmationMessage)) {
                                playButtonSound();
                                // Langkah 1: Generate dan picu unduh otomatis PDF. Fungsi ini menunggu hingga proses PDF selesai.
                                await generateAndDownloadReceipt(productData, orderDetails);
                                
                                // Langkah 2: Setelah PDF diunduh, arahkan pengguna ke aplikasi WhatsApp.
                                // Penundaan singkat untuk memastikan unduhan file dimulai tanpa masalah di browser.
                                setTimeout(() => {
                                  // Penggunaan `wa.me` akan membuka aplikasi WhatsApp (jika terinstal) atau WhatsApp Web.
                                  // Pesan yang sudah dibuat sebelumnya (`generateWhatsAppMessage`) akan otomatis terisi,
                                  // memudahkan konsumen dan pelaku usaha yang awam sekalipun.
                                  window.open(`https://wa.me/${productData.contact?.whatsapp}?text=${encodeURIComponent(generateWhatsAppMessage(productData, orderDetails))}`, '_blank');
                                }, 500); 
                            }
                        }
                    };

                    if (target.closest('.btn-order')) {
                        // Memproses pesanan langsung
                        await processOrder('PEMESANAN LANGSUNG');
                    }
                    
                    if (target.closest('.btn-preorder')) {
                        // Memproses pesanan pre-order
                        await processOrder('PRE-ORDER');
                    }
                });
                
                container.addEventListener('input', e => {
                    if (e.target.classList.contains('quantity-input')) {
                        if (e.target.value < 0) e.target.value = 0;
                        const productCard = e.target.closest('.gallery-item');
                        if(productCard) updateGrandTotal(productCard);
                    }
                });
            }

            if(galleryGrid) initCardEventListeners(galleryGrid);

            const searchModal = document.getElementById('searchModal'); const searchModalInput = document.getElementById('searchModalInput'); const searchResults = document.getElementById('searchResults'); const headerSearchInput = document.getElementById('headerSearchInput'); const headerSearchBtn = document.getElementById('headerSearchBtn'); const navSearchInput = document.getElementById('navSearchInput'); const navSearchBtn = document.getElementById('navSearchBtn'); const searchFilters = document.getElementById('searchFilters');
            const btnCloseSearchModal = document.querySelector('.btn-close-modal');

            function openSearchModal(query = '') { if(searchModal) { searchModal.classList.add('show'); body.style.overflow = 'hidden'; searchModalInput.value = query; searchModalInput.focus(); performSearch(query); } }
            function closeSearchModal() { if(searchModal) { searchModal.classList.remove('show'); body.style.overflow = ''; } }
            
            function performSearch(query) { 
                const lowerCaseQuery = query.trim().toLowerCase(); 
                const filters = {
                    discount: document.getElementById('filter-discount')?.checked,
                    bonus: document.getElementById('filter-bonus')?.checked,
                    negotiable: document.getElementById('filter-negotiable')?.checked,
                    sortCheap: document.getElementById('filter-sort-cheap')?.checked
                };

                let results = products;
                const isAnyFilterActive = Object.values(filters).some(v => v);

                if (lowerCaseQuery.length >= 2) {
                    results = products.filter(p => {
                        const descriptionText = (p.details?.description || '').replace(/<[^>]*>?/gm, '');
                        const specsText = (p.details?.specs || []).map(s => `${s.label} ${s.value}`).join(' ').replace(/<[^>]*>?/gm, '');
                        const searchableText = [p.title, p.seller?.name, p.code, descriptionText, specsText].join(' ').toLowerCase();
                        return searchableText.includes(lowerCaseQuery);
                    });
                } else if (!isAnyFilterActive) {
                    if(searchResults) searchResults.innerHTML = '<p class="search-results-placeholder">Ketik minimal 2 huruf atau pilih filter untuk mencari produk...</p>'; 
                    return;
                }
                
                if (filters.discount) {
                    results = results.filter(p => p.originalPrice || p.discount);
                }
                if (filters.bonus) {
                    results = results.filter(p => /bonus|gratis|free/i.test(JSON.stringify(p.details)));
                }
                if (filters.negotiable) {
                    results = results.filter(p => p.discount === 'Nego' || /nego|estimasi|perkiraan|hubungi/i.test(p.details?.description || ''));
                }

                if (filters.sortCheap) {
                    results.sort((a, b) => (a.price || 0) - (b.price || 0));
                }

                displaySearchResults(results); 
            }
            
            function displaySearchResults(results) { if (!searchResults) return; if (results.length === 0) { searchResults.innerHTML = '<p class="search-results-placeholder">Produk tidak ditemukan.</p>'; return; } searchResults.innerHTML = results.map(p => `<a href="#product-${p.id}" class="search-result-item" data-product-id="${p.id}"><img src="${p.mainImage}" alt="${p.title}" class="search-result-image"><div class="search-result-info"><h4>${p.title}</h4><p>oleh ${p.seller?.name || ''} (Kode: ${p.code || ''})</p></div></a>`).join(''); }
            [headerSearchInput, navSearchInput].forEach(input => { if(input) input.addEventListener('keypress', (e) => { if (e.key === 'Enter') { e.preventDefault(); openSearchModal(input.value); } }); });
            [headerSearchBtn, navSearchBtn].forEach(button => { if(button) button.addEventListener('click', (e) => { e.preventDefault(); const input = button.previousElementSibling; if(input) openSearchModal(input.value); }); });
            if(searchModalInput) searchModalInput.addEventListener('input', () => performSearch(searchModalInput.value));
            if(searchFilters) searchFilters.addEventListener('change', () => performSearch(searchModalInput.value));
            if(btnCloseSearchModal) btnCloseSearchModal.addEventListener('click', closeSearchModal);
            if(searchResults) searchResults.addEventListener('click', (e) => { const link = e.target.closest('.search-result-item'); if (link) { e.preventDefault(); const targetId = link.getAttribute('href'); const targetElement = document.querySelector(targetId); if (targetElement) { closeSearchModal(); setTimeout(() => { window.scrollTo({ top: targetElement.offsetTop - 100, behavior: 'smooth' }); }, 100); } } });
            
            const bgMusic = document.getElementById('bgMusic'); if (bgMusic) { bgMusic.volume = 0.3; let p = false; const pm = () => { if (!p) { bgMusic.play().then(() => { p = true; }).catch(() => {}); } }; pm(); document.body.addEventListener('click', pm, { once: true }); document.body.addEventListener('touchstart', pm, { once: true }); }
            const particlesContainer = document.getElementById('particles'); if (particlesContainer) { for (let i = 0; i < 40; i++) { const pr = document.createElement('div'); pr.classList.add('particle'); const s = Math.random() * 6 + 2; pr.style.width = `${s}px`; pr.style.height = `${s}px`; pr.style.left = `${Math.random() * 100}%`; pr.style.animationDuration = `${Math.random() * 15 + 15}s`; pr.style.animationDelay = `${Math.random() * 10}s`; particlesContainer.appendChild(pr); } }
            const navbar = document.getElementById('navbar'); if (navbar) { window.addEventListener('scroll', () => { navbar.classList.toggle('scrolled', window.scrollY > 50); }); }
            const mobileMenuToggle = document.getElementById('mobileMenuToggle'); const navLinks = document.getElementById('navLinks'); if (mobileMenuToggle && navLinks) { mobileMenuToggle.addEventListener('click', () => { navLinks.classList.toggle('active'); mobileMenuToggle.innerHTML = navLinks.classList.contains('active') ? '<i class="fas fa-times"></i>' : '<i class="fas fa-bars"></i>'; playButtonSound(); }); navLinks.addEventListener('click', (e) => { if (e.target.tagName === 'A') { navLinks.classList.remove('active'); mobileMenuToggle.innerHTML = '<i class="fas fa-bars"></i>'; } }); }
            const searchToggle = document.getElementById('searchToggle'); const navSearch = document.getElementById('navSearch'); if(searchToggle && navSearch) { searchToggle.addEventListener('click', () => { navSearch.classList.toggle('active'); playButtonSound(); }); }
            const productCategories = document.querySelector('.product-categories'); const categoryTabs = document.querySelector('.category-tabs'); let activeCategory = 'all'; let activeType = 'all';
            function applyFilters() { document.querySelectorAll('.gallery-item').forEach(item => { const iC = item.dataset.category; const iT = item.dataset.type; const cM = activeCategory === 'all' || iC === activeCategory; const tM = activeType === 'all' || iT === activeType || (iT === 'all' && activeType !== 'rental' && activeType !== 'promo' && activeType !== 'jasa') ; item.style.display = (cM && tM) ? 'flex' : 'none'; }); }
            if (productCategories) { productCategories.addEventListener('click', e => { if (e.target.classList.contains('product-category-btn')) { productCategories.querySelectorAll('.product-category-btn').forEach(btn => btn.classList.remove('active')); e.target.classList.add('active'); activeCategory = e.target.dataset.category; applyFilters(); playButtonSound(); } }); }
            if (categoryTabs) { categoryTabs.addEventListener('click', e => { if (e.target.classList.contains('category-btn')) { categoryTabs.querySelectorAll('.category-btn').forEach(btn => btn.classList.remove('active')); e.target.classList.add('active'); activeType = e.target.dataset.type; applyFilters(); playButtonSound(); } }); }
            const contactForm = document.getElementById('contactForm'); if (contactForm) { contactForm.addEventListener('submit', function(e) { /* Biarkan default action dari formsubmit.co berjalan */ }); }
            const orderModal = document.getElementById('orderModal'); const quickOrderBtn = document.getElementById('quick-order'); if (orderModal && quickOrderBtn) { quickOrderBtn.addEventListener('click', () => { orderModal.classList.add('show'); body.style.overflow = 'hidden'; playButtonSound(); }); }
            
            const downloadAppBtn = document.getElementById('downloadAppBtn');
            const downloadModal = document.getElementById('downloadModal');
            if (downloadAppBtn && downloadModal) {
                downloadAppBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    downloadModal.classList.add('show');
                    body.style.overflow = 'hidden';
                    playButtonSound();
                });
            }
            
            document.querySelectorAll('.modal, .image-modal, .search-modal').forEach(modal => { modal.addEventListener('click', (e) => { if (e.target === modal || e.target.classList.contains('close-modal') || e.target.classList.contains('close-image-modal') || e.target.classList.contains('close-search-modal')) { modal.classList.remove('show'); body.style.overflow = ''; } }); });
            
            const buttonSound = document.getElementById('buttonSound'); 
            function playButtonSound() { 
                if(buttonSound) { 
                    buttonSound.currentTime = 0; 
                    buttonSound.play().catch(() => {});
                } 
            }

            document.querySelectorAll('a[href^="#"]').forEach(anchor => { anchor.addEventListener('click', function(e) { if (this.getAttribute('href') !== '#' && !this.closest('.search-result-item')) { e.preventDefault(); const target = document.querySelector(this.getAttribute('href')); if (target) { window.scrollTo({ top: target.offsetTop - 80, behavior: 'smooth' }); } } }); });
            
            const offerNotification = document.getElementById('offerNotification');
            const notificationSound = document.getElementById('notificationSound');
            const step1 = document.getElementById('notificationStep1');
            const step2 = document.getElementById('notificationStep2');

            const showNotification = () => {
                if (offerNotification && !localStorage.getItem('offerDismissed')) { 
                    offerNotification.classList.add('show');
                    if (notificationSound) {
                        notificationSound.play().catch(e => console.log("Autoplay untuk suara notifikasi diblokir oleh browser."));
                    }
                }
            };

            const hideNotification = () => {
                if(offerNotification) {
                    offerNotification.classList.remove('show');
                    localStorage.setItem('offerDismissed', 'true');
                }
            };

            setTimeout(showNotification, 5000); 

            if(offerNotification) {
                offerNotification.addEventListener('click', (e) => {
                    const target = e.target;
                    if (target.id === 'closeNotification' || (target.matches('.notification-btn') && target.dataset.action === 'close')) {
                        hideNotification();
                    } 
                    else if (target.matches('.notification-btn')) {
                        const action = target.dataset.action;
                        if (action === 'next') {
                            step1.classList.remove('active');
                            step2.classList.add('active');
                        } else if (action === 'register') {
                            window.open('https://anekamarket.my.id/formulirpendaftaran', '_blank');
                            hideNotification();
                        }
                    }
                });
            }
            
            let lastScrollTop = 0;
            const fabContainers = document.querySelectorAll('.autohide-fab');
            window.addEventListener('scroll', function() {
                let scrollTop = window.pageYOffset || document.documentElement.scrollTop;
                if (scrollTop > lastScrollTop && scrollTop > 200) {
                    fabContainers.forEach(container => container.classList.add('fab-hidden'));
                } else {
                    fabContainers.forEach(container => container.classList.remove('fab-hidden'));
                }
                lastScrollTop = scrollTop <= 0 ? 0 : scrollTop;
            }, false);

            const generatorModal = document.getElementById('generatorModal');
            const openGeneratorBtn = document.getElementById('openGeneratorBtn');
            const closeGeneratorModalBtn = document.getElementById('closeGeneratorModal');
            const generatorForm = document.getElementById('productGeneratorForm');
            const priceVariationsContainer = document.getElementById('priceVariationsContainer');
            const specsContainer = document.getElementById('specsContainer');
            const addPriceVariationBtn = document.getElementById('addPriceVariationBtn');
            const addSpecBtn = document.getElementById('addSpecBtn');
            const outputContainer = document.getElementById('generatorOutputContainer');
            const outputElement = document.getElementById('generatedScriptOutput');
            const outputWrapper = document.getElementById('generatedScriptWrapper');
            const copyScriptBtn = document.getElementById('copyScriptBtn');
            const downloadScriptBtn = document.getElementById('downloadScriptBtn');
            const toggleVisibilityBtn = document.getElementById('toggleScriptVisibilityBtn');
            const importScriptBtn = document.getElementById('importScriptBtn');
            const genImporter = document.getElementById('gen-importer');
            const previewProductBtn = document.getElementById('previewProductBtn');
            const generatorPreviewContainer = document.getElementById('generatorPreviewContainer');
            const previewTarget = document.getElementById('previewTarget');

            const openGeneratorModal = () => { if(generatorModal) { generatorModal.classList.add('show'); body.style.overflow = 'hidden'; }};
            const closeGeneratorModal = () => { if(generatorModal) { generatorModal.classList.remove('show'); body.style.overflow = ''; }};

            if (openGeneratorBtn) {
                openGeneratorBtn.addEventListener('click', () => {
                    playButtonSound();
                    const password = prompt("Masukkan password untuk mengakses generator:");
                    if (password === "LKS.1945") {
                        openGeneratorModal();
                    } else if (password !== null) { 
                        alert("Password salah. Akses ditolak.");
                    }
                });
            }

            if(closeGeneratorModalBtn) closeGeneratorModalBtn.addEventListener('click', closeGeneratorModal);
            if(generatorModal) generatorModal.addEventListener('click', (e) => { if (e.target === generatorModal) closeGeneratorModal(); });

            const addDynamicItem = (container, name = '', value = '', placeholder1, placeholder2) => {
                const item = document.createElement('div');
                item.className = 'dynamic-list-item';
                item.innerHTML = `
                    <input type="text" class="dynamic-name" placeholder="${placeholder1}" value="${name}" required>
                    <input type="text" class="dynamic-value" placeholder="${placeholder2}" value="${value}" required>
                    <button type="button" class="btn-remove-item"><i class="fas fa-trash"></i></button>
                `;
                if (container === priceVariationsContainer) {
                    item.querySelector('.dynamic-value').type = 'number';
                }
                container.appendChild(item);
                item.querySelector('.btn-remove-item').addEventListener('click', () => item.remove());
            };

            if(addPriceVariationBtn) addPriceVariationBtn.addEventListener('click', () => addDynamicItem(priceVariationsContainer, '', '', 'Nama Variasi (e.g., Ecer)', 'Harga (e.g., 8000)'));
            if(addSpecBtn) addSpecBtn.addEventListener('click', () => addDynamicItem(specsContainer, '', '', 'Label (e.g., Kode Produk)', 'Value (e.g., ACA-2025-8899)'));

            function getProductDataFromForm() {
                const product = {};
                product.id = document.getElementById('gen-id').value;
                product.category = document.getElementById('gen-category').value;
                product.type = document.getElementById('gen-type').value;
                product.seller = { 
                    name: document.getElementById('gen-seller-name').value, 
                    link: document.getElementById('gen-seller-link').value,
                    locationLink: document.getElementById('gen-seller-location').value || null
                };
                product.badge = { text: document.getElementById('gen-badge-text').value, type: document.getElementById('gen-badge-type').value };
                product.mainImage = document.getElementById('gen-mainImage').value;
                product.title = document.getElementById('gen-title').value;
                product.code = document.getElementById('gen-code').value;
                product.price = parseFloat(document.getElementById('gen-price').value) || 0;
                const originalPrice = document.getElementById('gen-originalPrice').value;
                product.originalPrice = originalPrice ? parseFloat(originalPrice) : null;
                const discount = document.getElementById('gen-discount').value;
                product.discount = discount || null;
                product.priceVariations = [];
                priceVariationsContainer.querySelectorAll('.dynamic-list-item').forEach(item => {
                    const name = item.querySelector('.dynamic-name').value;
                    const price = parseFloat(item.querySelector('.dynamic-value').value);
                    if (name && !isNaN(price)) product.priceVariations.push({ name, price });
                });
                product.units = document.getElementById('gen-units').value.split(',').map(u => u.trim()).filter(u => u);
                product.defaultUnit = document.getElementById('gen-defaultUnit').value;
                product.details = {
                    description: document.getElementById('gen-description').value,
                    images: document.getElementById('gen-images').value.split(/[\n,]+/).map(img => img.trim()).filter(img => img),
                    specs: []
                };
                specsContainer.querySelectorAll('.dynamic-list-item').forEach(item => {
                    const label = item.querySelector('.dynamic-name').value;
                    const value = item.querySelector('.dynamic-value').value;
                    if (label && value) product.details.specs.push({ label, value });
                });
                product.contact = { whatsapp: document.getElementById('gen-contact-whatsapp').value, phone: document.getElementById('gen-contact-phone').value };
                return product;
            }

            if(generatorForm) {
                generatorForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    const product = getProductDataFromForm();
                    const jsonString = JSON.stringify(product);
                    outputElement.textContent = jsonString;
                    outputContainer.style.display = 'block';
                    generatorPreviewContainer.style.display = 'none';
                    outputContainer.scrollIntoView({ behavior: 'smooth' });
                    playButtonSound();
                });
            }

            if (importScriptBtn) {
                importScriptBtn.addEventListener('click', () => {
                    let scriptText = genImporter.value.trim();
                    if (!scriptText) { alert("Area teks kosong. Silakan tempel script produk."); return; }
                    try {
                        if (!scriptText.startsWith('{') && !scriptText.startsWith('[')) {
                            const jsonStart = scriptText.indexOf('{');
                            const jsonStartArray = scriptText.indexOf('[');
                            let startIndex = -1;
                            if (jsonStart !== -1 && jsonStartArray !== -1) { startIndex = Math.min(jsonStart, jsonStartArray); }
                            else if (jsonStart !== -1) { startIndex = jsonStart; }
                            else { startIndex = jsonStartArray; }
                            if (startIndex !== -1) { scriptText = scriptText.substring(startIndex); }
                        }
                        scriptText = scriptText.replace(/,\s*([}\]])/g, "$1");
                        let rawData = JSON.parse(scriptText); let productData;
                        if (Array.isArray(rawData)) {
                            if (rawData.length > 0) { productData = rawData[0]; alert('Dideteksi input berupa array. Data dari produk pertama dalam daftar telah dimuat.'); }
                            else { alert('Array yang Anda tempel kosong. Tidak ada data untuk dimuat.'); return; }
                        } else { productData = rawData; }
                        if (typeof productData !== 'object' || productData === null) { throw new Error("Data yang valid tidak ditemukan."); }
                        document.getElementById('gen-id').value = productData.id || '';
                        document.getElementById('gen-code').value = productData.code || productData.id || '';
                        document.getElementById('gen-title').value = productData.title || '';
                        document.getElementById('gen-category').value = productData.category || 'food';
                        document.getElementById('gen-type').value = productData.type || 'all';
                        document.getElementById('gen-mainImage').value = productData.mainImage || '';
                        document.getElementById('gen-price').value = productData.price ?? '';
                        document.getElementById('gen-originalPrice').value = productData.originalPrice ?? '';
                        document.getElementById('gen-discount').value = productData.discount || '';
                        document.getElementById('gen-badge-text').value = productData.badge?.text || '';
                        document.getElementById('gen-badge-type').value = productData.badge?.type || 'promo';
                        document.getElementById('gen-seller-name').value = productData.seller?.name || '';
                        document.getElementById('gen-seller-link').value = productData.seller?.link || '';
                        document.getElementById('gen-seller-location').value = productData.seller?.locationLink || '';
                        document.getElementById('gen-contact-whatsapp').value = productData.contact?.whatsapp || '';
                        document.getElementById('gen-contact-phone').value = productData.contact?.phone || '';
                        document.getElementById('gen-units').value = productData.units?.join(', ') || '';
                        document.getElementById('gen-defaultUnit').value = productData.defaultUnit || '';
                        document.getElementById('gen-description').value = productData.details?.description || '';
                        document.getElementById('gen-images').value = productData.details?.images?.join(',\n') || '';
                        priceVariationsContainer.innerHTML = '';
                        (productData.priceVariations || []).forEach(v => addDynamicItem(priceVariationsContainer, v.name, v.price, 'Nama Variasi', 'Harga'));
                        specsContainer.innerHTML = '';
                        (productData.details?.specs || []).forEach(s => addDynamicItem(specsContainer, s.label, s.value, 'Label', 'Value'));
                        alert('Data produk berhasil dimuat ke dalam form!'); playButtonSound();
                    } catch (error) { alert(`Gagal memuat data. Pastikan script JSON valid.\n\nDetail: ${error.message}`); console.error('JSON Parse Error:', error); }
                });
            }

            if (previewProductBtn) {
                previewProductBtn.addEventListener('click', () => {
                    try {
                        const productData = getProductDataFromForm();
                        previewTarget.innerHTML = createProductCardHTML(productData);
                        generatorPreviewContainer.style.display = 'block';
                        outputContainer.style.display = 'none';
                        initCardEventListeners(previewTarget);
                        initializeProductSliders();
                        generatorPreviewContainer.scrollIntoView({ behavior: 'smooth' });
                        playButtonSound();
                    } catch(e){ alert("Gagal membuat preview. Pastikan semua field wajib diisi dengan benar."); }
                });
            }

            if(copyScriptBtn) copyScriptBtn.addEventListener('click', () => { navigator.clipboard.writeText(outputElement.textContent).then(() => alert('Script berhasil disalin!')).catch(err => alert('Gagal menyalin.')); playButtonSound(); });
            if(downloadScriptBtn) downloadScriptBtn.addEventListener('click', () => { const blob = new Blob([outputElement.textContent], { type: 'application/javascript' }); const url = URL.createObjectURL(blob); const a = document.createElement('a'); const fileName = document.getElementById('gen-id').value || 'product-data'; a.href = url; a.download = `${fileName}.js`; document.body.appendChild(a); a.click(); document.body.removeChild(a); URL.revokeObjectURL(url); playButtonSound(); });
            if(toggleVisibilityBtn) toggleVisibilityBtn.addEventListener('click', () => { outputWrapper.classList.toggle('visible'); const icon = toggleVisibilityBtn.querySelector('i'); if(icon) icon.className = outputWrapper.classList.contains('visible') ? 'fas fa-eye' : 'fas fa-eye-slash'; playButtonSound(); });
            
            const whatsappInput = document.getElementById('gen-contact-whatsapp');
            const phoneInput = document.getElementById('gen-contact-phone');
            
            if(whatsappInput) {
                whatsappInput.addEventListener('input', (e) => {
                    let value = e.target.value.replace(/\D/g, '');
                    if (value.startsWith('0')) {
                        value = '62' + value.substring(1);
                    } else if (value.startsWith('+62')) {
                        value = '62' + value.substring(3);
                    }
                    e.target.value = value;
                });
            }
            
            if(phoneInput) {
                phoneInput.addEventListener('input', (e) => {
                    let value = e.target.value.replace(/[^0-9+]/g, '');
                    if (value.startsWith('0')) {
                        value = '+62' + value.substring(1);
                    } else if (!value.startsWith('+')) {
                         value = '+' + value;
                    }
                    e.target.value = value;
                });
            }

            const descriptionTextarea = document.getElementById('gen-description');
            const toolbar = document.querySelector('.description-toolbar');
            if(toolbar && descriptionTextarea) {
                toolbar.addEventListener('click', (e) => {
                    const button = e.target.closest('.toolbar-btn');
                    if (!button) return;

                    const tag = button.dataset.tag;
                    const start = descriptionTextarea.selectionStart;
                    const end = descriptionTextarea.selectionEnd;
                    const selectedText = descriptionTextarea.value.substring(start, end);
                    const beforeText = descriptionTextarea.value.substring(0, start);
                    const afterText = descriptionTextarea.value.substring(end);
                    
                    let replacement;
                    let cursorPosition = start;

                    if (tag === 'br') {
                        replacement = '<br>';
                        descriptionTextarea.value = beforeText + replacement + afterText;
                        cursorPosition += replacement.length;
                    } else {
                        replacement = `<${tag}>${selectedText}</${tag}>`;
                        descriptionTextarea.value = beforeText + replacement + afterText;
                        cursorPosition = start + replacement.length;
                    }

                    descriptionTextarea.focus();
                    descriptionTextarea.selectionStart = descriptionTextarea.selectionEnd = cursorPosition;
                });
            }

        });
</script>
</body>
</html>
